<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Kelime AvcÄ±sÄ±</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="gÃ¶rsel.css">

    <style>
        .config-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .opt-btn { 
            background: white; border: 1px solid #e5e7eb; padding: 8px 15px; 
            border-radius: 20px; cursor: pointer; color: var(--gray); font-weight: 600;
            transition: all 0.2s;
        }
        .opt-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .timer-big { font-size: 3rem; font-weight: 900; color: var(--primary); margin: 10px 0; }
        .record-text { font-size: 0.9rem; color: var(--gray); margin-bottom: 20px; }

        /* --- KRÄ°TÄ°K DÃœZELTME: HARF RENKLERÄ° --- */
        .letter { position: relative; transition: color 0.1s; }
        
        /* DoÄŸru Harf (YeÅŸil) */
        .letter.correct { color: #10b981 !important; } 
        
        /* YanlÄ±ÅŸ Harf (KÄ±rmÄ±zÄ±) */
        .letter.incorrect { color: #ef4444 !important; text-decoration: underline; }
        
        /* Ä°mleÃ§ (Aktif Harf - YanÄ±p SÃ¶nen Ã‡izgi) */
        .letter.active::before {
            content: '|';
            position: absolute;
            left: -2px;
            color: var(--primary);
            animation: blink 1s infinite;
            opacity: 0.7;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* HatalÄ± Kelime (TÃ¼mden KÄ±rmÄ±zÄ±) */
        .word.error { text-decoration: underline wavy #ef4444; }
    </style>
</head>
<body>

    <nav class="navbar">
        <a href="index.html" class="logo">Hakan<span>Tools</span></a>
        <div class="nav-links">
            <a href="index.html" class="nav-back">â† Ana MenÃ¼</a>
        </div>
    </nav>

    <div class="main-container">
        <div class="game-wrapper">
            
            <div class="config-row">
                <button class="opt-btn active" id="btn-tr" onclick="setLanguage('tr')">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</button>
                <button class="opt-btn" id="btn-en" onclick="setLanguage('en')">ğŸ‡ºğŸ‡¸ English</button>
            </div>

            <div class="config-row" id="time-options">
                <button class="opt-btn" onclick="setTime(15)">15s</button>
                <button class="opt-btn active" onclick="setTime(30)">30s</button>
                <button class="opt-btn" onclick="setTime(60)">60s</button>
                <button class="opt-btn" onclick="setTime(180)">3dk</button>
            </div>

            <div class="record-text">
                <span id="ui-best">EN Ä°YÄ°</span> (<span id="record-mode-label">30s</span>): 
                <strong id="best-score" style="color: var(--dark);">0</strong> 
                <span id="ui-unit">KELÄ°ME</span>
                <div style="font-size: 0.75rem; margin-top: 5px;" id="best-date"></div>
            </div>

            <div class="timer-big" id="timer">30</div>

            <div class="word-display" id="words-wrapper" onclick="focusInput()"></div>

            <input type="text" id="input-field" class="input-field" autocomplete="off" autocapitalize="none" spellcheck="false" placeholder="Yazmaya baÅŸla...">

            <div style="margin-top: 20px; font-size: 0.85rem; color: #9ca3af;" id="ui-tips">
                Mobil Ä°pucu: Otomatik dÃ¼zeltmeyi kapatÄ±rsan rekor kÄ±rarsÄ±n.
            </div>

        </div>
    </div>

    <div class="result-modal" id="result-modal">
        <div class="result-content">
            <h2 id="ui-timeout" style="font-size: 2rem; color: var(--dark); margin-bottom: 10px;">SÃ¼re Doldu!</h2>
            
            <div id="final-score" style="font-size: 4rem; font-weight: 900; color: var(--primary); line-height: 1;">0</div>
            <div id="ui-result-label" style="color: var(--gray); margin-bottom: 20px;">DoÄŸru Kelime</div>

            <div class="stats-bar" style="border: none; padding: 0; margin-bottom: 20px;">
                <div class="stat-item">
                    <span id="ui-stat-keys" style="display:block; font-size:0.8rem; color:#6b7280;">VuruÅŸ</span>
                    <b id="stat-keystrokes" style="font-size:1.2rem; color:#111827;">0</b>
                </div>
                <div class="stat-item">
                    <span id="ui-stat-acc" style="display:block; font-size:0.8rem; color:#6b7280;">DoÄŸruluk</span>
                    <b id="stat-acc" style="font-size:1.2rem; color:#10b981;">%0</b>
                </div>
            </div>

            <div style="font-size: 0.8rem; color: #9ca3af; margin-bottom: 20px;">
                <span id="ui-stat-date">Tarih</span>: <span id="stat-date">--</span>
            </div>

            <button class="cta-btn" onclick="resetGame()" id="ui-restart">Tekrar Dene âŸ³</button>
            <br><br>
            <a href="index.html" style="color: var(--gray); text-decoration: none; font-size: 0.9rem;">Ã‡Ä±kÄ±ÅŸ</a>
        </div>
    </div>

    <footer>
        &copy; 2025 Hakan Tools. TÃ¼m HaklarÄ± SaklÄ±dÄ±r.
    </footer>

    <script>
        const wordPools = {
            tr: [
                "ben", "sen", "o", "biz", "siz", "onlar", "ve", "ile", "ama", "fakat", "lakin", "Ã§Ã¼nkÃ¼", "veya", "ya", "da", "de",
                "gelmek", "gitmek", "yapmak", "etmek", "olmak", "almak", "vermek", "sevmek", "bilmek", "gÃ¶rmek", "bakmak", "duymak",
                "yazmak", "okumak", "konuÅŸmak", "anlamak", "dÃ¼ÅŸÃ¼nmek", "baÅŸlamak", "bitirmek", "Ã§alÄ±ÅŸmak", "oynamak", "koÅŸmak", "yÃ¼rÃ¼mek",
                "ev", "okul", "iÅŸ", "araba", "masa", "sandalye", "kalem", "defter", "kitap", "bilgisayar", "telefon", "internet",
                "sabah", "Ã¶ÄŸle", "akÅŸam", "gece", "bugÃ¼n", "yarÄ±n", "dÃ¼n", "ÅŸimdi", "sonra", "Ã¶nce", "zaman", "saat", "dakika",
                "gÃ¼zel", "Ã§irkin", "iyi", "kÃ¶tÃ¼", "bÃ¼yÃ¼k", "kÃ¼Ã§Ã¼k", "uzun", "kÄ±sa", "zor", "kolay", "sÄ±cak", "soÄŸuk", "yeni", "eski",
                "kÄ±rmÄ±zÄ±", "mavi", "yeÅŸil", "sarÄ±", "siyah", "beyaz", "turuncu", "mor", "pembe", "gri", "kahverengi", "renk",
                "insan", "Ã§ocuk", "kadÄ±n", "erkek", "anne", "baba", "kardeÅŸ", "arkadaÅŸ", "Ã¶ÄŸretmen", "doktor", "mÃ¼hendis", "polis",
                "elma", "armut", "muz", "Ã§ilek", "ekmek", "su", "sÃ¼t", "Ã§ay", "kahve", "yemek", "kahvaltÄ±", "akÅŸam", "lezzetli",
                "mutlu", "Ã¼zgÃ¼n", "kÄ±zgÄ±n", "ÅŸaÅŸkÄ±n", "korkmuÅŸ", "heyecanlÄ±", "yorgun", "hÄ±zlÄ±", "yavaÅŸ", "gÃ¼Ã§lÃ¼", "zayÄ±f",
                "TÃ¼rkiye", "Ä°stanbul", "Ankara", "Ä°zmir", "dÃ¼nya", "gÃ¼neÅŸ", "ay", "yÄ±ldÄ±z", "deniz", "daÄŸ", "orman", "hava",
                "proje", "kod", "yazÄ±lÄ±m", "teknoloji", "veri", "sistem", "klavye", "ekran", "fare", "dosya", "klasÃ¶r", "uygulama",
                "baÅŸarÄ±", "hata", "kontrol", "sonuÃ§", "rapor", "analiz", "tasarÄ±m", "geliÅŸtirme", "test", "demo", "versiyon",
                "lÃ¼tfen", "teÅŸekkÃ¼r", "merhaba", "hoÅŸÃ§akal", "evet", "hayÄ±r", "belki", "elbette", "tabii", "asla", "daima", "bazen",
                "bir", "iki", "Ã¼Ã§", "dÃ¶rt", "beÅŸ", "on", "yÃ¼z", "bin", "milyon", "sayÄ±", "rakam", "matematik", "fen", "tarih"
            ],
            en: [
                "the", "be", "to", "of", "and", "a", "in", "that", "have", "it", "for", "not", "on", "with", "he", "as", "you", "do", "at", "this",
                "but", "his", "by", "from", "they", "we", "say", "her", "she", "or", "an", "will", "my", "one", "all", "would", "there", "their", "what", "so",
                "up", "out", "if", "about", "who", "get", "which", "go", "me", "when", "make", "can", "like", "time", "no", "just", "him", "know", "take", "people",
                "into", "year", "your", "good", "some", "could", "them", "see", "other", "than", "then", "now", "look", "only", "come", "its", "over", "think", "also", "back",
                "after", "use", "two", "how", "our", "work", "first", "well", "way", "even", "new", "want", "because", "any", "these", "give", "day", "most", "us", "water"
            ]
        };

        const translations = {
            tr: {
                menu: "Ana MenÃ¼", best: "EN Ä°YÄ°", unit: "KELÄ°ME", timeout: "SÃ¼re Doldu!", 
                resultLabel: "DoÄŸru Kelime", statKeys: "VuruÅŸ", statAcc: "DoÄŸruluk", 
                statDate: "Tarih", restart: "Tekrar Dene âŸ³", noRecord: "KayÄ±t Yok", 
                tips: "Mobil Ä°pucu: Otomatik dÃ¼zeltmeyi kapatÄ±rsan rekor kÄ±rarsÄ±n."
            },
            en: {
                menu: "Main Menu", best: "BEST", unit: "WORDS", timeout: "Time's Up!", 
                resultLabel: "Correct Words", statKeys: "Keystrokes", statAcc: "Accuracy", 
                statDate: "Date", restart: "Try Again âŸ³", noRecord: "No Record", 
                tips: "Mobile Tip: Disabling auto-correct will make typing smoother."
            }
        };

        let currentLang = 'tr';
        let timeLeft = 30;
        let maxTime = 30;
        let isTyping = false;
        let timer = null;
        let words = [];
        let currentWordIndex = 0;
        let currentCharIndex = 0;
        
        let completedCorrectWords = 0;
        let totalKeystrokes = 0;
        let correctKeystrokes = 0;

        const wordWrapper = document.getElementById("words-wrapper");
        const inputField = document.getElementById("input-field");
        const timerTag = document.getElementById("timer");
        const resultModal = document.getElementById("result-modal");
        
        const bestScoreTag = document.getElementById("best-score");
        const bestDateTag = document.getElementById("best-date");
        const recordModeLabel = document.getElementById("record-mode-label");

        window.onload = () => { 
            loadBestScore(maxTime); 
            setLanguage(currentLang); 
            resetGame(); 
        };

        function setLanguage(lang) {
            if (isTyping) return;
            currentLang = lang;
            document.querySelectorAll('.opt-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${lang}`).classList.add('active');
            
            const t = translations[lang];
            document.getElementById('ui-best').innerText = t.best;
            document.getElementById('ui-unit').innerText = t.unit;
            document.getElementById('ui-timeout').innerText = t.timeout;
            document.getElementById('ui-result-label').innerText = t.resultLabel;
            document.getElementById('ui-stat-keys').innerText = t.statKeys;
            document.getElementById('ui-stat-acc').innerText = t.statAcc;
            document.getElementById('ui-stat-date').innerText = t.statDate;
            document.getElementById('ui-restart').innerText = t.restart;
            document.getElementById('ui-tips').innerText = t.tips;

            loadBestScore(maxTime);
            resetGame();
        }

        function generateWords() {
            wordWrapper.innerHTML = "";
            words = [];
            const pool = wordPools[currentLang];
            for (let i = 0; i < 300; i++) {
                words.push(pool[Math.floor(Math.random() * pool.length)]);
            }
            renderWords();
        }

        function renderWords() {
            words.forEach(word => {
                const wordDiv = document.createElement("div");
                wordDiv.className = "word"; 
                word.split('').forEach(char => {
                    const span = document.createElement("span");
                    span.innerText = char;
                    span.className = "letter";
                    wordDiv.appendChild(span);
                });
                const spaceSpan = document.createElement("span");
                spaceSpan.innerHTML = "&nbsp;"; 
                spaceSpan.className = "letter space";
                wordDiv.appendChild(spaceSpan);
                wordWrapper.appendChild(wordDiv);
            });
            addClassToCurrentChar("active");
        }

        window.setTime = (time) => {
            if (isTyping) return;
            maxTime = time;
            timeLeft = time;
            timerTag.innerText = timeLeft;
            const timeBtns = document.getElementById("time-options").querySelectorAll(".opt-btn");
            timeBtns.forEach(btn => btn.classList.remove("active"));
            event.target.classList.add("active");
            loadBestScore(time);
            resetGame();
        }

        window.resetGame = () => {
            generateWords();
            clearInterval(timer);
            timeLeft = maxTime;
            timerTag.innerText = timeLeft;
            isTyping = false;
            
            // Input kilidini aÃ§
            inputField.disabled = false;
            
            currentWordIndex = 0;
            currentCharIndex = 0;
            completedCorrectWords = 0;
            totalKeystrokes = 0;
            correctKeystrokes = 0;
            
            inputField.value = "";
            wordWrapper.style.transform = "translateY(0px)";
            resultModal.style.display = "none";
            focusInput();
            const firstWord = wordWrapper.children[0];
            if(firstWord) firstWord.scrollIntoView({block: "start"});
        }

        inputField.addEventListener("input", (e) => {
            // EÄŸer sÃ¼re bittiyse yazmayÄ± engelle
            if (timeLeft <= 0) {
                inputField.disabled = true;
                return;
            }

            if (!isTyping && timeLeft > 0) {
                isTyping = true;
                timer = setInterval(initTimer, 1000);
            }

            const val = inputField.value.toLowerCase();
            const inputChar = val.slice(-1);
            const inputType = e.inputType;
            const currentWordDiv = wordWrapper.children[currentWordIndex];
            const chars = currentWordDiv.querySelectorAll(".letter");
            
            // Geri Silme (Backspace)
            if (inputType === "deleteContentBackward") {
                if (currentCharIndex > 0) {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    currentCharIndex--;
                    removeClassFromChar(currentWordIndex, currentCharIndex, "correct");
                    removeClassFromChar(currentWordIndex, currentCharIndex, "incorrect");
                    addClassToCurrentChar("active");
                }
                // Silme iÅŸleminde de scroll kontrolÃ¼ yap
                checkScroll();
                return;
            }

            if (currentCharIndex < chars.length) {
                totalKeystrokes++;
                const targetChar = chars[currentCharIndex].innerText.replace(/\u00a0/g, " ");
                
                // BOÅLUK TUÅUNA BASILDIÄINDA
                if (targetChar === " " && inputChar === " ") {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    
                    const hasMistake = currentWordDiv.querySelector(".incorrect");
                    
                    if (!hasMistake) {
                        completedCorrectWords++;
                    } else {
                        currentWordDiv.classList.add("error");
                    }

                    // Bir sonraki kelimeye geÃ§
                    currentWordIndex++;
                    currentCharIndex = 0;
                    
                    // Input'u temizle
                    inputField.value = "";

                    // Scroll KontrolÃ¼ (AÅAÄI KAYDIRMA Ä°ÅLEMÄ° BURADA)
                    checkScroll();

                    if (currentWordIndex < words.length) addClassToCurrentChar("active");
                } 
                // NORMAL HARF YAZILDIÄINDA
                else if (targetChar !== " ") {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    if (inputChar === targetChar) {
                        addClassToChar(currentWordIndex, currentCharIndex, "correct"); // YeÅŸil Yap
                        correctKeystrokes++;
                    } else {
                        addClassToChar(currentWordIndex, currentCharIndex, "incorrect"); // KÄ±rmÄ±zÄ± Yap
                    }
                    currentCharIndex++;
                    if (currentCharIndex < chars.length) addClassToCurrentChar("active");
                }
            }
        });

        function initTimer() {
            if (timeLeft > 0) {
                timeLeft--;
                timerTag.innerText = timeLeft;
            } else {
                finishGame();
            }
        }

        // --- SCROLL DÃœZELTMESÄ° ---
        function checkScroll() {
            const currentWord = wordWrapper.children[currentWordIndex];
            if (!currentWord) return;

            // Kelimenin kutu iÃ§indeki pozisyonu (offsetTop)
            const offsetTop = currentWord.offsetTop;
            // Kelimenin yÃ¼ksekliÄŸi (yaklaÅŸÄ±k 40-50px)
            const lineHeight = currentWord.offsetHeight; 
            
            // EÄŸer kelime 2. satÄ±ra indiyse (offsetTop > 0 veya belli bir piksel), yukarÄ± kaydÄ±r
            if (offsetTop > lineHeight) {
                // MantÄ±k: Aktif satÄ±rÄ± en Ã¼stte tutmak yerine, bir Ã¶nceki satÄ±rÄ± gizle
                // Wrapper'Ä± yukarÄ± Ã¶tele (translateY ile)
                // - (offsetTop - lineHeight) -> Aktif satÄ±rÄ± 2. sÄ±raya alÄ±r, daha doÄŸal gÃ¶rÃ¼nÃ¼r
                wordWrapper.style.transform = `translateY(-${offsetTop - lineHeight}px)`;
            } else {
                // En baÅŸtaysa sÄ±fÄ±rla
                wordWrapper.style.transform = "translateY(0px)";
            }
        }

        function finishGame() {
            clearInterval(timer);
            isTyping = false;
            
            // Inputu Kilitle
            inputField.disabled = true;
            inputField.value = ""; // Temizle
            
            let accuracy = 0;
            if (totalKeystrokes > 0) {
                accuracy = Math.round((correctKeystrokes / totalKeystrokes) * 100);
            }

            const now = new Date();
            const dateString = now.toLocaleDateString() + " - " + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

            document.getElementById("final-score").innerText = completedCorrectWords;
            document.getElementById("stat-keystrokes").innerText = totalKeystrokes;
            document.getElementById("stat-acc").innerText = `%${accuracy}`;
            document.getElementById("stat-date").innerText = dateString;

            resultModal.style.display = "flex";

            saveScore(completedCorrectWords, maxTime, dateString);
        }

        function saveScore(score, mode, dateStr) {
            const key = `hakan_records_${currentLang}`;
            let records = JSON.parse(localStorage.getItem(key)) || {};
            let currentRecord = records[mode] || { score: 0, date: "" };

            if (score > currentRecord.score) {
                records[mode] = { score: score, date: dateStr };
                localStorage.setItem(key, JSON.stringify(records));
                loadBestScore(mode);
            }
        }

        function loadBestScore(mode) {
            let label = mode === 180 ? (currentLang === 'tr' ? '3dk' : '3m') : mode + "s";
            recordModeLabel.innerText = label;
            const key = `hakan_records_${currentLang}`;
            let records = JSON.parse(localStorage.getItem(key)) || {};
            let recordData = records[mode];

            if (recordData) {
                bestScoreTag.innerText = recordData.score;
                bestDateTag.innerText = recordData.date;
            } else {
                bestScoreTag.innerText = 0;
                bestDateTag.innerText = translations[currentLang].noRecord;
            }
        }

        function addClassToCurrentChar(className) { addClassToChar(currentWordIndex, currentCharIndex, className); }
        function addClassToChar(wIdx, cIdx, className) {
            const w = wordWrapper.children[wIdx];
            if(w) { const c = w.querySelectorAll(".letter")[cIdx]; if(c) c.classList.add(className); }
        }
        function removeClassFromChar(wIdx, cIdx, className) {
            const w = wordWrapper.children[wIdx];
            if(w) { const c = w.querySelectorAll(".letter")[cIdx]; if(c) c.classList.remove(className); }
        }

        window.focusInput = () => { if(!inputField.disabled) inputField.focus(); }

        document.addEventListener("keydown", (e) => {
            if(e.key === "Tab") { e.preventDefault(); resetGame(); }
            if(!inputField.disabled) inputField.focus();
        });

    </script>
</body>
</html>
