<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HakanTools | Pro Typing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Inter:wght@400;600&display=swap');

        :root {
            --bg-color: #f0f2f5;
            --sidebar-bg: #ffffff;
            --text-main: #333333;
            --text-sub: #888888;
            --accent: #3b82f6; /* Mavi */
            --correct: #22c55e; /* Yeşil */
            --error: #ef4444; /* Kırmızı */
            --cursor: #3b82f6;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* --- SOL PANEL (Rekor ve Menü) --- */
        .sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            height: 100%;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e5e7eb;
            box-shadow: var(--shadow);
            z-index: 10;
        }

        .back-btn {
            text-decoration: none;
            color: var(--text-sub);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 3rem;
            transition: 0.2s;
        }

        .back-btn:hover { color: var(--accent); }

        .record-box {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .record-title { font-size: 0.9rem; color: var(--text-sub); margin-bottom: 5px; }
        .record-score { font-size: 2.5rem; font-weight: 800; color: var(--accent); }
        .record-unit { font-size: 1rem; color: var(--text-sub); }

        .tips {
            font-size: 0.85rem;
            color: var(--text-sub);
            line-height: 1.6;
            margin-top: auto;
        }

        /* --- ORTA ALAN (Oyun) --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Süre Seçimi */
        .config-bar {
            display: flex;
            gap: 10px;
            background: #ffffff;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .time-btn {
            background: none;
            border: none;
            padding: 5px 15px;
            cursor: pointer;
            color: var(--text-sub);
            font-weight: 600;
            border-radius: 20px;
            transition: 0.2s;
        }

        .time-btn.active, .time-btn:hover {
            background-color: var(--accent);
            color: white;
        }

        /* Canlı İstatistikler */
        .live-stats {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 1rem;
            font-family: 'Roboto Mono', monospace;
        }

        /* Yazı Alanı */
        .typing-container {
            width: 900px;
            max-width: 90%;
            height: 160px; /* Yaklaşık 3 satır yüksekliği */
            overflow: hidden;
            position: relative;
            background: #ffffff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            cursor: text;
        }

        /* Kelimeler ve Harfler */
        .words-wrapper {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.6rem;
            line-height: 2.5rem;
            color: #9ca3af; /* Pasif kelime rengi (gri) */
            user-select: none;
            transition: transform 0.2s ease;
        }

        .word { margin-right: 12px; display: inline-block; }
        
        .letter { position: relative; }

        .letter.correct { color: var(--correct); } /* Doğru Yeşil */
        .letter.incorrect { color: var(--error); text-decoration: underline; } /* Yanlış Kırmızı */
        
        /* İmleç */
        .letter.active::before {
            content: '';
            position: absolute;
            left: 0;
            bottom: 2px;
            width: 2px;
            height: 80%;
            background-color: var(--cursor);
            animation: blink 1s infinite;
        }

        .letter.active.is-space::before { left: 50%; } /* Boşluktayken imleç ortada */

        @keyframes blink { 50% { opacity: 0; } }

        /* Gizli Input */
        #input-field { position: absolute; opacity: 0; z-index: -99; }

        /* --- SONUÇ EKRANI (Modal) --- */
        .result-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none; /* JS ile açılacak */
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .result-card {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            text-align: center;
            border: 1px solid #e5e7eb;
            max-width: 500px;
            width: 90%;
        }

        .result-title { font-size: 1.5rem; color: var(--text-sub); margin-bottom: 1rem; }
        .result-wpm { font-size: 4rem; color: var(--accent); font-weight: 800; line-height: 1; }
        .result-acc { font-size: 1.2rem; color: var(--correct); font-weight: 600; margin-bottom: 2rem; }
        
        .grid-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 2rem;
            text-align: left;
        }

        .stat-item { background: #f3f4f6; padding: 10px; border-radius: 8px; font-size: 0.9rem; }
        .stat-item b { display: block; font-size: 1.1rem; color: var(--text-main); }

        .restart-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: 600;
        }
        .restart-btn:hover { background: #2563eb; transform: translateY(-2px); }

    </style>
</head>
<body>

    <aside class="sidebar">
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Ana Menü</a>
        
        <div class="record-box">
            <div class="record-title">EN İYİ REKORUN</div>
            <div class="record-score" id="best-wpm">0</div>
            <div class="record-unit">WPM</div>
        </div>

        <div class="tips">
            <b>İpucu:</b><br>
            Hızlı yazmak için değil, akıcı yazmak için çalış. Hataları düzeltmek zaman kaybettirir. <br><br>
            <i>Yeniden başlatmak için <b>TAB</b> tuşuna basabilirsin.</i>
        </div>
    </aside>

    <main class="main-content">
        
        <div class="config-bar" id="time-options">
            <button class="time-btn" onclick="setTime(15)">15s</button>
            <button class="time-btn active" onclick="setTime(30)">30s</button>
            <button class="time-btn" onclick="setTime(60)">60s</button>
            <button class="time-btn" onclick="setTime(180)">3dk</button>
        </div>

        <div class="live-stats" id="timer">30</div>

        <div class="typing-container" onclick="focusInput()">
            <div class="words-wrapper" id="words-wrapper">
                </div>
        </div>
        
        <input type="text" id="input-field" autocomplete="off">
    </main>

    <div class="result-modal" id="result-modal">
        <div class="result-card">
            <div class="result-title">Süre Doldu!</div>
            <div class="result-wpm" id="final-wpm">0</div>
            <div class="result-acc" id="final-acc">%100 Doğruluk</div>
            
            <div class="grid-stats">
                <div class="stat-item">Doğru Vuruş <b id="stat-correct" style="color:var(--correct)">0</b></div>
                <div class="stat-item">Yanlış Vuruş <b id="stat-wrong" style="color:var(--error)">0</b></div>
                <div class="stat-item">Toplam Karakter <b id="stat-total">0</b></div>
                <div class="stat-item">Tarih <b id="stat-date">--</b></div>
            </div>

            <button class="restart-btn" onclick="resetGame()">Tekrar Dene</button>
        </div>
    </div>

    <script>
        // --- KELİME HAVUZU (300+ Temel Kelime - Sonsuz döngüde kullanılacak) ---
        const wordPool = [
            "ben", "sen", "o", "biz", "siz", "onlar", "ve", "ile", "ama", "fakat", "lakin", "çünkü", "veya", "ya", "da", "de",
            "gelmek", "gitmek", "yapmak", "etmek", "olmak", "almak", "vermek", "sevmek", "bilmek", "görmek", "bakmak", "duymak",
            "yazmak", "okumak", "konuşmak", "anlamak", "düşünmek", "başlamak", "bitirmek", "çalışmak", "oynamak", "koşmak", "yürümek",
            "ev", "okul", "iş", "araba", "masa", "sandalye", "kalem", "defter", "kitap", "bilgisayar", "telefon", "internet",
            "sabah", "öğle", "akşam", "gece", "bugün", "yarın", "dün", "şimdi", "sonra", "önce", "zaman", "saat", "dakika",
            "güzel", "çirkin", "iyi", "kötü", "büyük", "küçük", "uzun", "kısa", "zor", "kolay", "sıcak", "soğuk", "yeni", "eski",
            "kırmızı", "mavi", "yeşil", "sarı", "siyah", "beyaz", "turuncu", "mor", "pembe", "gri", "kahverengi", "renk",
            "insan", "çocuk", "kadın", "erkek", "anne", "baba", "kardeş", "arkadaş", "öğretmen", "doktor", "mühendis", "polis",
            "elma", "armut", "muz", "çilek", "ekmek", "su", "süt", "çay", "kahve", "yemek", "kahvaltı", "akşam", "lezzetli",
            "mutlu", "üzgün", "kızgın", "şaşkın", "korkmuş", "heyecanlı", "yorgun", "hızlı", "yavaş", "güçlü", "zayıf",
            "Türkiye", "İstanbul", "Ankara", "İzmir", "dünya", "güneş", "ay", "yıldız", "deniz", "dağ", "orman", "hava",
            "proje", "kod", "yazılım", "teknoloji", "veri", "sistem", "klavye", "ekran", "fare", "dosya", "klasör", "uygulama",
            "başarı", "hata", "kontrol", "sonuç", "rapor", "analiz", "tasarım", "geliştirme", "test", "demo", "versiyon",
            "lütfen", "teşekkür", "merhaba", "hoşçakal", "evet", "hayır", "belki", "elbette", "tabii", "asla", "daima", "bazen",
            "bir", "iki", "üç", "dört", "beş", "on", "yüz", "bin", "milyon", "sayı", "rakam", "matematik", "fen", "tarih",
            "müzik", "resim", "spor", "futbol", "basketbol", "voleybol", "yüzme", "koşu", "antrenman", "maç", "takım", "oyuncu",
            "film", "dizi", "sinema", "tiyatro", "sanat", "kültür", "gezi", "tatil", "uçak", "otobüs", "tren", "gemi", "yol",
            "cadde", "sokak", "mahalle", "şehir", "ülke", "kıta", "adres", "konum", "harita", "yön", "sağ", "sol", "ileri", "geri"
        ];

        // Değişkenler
        let timeLeft = 30;
        let maxTime = 30;
        let isTyping = false;
        let timer = null;
        let words = [];
        let currentWordIndex = 0;
        let currentCharIndex = 0;
        
        let correctKeystrokes = 0;
        let wrongKeystrokes = 0;

        // HTML Elemanları
        const wordWrapper = document.getElementById("words-wrapper");
        const inputField = document.getElementById("input-field");
        const timerTag = document.getElementById("timer");
        const resultModal = document.getElementById("result-modal");
        const timeBtns = document.querySelectorAll(".time-btn");

        // Başlangıç
        window.onload = () => {
            loadBestScore();
            resetGame();
        };

        // --- FONKSİYONLAR ---

        // Kelimeleri Karıştır ve Hazırla (Sonsuz hissi için rastgele seçer)
        function generateWords() {
            wordWrapper.innerHTML = "";
            words = [];
            // Başlangıç için 100 kelime üretelim, bittikçe ekleriz (Logic basitleştirildi: tek seferde 100 yeterli, 
            // ama aşağıda satır kaydırma mantığı ile yöneteceğiz).
            // Kullanıcı isteğine göre 2000 kelimeye kadar destekli olması için
            // rastgele seçim yapıp büyük bir liste oluşturuyoruz.
            
            for (let i = 0; i < 300; i++) {
                const randomWord = wordPool[Math.floor(Math.random() * wordPool.length)];
                words.push(randomWord);
            }
            renderWords();
        }

        // Kelimeleri Ekrana Bas (HTML Olarak)
        function renderWords() {
            words.forEach(word => {
                const wordDiv = document.createElement("div");
                wordDiv.className = "word";
                
                // Harfler
                word.split('').forEach(char => {
                    const span = document.createElement("span");
                    span.innerText = char;
                    span.className = "letter";
                    wordDiv.appendChild(span);
                });
                
                // Kelime sonu boşluğu (hayali bir karakter gibi davranır)
                const spaceSpan = document.createElement("span");
                spaceSpan.innerHTML = "&nbsp;"; // Görünmez boşluk
                spaceSpan.className = "letter space";
                wordDiv.appendChild(spaceSpan);

                wordWrapper.appendChild(wordDiv);
            });
            // İlk harfi aktif yap
            addClassToCurrentChar("active");
        }

        // Süre Ayarlama
        window.setTime = (time) => {
            if (isTyping) return; // Oyun sırasındaysa değiştirme
            maxTime = time;
            timeLeft = time;
            timerTag.innerText = timeLeft;
            
            // Buton görselliği
            timeBtns.forEach(btn => btn.classList.remove("active"));
            event.target.classList.add("active");
            
            resetGame();
        }

        // Oyunu Sıfırla
        window.resetGame = () => {
            generateWords();
            clearInterval(timer);
            timeLeft = maxTime;
            timerTag.innerText = timeLeft;
            isTyping = false;
            currentWordIndex = 0;
            currentCharIndex = 0;
            correctKeystrokes = 0;
            wrongKeystrokes = 0;
            inputField.value = "";
            wordWrapper.style.transform = "translateY(0px)"; // Satır kaydırmayı sıfırla
            resultModal.style.display = "none";
            focusInput();
            
            // Satır konumunu takip etmek için
            // İlk kelimeye odaklan
            const firstWord = wordWrapper.children[0];
            if(firstWord) firstWord.scrollIntoView({block: "start"});
        }

        // Yazma Mantığı
        inputField.addEventListener("input", (e) => {
            if (!isTyping && timeLeft > 0) {
                isTyping = true;
                timer = setInterval(initTimer, 1000);
            }

            const val = inputField.value;
            const inputChar = val.slice(-1); // Son yazılan karakter
            const inputType = e.inputType; // "deleteContentBackward" vb.

            const currentWordDiv = wordWrapper.children[currentWordIndex];
            const chars = currentWordDiv.querySelectorAll(".letter");
            
            // --- BACKSPACE (SİLME) ---
            if (inputType === "deleteContentBackward") {
                if (currentCharIndex > 0) {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    currentCharIndex--;
                    removeClassFromChar(currentWordIndex, currentCharIndex, "correct");
                    removeClassFromChar(currentWordIndex, currentCharIndex, "incorrect");
                    addClassToCurrentChar("active");
                }
                return;
            }

            // --- NORMAL YAZMA ---
            if (currentCharIndex < chars.length) {
                const targetChar = chars[currentCharIndex].innerText.replace(/\u00a0/g, " "); // &nbsp; 'yi boşluğa çevir
                
                // Boşluk Tuşu Kontrolü (Kelime geçişi)
                if (targetChar === " " && inputChar === " ") {
                    // Kelime bitti, sonrakine geç
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    currentWordIndex++;
                    currentCharIndex = 0;
                    
                    // Satır Kaydırma Kontrolü
                    checkScroll();
                    
                    if (currentWordIndex < words.length) {
                        addClassToCurrentChar("active");
                    }
                    correctKeystrokes++; // Boşluk da doğru sayılır
                    inputField.value = ""; // Inputu temizle ki şişmesin
                } 
                // Harf Kontrolü
                else if (targetChar !== " ") {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    
                    if (inputChar === targetChar) {
                        addClassToChar(currentWordIndex, currentCharIndex, "correct");
                        correctKeystrokes++;
                    } else {
                        addClassToChar(currentWordIndex, currentCharIndex, "incorrect");
                        wrongKeystrokes++;
                    }
                    
                    currentCharIndex++;
                    if (currentCharIndex < chars.length) {
                        addClassToCurrentChar("active");
                    }
                }
            }
        });

        // Sayaç
        function initTimer() {
            if (timeLeft > 0) {
                timeLeft--;
                timerTag.innerText = timeLeft;
            } else {
                finishGame();
            }
        }

        // Satır Kaydırma (Scrolling)
        function checkScroll() {
            const currentWordDiv = wordWrapper.children[currentWordIndex];
            const prevWordDiv = wordWrapper.children[currentWordIndex - 1];

            // Eğer şu anki kelimenin "top" değeri (Y konumu), bir önceki kelimeden farklıysa
            // demek ki yeni bir satıra geçtik.
            if (prevWordDiv && currentWordDiv.offsetTop > prevWordDiv.offsetTop) {
                // Kaç piksel aşağı indi?
                const lineHeight = 40; // CSS line-height ile uyumlu olmalı (2.5rem = 40px)
                
                // Şu anki transform değerini al (örn: translateY(-40px))
                const currentTransform = parseInt(wordWrapper.style.transform.replace("translateY(", "").replace("px)", "") || 0);
                
                // Bir satır yukarı kaydır
                wordWrapper.style.transform = `translateY(${currentTransform - lineHeight}px)`;
            }
        }

        // Oyun Bitişi
        function finishGame() {
            clearInterval(timer);
            isTyping = false;
            
            // Hesaplamalar
            const totalChars = correctKeystrokes + wrongKeystrokes;
            const minutes = (maxTime - timeLeft) / 60; // Geçen süre (aslında süre bitince maxTime/60)
            
            // WPM Formülü: (Doğru Karakter / 5) / Dakika
            // Eğer süre bitmeden bittiyse (imkansız ama olsun)
            const timeSpent = maxTime - timeLeft;
            const timeInMin = timeSpent > 0 ? timeSpent / 60 : maxTime / 60;

            let wpm = Math.round((correctKeystrokes / 5) / (maxTime / 60)); 
            if (wpm < 0 || isNaN(wpm)) wpm = 0;

            let accuracy = Math.round((correctKeystrokes / (totalChars > 0 ? totalChars : 1)) * 100);

            // Sonuçları Yaz
            document.getElementById("final-wpm").innerText = wpm;
            document.getElementById("final-acc").innerText = `%${accuracy} Doğruluk`;
            document.getElementById("stat-correct").innerText = correctKeystrokes;
            document.getElementById("stat-wrong").innerText = wrongKeystrokes;
            document.getElementById("stat-total").innerText = totalChars;
            document.getElementById("stat-date").innerText = new Date().toLocaleDateString('tr-TR');

            resultModal.style.display = "flex";

            // Rekor Kaydet
            saveScore(wpm);
        }

        // Helper: Class Ekle/Çıkar
        function addClassToCurrentChar(className) {
            addClassToChar(currentWordIndex, currentCharIndex, className);
        }
        function addClassToChar(wIdx, cIdx, className) {
            const w = wordWrapper.children[wIdx];
            if(w) {
                const c = w.querySelectorAll(".letter")[cIdx];
                if(c) c.classList.add(className);
            }
        }
        function removeClassFromChar(wIdx, cIdx, className) {
            const w = wordWrapper.children[wIdx];
            if(w) {
                const c = w.querySelectorAll(".letter")[cIdx];
                if(c) c.classList.remove(className);
            }
        }

        // Odaklanma
        window.focusInput = () => {
            inputField.focus();
        }

        // Rekor İşlemleri (Local Storage)
        function saveScore(wpm) {
            let best = localStorage.getItem("hakan_best_wpm") || 0;
            if (wpm > best) {
                localStorage.setItem("hakan_best_wpm", wpm);
                best = wpm;
            }
            loadBestScore();
        }

        function loadBestScore() {
            let best = localStorage.getItem("hakan_best_wpm") || 0;
            document.getElementById("best-wpm").innerText = best;
        }

        // Tab tuşu ile reset
        document.addEventListener("keydown", (e) => {
            if(e.key === "Tab") {
                e.preventDefault();
                resetGame();
            }
            inputField.focus();
        });

    </script>
</body>
</html>
