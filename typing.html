<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HakanTools | Kelime Avcısı</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Inter:wght@400;600&display=swap');

        :root {
            --bg-color: #f0f2f5;
            --sidebar-bg: #ffffff;
            --text-main: #333333;
            --text-sub: #888888;
            --accent: #3b82f6; /* Ana Renk */
            --correct: #22c55e;
            --error: #ef4444;
            --cursor: #3b82f6;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* --- SOL PANEL --- */
        .sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            height: 100%;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e5e7eb;
            box-shadow: var(--shadow);
            z-index: 10;
        }

        .back-btn {
            text-decoration: none;
            color: var(--text-sub);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 3rem;
            transition: 0.2s;
        }
        .back-btn:hover { color: var(--accent); }

        /* Rekor Kutusu */
        .record-box {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 2rem;
            transition: 0.3s;
        }
        .record-box:hover { border-color: var(--accent); transform: translateY(-2px); }

        .record-title { font-size: 0.8rem; color: var(--text-sub); margin-bottom: 5px; text-transform: uppercase; font-weight: 700; }
        .record-score { font-size: 3rem; font-weight: 800; color: var(--accent); line-height: 1; margin: 10px 0; }
        .record-unit { font-size: 0.9rem; color: var(--text-sub); font-weight: 600; }
        
        .record-date {
            margin-top: 10px;
            font-size: 0.75rem;
            color: #94a3b8;
            border-top: 1px solid #e2e8f0;
            padding-top: 8px;
        }

        .tips {
            font-size: 0.85rem;
            color: var(--text-sub);
            line-height: 1.6;
            margin-top: auto;
            border-top: 1px solid #e5e7eb;
            padding-top: 1rem;
        }

        /* --- ORTA ALAN --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .config-bar {
            display: flex;
            gap: 10px;
            background: #ffffff;
            padding: 8px 15px;
            border-radius: 50px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .time-btn {
            background: none;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            color: var(--text-sub);
            font-weight: 600;
            border-radius: 20px;
            transition: 0.2s;
            font-size: 0.9rem;
        }

        .time-btn.active, .time-btn:hover {
            background-color: var(--accent);
            color: white;
        }

        .live-stats {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 1.5rem;
            font-family: 'Roboto Mono', monospace;
            background: white;
            padding: 10px 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .typing-container {
            width: 900px;
            max-width: 90%;
            height: 160px;
            overflow: hidden;
            position: relative;
            background: #ffffff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            cursor: text;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }
        
        .typing-container:focus-within {
            border-color: var(--accent); /* Yazarken çerçeve mavi olsun */
        }

        .words-wrapper {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.6rem;
            line-height: 2.5rem;
            color: #9ca3af;
            user-select: none;
            transition: transform 0.2s ease;
        }

        .word { margin-right: 12px; display: inline-block; border-bottom: 2px solid transparent; }
        /* Hata yapılan kelimenin altını kırmızı çizelim ki belli olsun */
        .word.error-word { border-bottom-color: var(--error); }

        .letter { position: relative; }
        .letter.correct { color: var(--correct); }
        .letter.incorrect { color: var(--error); }
        
        .letter.active::before {
            content: '';
            position: absolute;
            left: 0; bottom: 2px; width: 2px; height: 80%;
            background-color: var(--cursor);
            animation: blink 1s infinite;
        }
        .letter.active.is-space::before { left: 50%; }

        @keyframes blink { 50% { opacity: 0; } }

        #input-field { position: absolute; opacity: 0; z-index: -99; }

        /* SONUÇ MODALI */
        .result-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: none;
            justify-content: center; align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .result-card {
            background: white; padding: 3rem; border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            text-align: center; border: 1px solid #e5e7eb;
            max-width: 450px; width: 90%;
        }

        .result-title { font-size: 1.5rem; color: var(--text-sub); margin-bottom: 0.5rem; }
        .result-score { font-size: 5rem; color: var(--accent); font-weight: 800; line-height: 1; margin-bottom: 0.5rem; }
        .result-label { font-size: 1.2rem; color: var(--text-main); font-weight: 600; margin-bottom: 2rem; }
        
        .grid-stats {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
            margin-bottom: 2rem; text-align: left;
        }
        .stat-item { background: #f3f4f6; padding: 12px; border-radius: 8px; font-size: 0.9rem; }
        .stat-item span { display: block; color: var(--text-sub); font-size: 0.8rem; margin-bottom: 3px;}
        .stat-item b { display: block; font-size: 1.1rem; color: var(--text-main); }

        .restart-btn {
            background: var(--accent); color: white; border: none;
            padding: 15px 40px; font-size: 1.1rem; border-radius: 10px;
            cursor: pointer; transition: 0.2s; font-weight: 600;
            width: 100%;
        }
        .restart-btn:hover { background: #2563eb; transform: translateY(-2px); }
    </style>
</head>
<body>

    <aside class="sidebar">
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Ana Menü</a>
        
        <div class="record-box">
            <div class="record-title">EN İYİ REKOR (<span id="record-mode-label">30s</span>)</div>
            <div class="record-score" id="best-score">0</div>
            <div class="record-unit">DOĞRU KELİME</div>
            <div class="record-date" id="best-date">Kayıt Yok</div>
        </div>

        <div class="tips">
            <b>Nasıl Çalışır?</b><br>
            Yanlış yazdığın kelimeler puana eklenmez. Sadece <u>hatasız</u> bitirdiğin kelimeler sayılır.<br><br>
            <i>Hızlı reset: <b>TAB</b></i>
        </div>
    </aside>

    <main class="main-content">
        <div class="config-bar" id="time-options">
            <button class="time-btn" onclick="setTime(15)">15 sn</button>
            <button class="time-btn active" onclick="setTime(30)">30 sn</button>
            <button class="time-btn" onclick="setTime(60)">60 sn</button>
            <button class="time-btn" onclick="setTime(180)">3 dk</button>
        </div>

        <div class="live-stats" id="timer">30</div>

        <div class="typing-container" onclick="focusInput()">
            <div class="words-wrapper" id="words-wrapper"></div>
        </div>
        
        <input type="text" id="input-field" autocomplete="off">
    </main>

    <div class="result-modal" id="result-modal">
        <div class="result-card">
            <div class="result-title">Süre Doldu!</div>
            <div class="result-score" id="final-score">0</div>
            <div class="result-label">Doğru Kelime</div>
            
            <div class="grid-stats">
                <div class="stat-item">
                    <span>Toplam Vuruş</span>
                    <b id="stat-keystrokes">0</b>
                </div>
                <div class="stat-item">
                    <span>Doğruluk</span>
                    <b id="stat-acc">%0</b>
                </div>
                <div class="stat-item" style="grid-column: span 2;">
                    <span>Tarih</span>
                    <b id="stat-date">--</b>
                </div>
            </div>

            <button class="restart-btn" onclick="resetGame()">Tekrar Dene</button>
        </div>
    </div>

    <script>
        // --- 1000 KELİME HAVUZU ---
        const wordPool = [
            "ben", "sen", "o", "biz", "siz", "onlar", "ve", "ile", "ama", "fakat", "lakin", "çünkü", "veya", "ya", "da", "de",
            "gelmek", "gitmek", "yapmak", "etmek", "olmak", "almak", "vermek", "sevmek", "bilmek", "görmek", "bakmak", "duymak",
            "yazmak", "okumak", "konuşmak", "anlamak", "düşünmek", "başlamak", "bitirmek", "çalışmak", "oynamak", "koşmak", "yürümek",
            "ev", "okul", "iş", "araba", "masa", "sandalye", "kalem", "defter", "kitap", "bilgisayar", "telefon", "internet",
            "sabah", "öğle", "akşam", "gece", "bugün", "yarın", "dün", "şimdi", "sonra", "önce", "zaman", "saat", "dakika",
            "güzel", "çirkin", "iyi", "kötü", "büyük", "küçük", "uzun", "kısa", "zor", "kolay", "sıcak", "soğuk", "yeni", "eski",
            "kırmızı", "mavi", "yeşil", "sarı", "siyah", "beyaz", "turuncu", "mor", "pembe", "gri", "kahverengi", "renk",
            "insan", "çocuk", "kadın", "erkek", "anne", "baba", "kardeş", "arkadaş", "öğretmen", "doktor", "mühendis", "polis",
            "elma", "armut", "muz", "çilek", "ekmek", "su", "süt", "çay", "kahve", "yemek", "kahvaltı", "akşam", "lezzetli",
            "mutlu", "üzgün", "kızgın", "şaşkın", "korkmuş", "heyecanlı", "yorgun", "hızlı", "yavaş", "güçlü", "zayıf",
            "Türkiye", "İstanbul", "Ankara", "İzmir", "dünya", "güneş", "ay", "yıldız", "deniz", "dağ", "orman", "hava",
            "proje", "kod", "yazılım", "teknoloji", "veri", "sistem", "klavye", "ekran", "fare", "dosya", "klasör", "uygulama",
            "başarı", "hata", "kontrol", "sonuç", "rapor", "analiz", "tasarım", "geliştirme", "test", "demo", "versiyon",
            "lütfen", "teşekkür", "merhaba", "hoşçakal", "evet", "hayır", "belki", "elbette", "tabii", "asla", "daima", "bazen",
            "bir", "iki", "üç", "dört", "beş", "on", "yüz", "bin", "milyon", "sayı", "rakam", "matematik", "fen", "tarih",
            "müzik", "resim", "spor", "futbol", "basketbol", "voleybol", "yüzme", "koşu", "antrenman", "maç", "takım", "oyuncu",
            "film", "dizi", "sinema", "tiyatro", "sanat", "kültür", "gezi", "tatil", "uçak", "otobüs", "tren", "gemi", "yol",
            "cadde", "sokak", "mahalle", "şehir", "ülke", "kıta", "adres", "konum", "harita", "yön", "sağ", "sol", "ileri", "geri",
            "aile", "bebek", "dede", "nene", "hala", "teyze", "amca", "dayı", "kuzen", "komşu", "misafir", "yabancı", "halk",
            "devlet", "millet", "bayrak", "vatan", "toprak", "sınır", "asker", "ordu", "silah", "barış", "savaş", "zafer",
            "göz", "kulak", "burun", "ağız", "diş", "dil", "kol", "bacak", "el", "ayak", "parmak", "tırnak", "saç", "baş",
            "kalp", "mide", "ciğer", "kan", "damar", "kemik", "deri", "beyin", "akıl", "fikir", "ruh", "can", "nefes",
            "giyim", "kıyafet", "elbise", "gömlek", "pantolon", "ceket", "ayakkabı", "çorap", "şapka", "atkı", "eldiven", "kemer",
            "oda", "salon", "mutfak", "banyo", "tuvalet", "balkon", "bahçe", "kapı", "pencere", "duvar", "tavan", "taban",
            "yatak", "yorgan", "yastık", "çarşaf", "halı", "perde", "lamba", "ayna", "dolap", "çekmece", "raf", "kutu",
            "cam", "demir", "tahta", "plastik", "kağıt", "karton", "kumaş", "deri", "altın", "gümüş", "bakır", "taş",
            "kedi", "köpek", "kuş", "balık", "at", "eşek", "inek", "koyun", "keçi", "tavuk", "horoz", "ördek", "kaz",
            "aslan", "kaplan", "ayı", "kurt", "tilki", "tavşan", "fare", "yılan", "böcek", "arı", "sinek", "kelebek",
            "ağaç", "çiçek", "gül", "lale", "papatya", "çimen", "yaprak", "dal", "kök", "meyve", "sebze", "tohum",
            "domates", "biber", "patlıcan", "soğan", "sarımsak", "havuç", "patates", "salatalık", "marul", "maydanoz", "nane",
            "et", "tavuk", "balık", "sucuk", "salam", "sosis", "yumurta", "peynir", "zeytin", "yağ", "bal", "reçel",
            "tuz", "şeker", "biber", "baharat", "un", "pirinç", "makarna", "çorba", "pilav", "dolma", "sarma", "börek",
            "tatlı", "pasta", "kek", "kurabiye", "dondurma", "çikolata", "bisküvi", "sakız", "meyve suyu", "gazoz", "ayran",
            "tabak", "çatal", "kaşık", "bıçak", "bardak", "kupa", "sürahi", "tencere", "tava", "tepsi", "fırın", "ocak",
            "buzdolabı", "çamaşır", "bulaşık", "ütü", "süpürge", "kovası", "bez", "deterjan", "sabun", "şampuan", "havlu",
            "koltuk", "kanepe", "sehpa", "vitrin", "televizyon", "radyo", "kamera", "fotoğraf", "resim", "müzik", "şarkı",
            "söz", "beste", "nota", "ritim", "dans", "eğlence", "parti", "doğum günü", "düğün", "nişan", "kına", "bayram",
            "yılbaşı", "hediye", "sürpriz", "kutlama", "tebrik", "başarı", "ödül", "madalya", "kupa", "derece", "rekor",
            "para", "lira", "dolar", "euro", "banka", "kredi", "kart", "borç", "alacak", "hesap", "fatura", "fiş",
            "market", "bakkal", "manav", "kasap", "fırın", "eczane", "hastane", "okul", "üniversite", "sınıf", "ders",
            "sınav", "not", "karne", "diploma", "mezuniyet", "ödev", "proje", "sunum", "toplantı", "ofis", "büro",
            "şirket", "firma", "fabrika", "atölye", "depo", "mağaza", "dükkan", "alışveriş", "satış", "pazarlama", "reklam",
            "müşteri", "patron", "işçi", "memur", "müdür", "şef", "başkan", "yönetici", "lider", "ortak", "rakip",
            "siyaset", "politika", "seçim", "oy", "sandık", "parti", "bakan", "vekil", "meclis", "yasa", "kanun",
            "hak", "hukuk", "adalet", "mahkeme", "hakim", "savcı", "avukat", "dava", "suç", "ceza", "hapis",
            "haber", "gazete", "dergi", "televizyon", "radyo", "internet", "sosyal medya", "mesaj", "mail", "mektup", "zarf",
            "telefon", "hat", "numara", "arama", "konuşma", "sohbet", "muhabbet", "tartışma", "kavga", "barış", "anlaşma",
            "sevgi", "aşk", "nefret", "korku", "cesaret", "umut", "hayal", "gerçek", "yalan", "doğru", "yanlış",
            "bilgi", "cahil", "alim", "bilgin", "uzman", "usta", "çırak", "kalfa", "beceri", "yetenek", "zeka",
            "soru", "cevap", "çözüm", "sorun", "problem", "dert", "çare", "ilaç", "tedavi", "hastalık", "sağlık",
            "hayat", "yaşam", "ölüm", "cenaze", "mezar", "toprak", "ruh", "melek", "şeytan", "cennet", "cehennem",
            "din", "iman", "inanç", "dua", "ibadet", "cami", "kilise", "havra", "tapınak", "ezan", "çan",
            "tarih", "geçmiş", "gelecek", "anı", "hatıra", "unutmak", "hatırlamak", "öğrenmek", "öğretmek", "eğitim", "kültür",
            "gezi", "seyahat", "turist", "rehber", "otel", "pansiyon", "kamp", "çadır", "doğa", "manzara", "fotoğraf",
            "trafik", "kaza", "yol", "köprü", "tünel", "kavşak", "ışık", "levha", "ehliyet", "ceza", "radar",
            "hız", "sürat", "mesafe", "uzak", "yakın", "yüksek", "alçak", "derin", "sığ", "geniş", "dar",
            "ağır", "hafif", "sert", "yumuşak", "katı", "sıvı", "gaz", "ateş", "buz", "buhar", "duman",
            "enerji", "elektrik", "pil", "akü", "motor", "benzin", "mazot", "gaz", "petrol", "kömür", "maden",
            "demir", "çelik", "alüminyum", "plastik", "cam", "beton", "tuğla", "çimento", "kum", "kireç", "boya",
            "inşaat", "bina", "apartman", "kule", "gökdelen", "saray", "köşk", "yalı", "villa", "kulübe", "baraka",
            "tarla", "bağ", "bahçe", "çiftlik", "köy", "kasaba", "ilçe", "şehir", "başkent", "merkez", "taşra",
            "kuzey", "güney", "doğu", "batı", "lodos", "poyraz", "rüzgar", "fırtına", "yağmur", "kar", "dolu",
            "sis", "bulut", "gökkuşağı", "yıldırım", "şimşek", "deprem", "sel", "yangın", "çığ", "heyelan", "kuraklık",
            "çöl", "vaha", "okyanus", "körfez", "boğaz", "ada", "yarımada", "kıyı", "sahil", "plaj", "kumsal",
            "dalga", "akıntı", "derinlik", "yüzey", "dip", "zirve", "yamaç", "vadi", "ova", "plato", "tepe"
        ];

        let timeLeft = 30;
        let maxTime = 30;
        let isTyping = false;
        let timer = null;
        let words = [];
        let currentWordIndex = 0;
        let currentCharIndex = 0;
        
        // Yeni sayaçlar
        let completedCorrectWords = 0; // Sadece tamamen doğru bitenler
        let totalKeystrokes = 0;
        let correctKeystrokes = 0; // Doğruluk yüzdesi için

        const wordWrapper = document.getElementById("words-wrapper");
        const inputField = document.getElementById("input-field");
        const timerTag = document.getElementById("timer");
        const resultModal = document.getElementById("result-modal");
        const timeBtns = document.querySelectorAll(".time-btn");
        
        // Rekor Elemanları
        const bestScoreTag = document.getElementById("best-score");
        const bestDateTag = document.getElementById("best-date");
        const recordModeLabel = document.getElementById("record-mode-label");

        window.onload = () => {
            loadBestScore(maxTime);
            resetGame();
        };

        function generateWords() {
            wordWrapper.innerHTML = "";
            words = [];
            for (let i = 0; i < 300; i++) {
                const randomWord = wordPool[Math.floor(Math.random() * wordPool.length)];
                words.push(randomWord);
            }
            renderWords();
        }

        function renderWords() {
            words.forEach(word => {
                const wordDiv = document.createElement("div");
                wordDiv.className = "word";
                word.split('').forEach(char => {
                    const span = document.createElement("span");
                    span.innerText = char;
                    span.className = "letter";
                    wordDiv.appendChild(span);
                });
                const spaceSpan = document.createElement("span");
                spaceSpan.innerHTML = "&nbsp;"; 
                spaceSpan.className = "letter space";
                wordDiv.appendChild(spaceSpan);
                wordWrapper.appendChild(wordDiv);
            });
            addClassToCurrentChar("active");
        }

        window.setTime = (time) => {
            if (isTyping) return;
            maxTime = time;
            timeLeft = time;
            timerTag.innerText = timeLeft;
            
            timeBtns.forEach(btn => btn.classList.remove("active"));
            event.target.classList.add("active");
            
            loadBestScore(time);
            resetGame();
        }

        window.resetGame = () => {
            generateWords();
            clearInterval(timer);
            timeLeft = maxTime;
            timerTag.innerText = timeLeft;
            isTyping = false;
            
            // Sayaçları Sıfırla
            currentWordIndex = 0;
            currentCharIndex = 0;
            completedCorrectWords = 0;
            totalKeystrokes = 0;
            correctKeystrokes = 0;
            
            inputField.value = "";
            wordWrapper.style.transform = "translateY(0px)";
            resultModal.style.display = "none";
            focusInput();
            const firstWord = wordWrapper.children[0];
            if(firstWord) firstWord.scrollIntoView({block: "start"});
        }

        inputField.addEventListener("input", (e) => {
            if (!isTyping && timeLeft > 0) {
                isTyping = true;
                timer = setInterval(initTimer, 1000);
            }

            const val = inputField.value;
            const inputChar = val.slice(-1);
            const inputType = e.inputType;
            const currentWordDiv = wordWrapper.children[currentWordIndex];
            const chars = currentWordDiv.querySelectorAll(".letter");
            
            if (inputType === "deleteContentBackward") {
                if (currentCharIndex > 0) {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    currentCharIndex--;
                    removeClassFromChar(currentWordIndex, currentCharIndex, "correct");
                    removeClassFromChar(currentWordIndex, currentCharIndex, "incorrect");
                    addClassToCurrentChar("active");
                }
                return;
            }

            // Normal yazma
            if (currentCharIndex < chars.length) {
                totalKeystrokes++;
                const targetChar = chars[currentCharIndex].innerText.replace(/\u00a0/g, " ");
                
                // BOŞLUK (Kelime Tamamlama)
                if (targetChar === " " && inputChar === " ") {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    
                    // KELİME KONTROLÜ: Kelime tamamen doğru mu?
                    // Kelimenin içinde hiç 'incorrect' class'ı var mı bakıyoruz.
                    const hasMistake = currentWordDiv.querySelector(".incorrect");
                    
                    if (!hasMistake) {
                        // Hata yoksa puanı artır
                        completedCorrectWords++;
                    } else {
                        // Hata varsa kelimenin altını kırmızı çiz (Görsel geri bildirim)
                        currentWordDiv.classList.add("error-word");
                    }

                    // Sonraki kelimeye geç
                    currentWordIndex++;
                    currentCharIndex = 0;
                    checkScroll();
                    if (currentWordIndex < words.length) addClassToCurrentChar("active");
                    inputField.value = "";
                } 
                // HARF KONTROLÜ
                else if (targetChar !== " ") {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    if (inputChar === targetChar) {
                        addClassToChar(currentWordIndex, currentCharIndex, "correct");
                        correctKeystrokes++;
                    } else {
                        addClassToChar(currentWordIndex, currentCharIndex, "incorrect");
                    }
                    currentCharIndex++;
                    if (currentCharIndex < chars.length) addClassToCurrentChar("active");
                }
            }
        });

        function initTimer() {
            if (timeLeft > 0) {
                timeLeft--;
                timerTag.innerText = timeLeft;
            } else {
                finishGame();
            }
        }

        function checkScroll() {
            const currentWordDiv = wordWrapper.children[currentWordIndex];
            const prevWordDiv = wordWrapper.children[currentWordIndex - 1];
            if (prevWordDiv && currentWordDiv.offsetTop > prevWordDiv.offsetTop) {
                const lineHeight = 40; 
                const currentTransform = parseInt(wordWrapper.style.transform.replace("translateY(", "").replace("px)", "") || 0);
                wordWrapper.style.transform = `translateY(${currentTransform - lineHeight}px)`;
            }
        }

        function finishGame() {
            clearInterval(timer);
            isTyping = false;
            
            // Doğruluk Yüzdesi (Basılan tuşların kaçı doğruydu?)
            let accuracy = 0;
            if (totalKeystrokes > 0) {
                accuracy = Math.round((correctKeystrokes / totalKeystrokes) * 100);
            }

            // Sonuçları Ekrana Bas
            const now = new Date();
            const dateString = now.toLocaleDateString('tr-TR') + " - " + now.toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'});

            // Puan artık "completedCorrectWords" (Tamamlanan Doğru Kelime)
            document.getElementById("final-score").innerText = completedCorrectWords;
            document.getElementById("stat-keystrokes").innerText = totalKeystrokes;
            document.getElementById("stat-acc").innerText = `%${accuracy}`;
            document.getElementById("stat-date").innerText = dateString;

            resultModal.style.display = "flex";

            // REKOR KAYDETME (Kelime sayısı olarak)
            saveScore(completedCorrectWords, maxTime, dateString);
        }

        // --- YENİ REKOR KAYIT SİSTEMİ (Kelime Bazlı) ---
        function saveScore(score, mode, dateStr) {
            let records = JSON.parse(localStorage.getItem("hakan_typing_words_records")) || {};
            let currentRecord = records[mode] || { score: 0, date: "" };

            if (score > currentRecord.score) {
                records[mode] = { score: score, date: dateStr };
                localStorage.setItem("hakan_typing_words_records", JSON.stringify(records));
                loadBestScore(mode);
            }
        }

        function loadBestScore(mode) {
            let label = mode + "s";
            if(mode === 180) label = "3dk";
            recordModeLabel.innerText = label;

            let records = JSON.parse(localStorage.getItem("hakan_typing_words_records")) || {};
            let recordData = records[mode];

            if (recordData) {
                bestScoreTag.innerText = recordData.score;
                bestDateTag.innerText = recordData.date;
            } else {
                bestScoreTag.innerText = 0;
                bestDateTag.innerText = "Kayıt Yok";
            }
        }

        function addClassToCurrentChar(className) { addClassToChar(currentWordIndex, currentCharIndex, className); }
        function addClassToChar(wIdx, cIdx, className) {
            const w = wordWrapper.children[wIdx];
            if(w) { const c = w.querySelectorAll(".letter")[cIdx]; if(c) c.classList.add(className); }
        }
        function removeClassFromChar(wIdx, cIdx, className) {
            const w = wordWrapper.children[wIdx];
            if(w) { const c = w.querySelectorAll(".letter")[cIdx]; if(c) c.classList.remove(className); }
        }

        window.focusInput = () => { inputField.focus(); }

        document.addEventListener("keydown", (e) => {
            if(e.key === "Tab") { e.preventDefault(); resetGame(); }
            inputField.focus();
        });

    </script>
</body>
</html>
