<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Kelime AvcÄ±sÄ±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="gÃ¶rsel.css">
</head>
<body>

    <div class="lang-switch">
        <button class="lang-btn active" id="btn-tr" onclick="setLanguage('tr')">ğŸ‡¹ğŸ‡·</button>
        <button class="lang-btn" id="btn-en" onclick="setLanguage('en')">ğŸ‡ºğŸ‡¸</button>
    </div>

    <aside class="sidebar">
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> <span id="ui-menu">Ana MenÃ¼</span></a>
        <div class="record-box">
            <div class="record-title"><span id="ui-best">EN Ä°YÄ°</span> (<span id="record-mode-label">30s</span>)</div>
            <div class="record-score" id="best-score">0</div>
            <div class="record-unit" id="ui-unit">DOÄRU KELÄ°ME</div>
            <div class="record-date" id="best-date">KayÄ±t Yok</div>
        </div>
        <div class="tips" id="ui-tips">
            <b>Mobil Ä°pucu:</b><br>
            Telefonda yazarken kelime Ã¶nerilerini kapatÄ±rsan daha rahat edersin.<br>
        </div>
    </aside>

    <main class="main-content">
        <div class="config-bar" id="time-options">
            <button class="time-btn" onclick="setTime(15)">15s</button>
            <button class="time-btn active" onclick="setTime(30)">30s</button>
            <button class="time-btn" onclick="setTime(60)">60s</button>
            <button class="time-btn" onclick="setTime(180)">3dk</button>
        </div>
        <div class="live-stats" id="timer">30</div>
        <div class="typing-container" onclick="focusInput()">
            <div class="words-wrapper" id="words-wrapper"></div>
        </div>
        <input type="text" id="input-field" autocomplete="off" autocapitalize="none" spellcheck="false" style="font-size: 16px;">
    </main>

    <div class="result-modal" id="result-modal">
        <div class="result-card">
            <div class="result-title" id="ui-timeout">SÃ¼re Doldu!</div>
            <div class="result-score" id="final-score">0</div>
            <div class="result-label" id="ui-result-label">DoÄŸru Kelime</div>
            <div class="grid-stats">
                <div class="stat-item">
                    <span id="ui-stat-keys">Toplam VuruÅŸ</span>
                    <b id="stat-keystrokes">0</b>
                </div>
                <div class="stat-item">
                    <span id="ui-stat-acc">DoÄŸruluk</span>
                    <b id="stat-acc">%0</b>
                </div>
                <div class="stat-item" style="grid-column: span 2;">
                    <span id="ui-stat-date">Tarih</span>
                    <b id="stat-date">--</b>
                </div>
            </div>
            <button class="restart-btn" onclick="resetGame()" id="ui-restart">Tekrar Dene</button>
        </div>
    </div>

    <script>
        const wordPools = {
            tr: [
                "ben", "sen", "o", "biz", "siz", "onlar", "ve", "ile", "ama", "fakat", "lakin", "Ã§Ã¼nkÃ¼", "veya", "ya", "da", "de",
                "gelmek", "gitmek", "yapmak", "etmek", "olmak", "almak", "vermek", "sevmek", "bilmek", "gÃ¶rmek", "bakmak", "duymak",
                "yazmak", "okumak", "konuÅŸmak", "anlamak", "dÃ¼ÅŸÃ¼nmek", "baÅŸlamak", "bitirmek", "Ã§alÄ±ÅŸmak", "oynamak", "koÅŸmak", "yÃ¼rÃ¼mek",
                "ev", "okul", "iÅŸ", "araba", "masa", "sandalye", "kalem", "defter", "kitap", "bilgisayar", "telefon", "internet",
                "sabah", "Ã¶ÄŸle", "akÅŸam", "gece", "bugÃ¼n", "yarÄ±n", "dÃ¼n", "ÅŸimdi", "sonra", "Ã¶nce", "zaman", "saat", "dakika",
                "gÃ¼zel", "Ã§irkin", "iyi", "kÃ¶tÃ¼", "bÃ¼yÃ¼k", "kÃ¼Ã§Ã¼k", "uzun", "kÄ±sa", "zor", "kolay", "sÄ±cak", "soÄŸuk", "yeni", "eski",
                "kÄ±rmÄ±zÄ±", "mavi", "yeÅŸil", "sarÄ±", "siyah", "beyaz", "turuncu", "mor", "pembe", "gri", "kahverengi", "renk",
                "insan", "Ã§ocuk", "kadÄ±n", "erkek", "anne", "baba", "kardeÅŸ", "arkadaÅŸ", "Ã¶ÄŸretmen", "doktor", "mÃ¼hendis", "polis",
                "elma", "armut", "muz", "Ã§ilek", "ekmek", "su", "sÃ¼t", "Ã§ay", "kahve", "yemek", "kahvaltÄ±", "akÅŸam", "lezzetli",
                "mutlu", "Ã¼zgÃ¼n", "kÄ±zgÄ±n", "ÅŸaÅŸkÄ±n", "korkmuÅŸ", "heyecanlÄ±", "yorgun", "hÄ±zlÄ±", "yavaÅŸ", "gÃ¼Ã§lÃ¼", "zayÄ±f",
                "TÃ¼rkiye", "Ä°stanbul", "Ankara", "Ä°zmir", "dÃ¼nya", "gÃ¼neÅŸ", "ay", "yÄ±ldÄ±z", "deniz", "daÄŸ", "orman", "hava",
                "proje", "kod", "yazÄ±lÄ±m", "teknoloji", "veri", "sistem", "klavye", "ekran", "fare", "dosya", "klasÃ¶r", "uygulama",
                "baÅŸarÄ±", "hata", "kontrol", "sonuÃ§", "rapor", "analiz", "tasarÄ±m", "geliÅŸtirme", "test", "demo", "versiyon",
                "lÃ¼tfen", "teÅŸekkÃ¼r", "merhaba", "hoÅŸÃ§akal", "evet", "hayÄ±r", "belki", "elbette", "tabii", "asla", "daima", "bazen",
                "bir", "iki", "Ã¼Ã§", "dÃ¶rt", "beÅŸ", "on", "yÃ¼z", "bin", "milyon", "sayÄ±", "rakam", "matematik", "fen", "tarih",
                "mÃ¼zik", "resim", "spor", "futbol", "basketbol", "voleybol", "yÃ¼zme", "koÅŸu", "antrenman", "maÃ§", "takÄ±m", "oyuncu",
                "film", "dizi", "sinema", "tiyatro", "sanat", "kÃ¼ltÃ¼r", "gezi", "tatil", "uÃ§ak", "otobÃ¼s", "tren", "gemi", "yol",
                "cadde", "sokak", "mahalle", "ÅŸehir", "Ã¼lke", "kÄ±ta", "adres", "konum", "harita", "yÃ¶n", "saÄŸ", "sol", "ileri", "geri",
                "aile", "bebek", "dede", "nene", "hala", "teyze", "amca", "dayÄ±", "kuzen", "komÅŸu", "misafir", "yabancÄ±", "halk",
                "devlet", "millet", "bayrak", "vatan", "toprak", "sÄ±nÄ±r", "asker", "ordu", "silah", "barÄ±ÅŸ", "savaÅŸ", "zafer",
                "gÃ¶z", "kulak", "burun", "aÄŸÄ±z", "diÅŸ", "dil", "kol", "bacak", "el", "ayak", "parmak", "tÄ±rnak", "saÃ§", "baÅŸ",
                "kalp", "mide", "ciÄŸer", "kan", "damar", "kemik", "deri", "beyin", "akÄ±l", "fikir", "ruh", "can", "nefes",
                "giyim", "kÄ±yafet", "elbise", "gÃ¶mlek", "pantolon", "ceket", "ayakkabÄ±", "Ã§orap", "ÅŸapka", "atkÄ±", "eldiven", "kemer",
                "oda", "salon", "mutfak", "banyo", "tuvalet", "balkon", "bahÃ§e", "kapÄ±", "pencere", "duvar", "tavan", "taban",
                "yatak", "yorgan", "yastÄ±k", "Ã§arÅŸaf", "halÄ±", "perde", "lamba", "ayna", "dolap", "Ã§ekmece", "raf", "kutu",
                "cam", "demir", "tahta", "plastik", "kaÄŸÄ±t", "karton", "kumaÅŸ", "deri", "altÄ±n", "gÃ¼mÃ¼ÅŸ", "bakÄ±r", "taÅŸ",
                "kedi", "kÃ¶pek", "kuÅŸ", "balÄ±k", "at", "eÅŸek", "inek", "koyun", "keÃ§i", "tavuk", "horoz", "Ã¶rdek", "kaz",
                "aslan", "kaplan", "ayÄ±", "kurt", "tilki", "tavÅŸan", "fare", "yÄ±lan", "bÃ¶cek", "arÄ±", "sinek", "kelebek",
                "aÄŸaÃ§", "Ã§iÃ§ek", "gÃ¼l", "lale", "papatya", "Ã§imen", "yaprak", "dal", "kÃ¶k", "meyve", "sebze", "tohum",
                "domates", "biber", "patlÄ±can", "soÄŸan", "sarÄ±msak", "havuÃ§", "patates", "salatalÄ±k", "marul", "maydanoz", "nane",
                "et", "tavuk", "balÄ±k", "sucuk", "salam", "sosis", "yumurta", "peynir", "zeytin", "yaÄŸ", "bal", "reÃ§el",
                "tuz", "ÅŸeker", "biber", "baharat", "un", "pirinÃ§", "makarna", "Ã§orba", "pilav", "dolma", "sarma", "bÃ¶rek",
                "tatlÄ±", "pasta", "kek", "kurabiye", "dondurma", "Ã§ikolata", "biskÃ¼vi", "sakÄ±z", "meyve suyu", "gazoz", "ayran",
                "tabak", "Ã§atal", "kaÅŸÄ±k", "bÄ±Ã§ak", "bardak", "kupa", "sÃ¼rahi", "tencere", "tava", "tepsi", "fÄ±rÄ±n", "ocak",
                "buzdolabÄ±", "Ã§amaÅŸÄ±r", "bulaÅŸÄ±k", "Ã¼tÃ¼", "sÃ¼pÃ¼rge", "kovasÄ±", "bez", "deterjan", "sabun", "ÅŸampuan", "havlu",
                "koltuk", "kanepe", "sehpa", "vitrin", "televizyon", "radyo", "kamera", "fotoÄŸraf", "resim", "mÃ¼zik", "ÅŸarkÄ±",
                "sÃ¶z", "beste", "nota", "ritim", "dans", "eÄŸlence", "parti", "doÄŸum gÃ¼nÃ¼", "dÃ¼ÄŸÃ¼n", "niÅŸan", "kÄ±na", "bayram",
                "yÄ±lbaÅŸÄ±", "hediye", "sÃ¼rpriz", "kutlama", "tebrik", "baÅŸarÄ±", "Ã¶dÃ¼l", "madalya", "kupa", "derece", "rekor",
                "para", "lira", "dolar", "euro", "banka", "kredi", "kart", "borÃ§", "alacak", "hesap", "fatura", "fiÅŸ",
                "market", "bakkal", "manav", "kasap", "fÄ±rÄ±n", "eczane", "hastane", "okul", "Ã¼niversite", "sÄ±nÄ±f", "ders",
                "sÄ±nav", "not", "karne", "diploma", "mezuniyet", "Ã¶dev", "proje", "sunum", "toplantÄ±", "ofis", "bÃ¼ro",
                "ÅŸirket", "firma", "fabrika", "atÃ¶lye", "depo", "maÄŸaza", "dÃ¼kkan", "alÄ±ÅŸveriÅŸ", "satÄ±ÅŸ", "pazarlama", "reklam",
                "mÃ¼ÅŸteri", "patron", "iÅŸÃ§i", "memur", "mÃ¼dÃ¼r", "ÅŸef", "baÅŸkan", "yÃ¶netici", "lider", "ortak", "rakip",
                "siyaset", "politika", "seÃ§im", "oy", "sandÄ±k", "parti", "bakan", "vekil", "meclis", "yasa", "kanun",
                "hak", "hukuk", "adalet", "mahkeme", "hakim", "savcÄ±", "avukat", "dava", "suÃ§", "ceza", "hapis",
                "haber", "gazete", "dergi", "televizyon", "radyo", "internet", "sosyal medya", "mesaj", "mail", "mektup", "zarf",
                "telefon", "hat", "numara", "arama", "konuÅŸma", "sohbet", "muhabbet", "tartÄ±ÅŸma", "kavga", "barÄ±ÅŸ", "anlaÅŸma",
                "sevgi", "aÅŸk", "nefret", "korku", "cesaret", "umut", "hayal", "gerÃ§ek", "yalan", "doÄŸru", "yanlÄ±ÅŸ",
                "bilgi", "cahil", "alim", "bilgin", "uzman", "usta", "Ã§Ä±rak", "kalfa", "beceri", "yetenek", "zeka",
                "soru", "cevap", "Ã§Ã¶zÃ¼m", "sorun", "problem", "dert", "Ã§are", "ilaÃ§", "tedavi", "hastalÄ±k", "saÄŸlÄ±k",
                "hayat", "yaÅŸam", "Ã¶lÃ¼m", "cenaze", "mezar", "toprak", "ruh", "melek", "ÅŸeytan", "cennet", "cehennem",
                "din", "iman", "inanÃ§", "dua", "ibadet", "cami", "kilise", "havra", "tapÄ±nak", "ezan", "Ã§an",
                "tarih", "geÃ§miÅŸ", "gelecek", "anÄ±", "hatÄ±ra", "unutmak", "hatÄ±rlamak", "Ã¶ÄŸrenmek", "Ã¶ÄŸretmek", "eÄŸitim", "kÃ¼ltÃ¼r",
                "gezi", "seyahat", "turist", "rehber", "otel", "pansiyon", "kamp", "Ã§adÄ±r", "doÄŸa", "manzara", "fotoÄŸraf",
                "trafik", "kaza", "yol", "kÃ¶prÃ¼", "tÃ¼nel", "kavÅŸak", "Ä±ÅŸÄ±k", "levha", "ehliyet", "ceza", "radar",
                "hÄ±z", "sÃ¼rat", "mesafe", "uzak", "yakÄ±n", "yÃ¼ksek", "alÃ§ak", "derin", "sÄ±ÄŸ", "geniÅŸ", "dar",
                "aÄŸÄ±r", "hafif", "sert", "yumuÅŸak", "katÄ±", "sÄ±vÄ±", "gaz", "ateÅŸ", "buz", "buhar", "duman",
                "enerji", "elektrik", "pil", "akÃ¼", "motor", "benzin", "mazot", "gaz", "petrol", "kÃ¶mÃ¼r", "maden",
                "demir", "Ã§elik", "alÃ¼minyum", "plastik", "cam", "beton", "tuÄŸla", "Ã§imento", "kum", "kireÃ§", "boya",
                "inÅŸaat", "bina", "apartman", "kule", "gÃ¶kdelen", "saray", "kÃ¶ÅŸk", "yalÄ±", "villa", "kulÃ¼be", "baraka",
                "tarla", "baÄŸ", "bahÃ§e", "Ã§iftlik", "kÃ¶y", "kasaba", "ilÃ§e", "ÅŸehir", "baÅŸkent", "merkez", "taÅŸra",
                "kuzey", "gÃ¼ney", "doÄŸu", "batÄ±", "lodos", "poyraz", "rÃ¼zgar", "fÄ±rtÄ±na", "yaÄŸmur", "kar", "dolu",
                "sis", "bulut", "gÃ¶kkuÅŸaÄŸÄ±", "yÄ±ldÄ±rÄ±m", "ÅŸimÅŸek", "deprem", "sel", "yangÄ±n", "Ã§Ä±ÄŸ", "heyelan", "kuraklÄ±k",
                "Ã§Ã¶l", "vaha", "okyanus", "kÃ¶rfez", "boÄŸaz", "ada", "yarÄ±mada", "kÄ±yÄ±", "sahil", "plaj", "kumsal",
                "dalga", "akÄ±ntÄ±", "derinlik", "yÃ¼zey", "dip", "zirve", "yamaÃ§", "vadi", "ova", "plato", "tepe"
            ],
            en: [
                "the", "be", "to", "of", "and", "a", "in", "that", "have", "it", "for", "not", "on", "with", "he", "as", "you", "do", "at", "this",
                "but", "his", "by", "from", "they", "we", "say", "her", "she", "or", "an", "will", "my", "one", "all", "would", "there", "their", "what", "so",
                "up", "out", "if", "about", "who", "get", "which", "go", "me", "when", "make", "can", "like", "time", "no", "just", "him", "know", "take", "people",
                "into", "year", "your", "good", "some", "could", "them", "see", "other", "than", "then", "now", "look", "only", "come", "its", "over", "think", "also", "back",
                "after", "use", "two", "how", "our", "work", "first", "well", "way", "even", "new", "want", "because", "any", "these", "give", "day", "most", "us", "water",
                "school", "many", "found", "study", "still", "learn", "should", "world", "high", "low", "deep", "shallow", "wide", "narrow", "heavy", "hard", "soft", "hot", "cold"
            ]
        };

        const translations = {
            tr: {
                menu: "Ana MenÃ¼", best: "EN Ä°YÄ°", unit: "DOÄRU KELÄ°ME", timeout: "SÃ¼re Doldu!", 
                resultLabel: "DoÄŸru Kelime", statKeys: "Toplam VuruÅŸ", statAcc: "DoÄŸruluk", 
                statDate: "Tarih", restart: "Tekrar Dene", noRecord: "KayÄ±t Yok", 
                tips: "<b>Mobil Ä°pucu:</b><br>Telefonda yazarken kelime Ã¶nerilerini kapatÄ±rsan daha rahat edersin.<br>"
            },
            en: {
                menu: "Main Menu", best: "BEST RECORD", unit: "CORRECT WORDS", timeout: "Time's Up!", 
                resultLabel: "Correct Words", statKeys: "Total Keystrokes", statAcc: "Accuracy", 
                statDate: "Date", restart: "Try Again", noRecord: "No Record", 
                tips: "<b>Mobile Tip:</b><br>Disabling auto-correct on your phone will make typing much smoother.<br>"
            }
        };

        let currentLang = 'tr';
        let timeLeft = 30;
        let maxTime = 30;
        let isTyping = false;
        let timer = null;
        let words = [];
        let currentWordIndex = 0;
        let currentCharIndex = 0;
        
        let completedCorrectWords = 0;
        let totalKeystrokes = 0;
        let correctKeystrokes = 0;

        const wordWrapper = document.getElementById("words-wrapper");
        const inputField = document.getElementById("input-field");
        const timerTag = document.getElementById("timer");
        const resultModal = document.getElementById("result-modal");
        
        const bestScoreTag = document.getElementById("best-score");
        const bestDateTag = document.getElementById("best-date");
        const recordModeLabel = document.getElementById("record-mode-label");

        window.onload = () => { 
            loadBestScore(maxTime); 
            setLanguage(currentLang); 
            resetGame(); 
        };

        function setLanguage(lang) {
            if (isTyping) return;
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${lang}`).classList.add('active');
            
            const t = translations[lang];
            document.getElementById('ui-menu').innerText = t.menu;
            document.getElementById('ui-best').innerText = t.best;
            document.getElementById('ui-unit').innerText = t.unit;
            document.getElementById('ui-timeout').innerText = t.timeout;
            document.getElementById('ui-result-label').innerText = t.resultLabel;
            document.getElementById('ui-stat-keys').innerText = t.statKeys;
            document.getElementById('ui-stat-acc').innerText = t.statAcc;
            document.getElementById('ui-stat-date').innerText = t.statDate;
            document.getElementById('ui-restart').innerText = t.restart;
            document.getElementById('ui-tips').innerHTML = t.tips;

            loadBestScore(maxTime);
            resetGame();
        }

        function generateWords() {
            wordWrapper.innerHTML = "";
            words = [];
            const pool = wordPools[currentLang];
            for (let i = 0; i < 300; i++) {
                words.push(pool[Math.floor(Math.random() * pool.length)]);
            }
            renderWords();
        }

        function renderWords() {
            words.forEach(word => {
                const wordDiv = document.createElement("div");
                wordDiv.className = "word";
                word.split('').forEach(char => {
                    const span = document.createElement("span");
                    span.innerText = char;
                    span.className = "letter";
                    wordDiv.appendChild(span);
                });
                const spaceSpan = document.createElement("span");
                spaceSpan.innerHTML = "&nbsp;"; 
                spaceSpan.className = "letter space";
                wordDiv.appendChild(spaceSpan);
                wordWrapper.appendChild(wordDiv);
            });
            addClassToCurrentChar("active");
        }

        window.setTime = (time) => {
            if (isTyping) return;
            maxTime = time;
            timeLeft = time;
            timerTag.innerText = timeLeft;
            document.querySelectorAll(".time-btn").forEach(btn => btn.classList.remove("active"));
            event.target.classList.add("active");
            loadBestScore(time);
            resetGame();
        }

        window.resetGame = () => {
            generateWords();
            clearInterval(timer);
            timeLeft = maxTime;
            timerTag.innerText = timeLeft;
            isTyping = false;
            
            currentWordIndex = 0;
            currentCharIndex = 0;
            completedCorrectWords = 0;
            totalKeystrokes = 0;
            correctKeystrokes = 0;
            
            inputField.value = "";
            wordWrapper.style.transform = "translateY(0px)";
            resultModal.style.display = "none";
            focusInput();
            const firstWord = wordWrapper.children[0];
            if(firstWord) firstWord.scrollIntoView({block: "start"});
        }

        inputField.addEventListener("input", (e) => {
            if (!isTyping && timeLeft > 0) {
                isTyping = true;
                timer = setInterval(initTimer, 1000);
            }

            const val = inputField.value.toLowerCase();
            const inputChar = val.slice(-1);
            const inputType = e.inputType;
            const currentWordDiv = wordWrapper.children[currentWordIndex];
            const chars = currentWordDiv.querySelectorAll(".letter");
            
            // Geri silme iÅŸlemi
            if (inputType === "deleteContentBackward") {
                if (currentCharIndex > 0) {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    currentCharIndex--;
                    removeClassFromChar(currentWordIndex, currentCharIndex, "correct");
                    removeClassFromChar(currentWordIndex, currentCharIndex, "incorrect");
                    addClassToCurrentChar("active");
                }
                // Silme yapÄ±nca da scroll kontrolÃ¼ yap (Geri yukarÄ± Ã§Ä±kmasÄ± iÃ§in)
                checkScroll();
                return;
            }

            if (currentCharIndex < chars.length) {
                totalKeystrokes++;
                const targetChar = chars[currentCharIndex].innerText.replace(/\u00a0/g, " ");
                
                if (targetChar === " " && inputChar === " ") {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    
                    const hasMistake = currentWordDiv.querySelector(".incorrect");
                    
                    if (!hasMistake) {
                        completedCorrectWords++;
                    } else {
                        currentWordDiv.classList.add("error-word");
                    }

                    currentWordIndex++;
                    currentCharIndex = 0;
                    
                    checkScroll(); // Scroll kontrolÃ¼ burada

                    if (currentWordIndex < words.length) addClassToCurrentChar("active");
                    inputField.value = "";
                } 
                else if (targetChar !== " ") {
                    removeClassFromChar(currentWordIndex, currentCharIndex, "active");
                    if (inputChar === targetChar) {
                        addClassToChar(currentWordIndex, currentCharIndex, "correct");
                        correctKeystrokes++;
                    } else {
                        addClassToChar(currentWordIndex, currentCharIndex, "incorrect");
                    }
                    currentCharIndex++;
                    if (currentCharIndex < chars.length) addClassToCurrentChar("active");
                }
            }
        });

        function initTimer() {
            if (timeLeft > 0) {
                timeLeft--;
                timerTag.innerText = timeLeft;
            } else {
                finishGame();
            }
        }

        // --- MÄ°LÄ°METRÄ°K SCROLL DÃœZELTMESÄ° BURADA ---
        function checkScroll() {
            const currentWord = wordWrapper.children[currentWordIndex];
            if (!currentWord) return;

            // O anki kelimenin yÃ¼ksekliÄŸini dinamik al (Mobil: ~32px, PC: 40px)
            const lineHeight = currentWord.offsetHeight; 
            
            // Aktif kelimenin yukarÄ±dan uzaklÄ±ÄŸÄ±
            const offsetTop = currentWord.offsetTop;

            // Kural: EÄŸer 2. satÄ±rÄ±n altÄ±na iniyorsak (offset > lineHeight), yukarÄ± kaydÄ±r.
            // Bu sayede aktif satÄ±r hep 2. sÄ±rada gÃ¶rÃ¼nÃ¼r, 1. satÄ±r yukarÄ±da kalÄ±r.
            let newTranslateY = 0;
            if (offsetTop > lineHeight) {
                newTranslateY = -(offsetTop - lineHeight);
            }

            wordWrapper.style.transform = `translateY(${newTranslateY}px)`;
        }

        function finishGame() {
            clearInterval(timer);
            isTyping = false;
            
            let accuracy = 0;
            if (totalKeystrokes > 0) {
                accuracy = Math.round((correctKeystrokes / totalKeystrokes) * 100);
            }

            const now = new Date();
            const dateString = now.toLocaleDateString() + " - " + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

            document.getElementById("final-score").innerText = completedCorrectWords;
            document.getElementById("stat-keystrokes").innerText = totalKeystrokes;
            document.getElementById("stat-acc").innerText = `%${accuracy}`;
            document.getElementById("stat-date").innerText = dateString;

            resultModal.style.display = "flex";

            saveScore(completedCorrectWords, maxTime, dateString);
        }

        function saveScore(score, mode, dateStr) {
            const key = `hakan_records_${currentLang}`;
            let records = JSON.parse(localStorage.getItem(key)) || {};
            let currentRecord = records[mode] || { score: 0, date: "" };

            if (score > currentRecord.score) {
                records[mode] = { score: score, date: dateStr };
                localStorage.setItem(key, JSON.stringify(records));
                loadBestScore(mode);
            }
        }

        function loadBestScore(mode) {
            let label = mode === 180 ? (currentLang === 'tr' ? '3dk' : '3m') : mode + "s";
            recordModeLabel.innerText = label;
            const key = `hakan_records_${currentLang}`;
            let records = JSON.parse(localStorage.getItem(key)) || {};
            let recordData = records[mode];

            if (recordData) {
                bestScoreTag.innerText = recordData.score;
                bestDateTag.innerText = recordData.date;
            } else {
                bestScoreTag.innerText = 0;
                bestDateTag.innerText = translations[currentLang].noRecord;
            }
        }

        function addClassToCurrentChar(className) { addClassToChar(currentWordIndex, currentCharIndex, className); }
        function addClassToChar(wIdx, cIdx, className) {
            const w = wordWrapper.children[wIdx];
            if(w) { const c = w.querySelectorAll(".letter")[cIdx]; if(c) c.classList.add(className); }
        }
        function removeClassFromChar(wIdx, cIdx, className) {
            const w = wordWrapper.children[wIdx];
            if(w) { const c = w.querySelectorAll(".letter")[cIdx]; if(c) c.classList.remove(className); }
        }

        window.focusInput = () => { inputField.focus(); }

        document.addEventListener("keydown", (e) => {
            if(e.key === "Tab") { e.preventDefault(); resetGame(); }
            inputField.focus();
        });

    </script>
</body>
</html>

