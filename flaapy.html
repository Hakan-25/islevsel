<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Flappy Hakan (Ultimate Edition)</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        /* TEMEL AYARLAR */
        body { margin: 0; padding: 0; background-color: #2c3e50; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Inter', sans-serif; user-select: none; -webkit-user-select: none; }
        
        /* UI KATMANI */
        #ui-layer {
            position: absolute; width: 100%; height: 100%; pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 20px; box-sizing: border-box; z-index: 10;
        }

        /* SKOR (Oyun sƒ±rasƒ±nda g√∂r√ºnen tek ≈üey) */
        #score-display {
            font-size: 80px; font-weight: 900; color: white;
            text-shadow: 4px 4px 0 rgba(0,0,0,0.3);
            text-align: center; margin-top: 10%;
            transition: transform 0.2s;
        }

        /* MENU ALANI (Oyun ba≈ülayƒ±nca gizlenecek) */
        #menu-stats {
            display: flex; justify-content: center; gap: 15px;
            pointer-events: auto; transition: opacity 0.3s;
        }

        .stat-pill {
            background: rgba(0, 0, 0, 0.6); color: white;
            padding: 10px 20px; border-radius: 50px;
            font-size: 18px; font-weight: 700;
            display: flex; align-items: center; gap: 8px;
            border: 2px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(5px);
        }

        /* BUTONLAR */
        .action-btn {
            background: #ffffff; color: #2c3e50; border: none;
            padding: 15px 30px; border-radius: 15px;
            font-size: 16px; font-weight: 900; cursor: pointer;
            box-shadow: 0 6px 0 #bdc3c7; transition: all 0.1s;
            text-transform: uppercase; pointer-events: auto;
            text-decoration: none; display: inline-block;
        }
        .action-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #bdc3c7; }

        .market-btn { background: #f1c40f; color: #7f6000; box-shadow: 0 6px 0 #d4ac0d; }
        .market-btn:active { box-shadow: 0 2px 0 #d4ac0d; }

        .menu-btn-container {
            display: flex; gap: 15px; justify-content: center;
            margin-bottom: 30px; transition: opacity 0.3s;
        }

        /* BA≈ûLANGI√á MESAJI */
        #start-msg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 24px; color: white; font-weight: 900;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            animation: pulse 1.5s infinite; pointer-events: none;
        }

        /* MARKET MODAL (A√ßƒ±lƒ±r Pencere) */
        #market-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100;
            justify-content: center; align-items: center;
            pointer-events: auto;
        }
        .market-content {
            background: #fff; width: 90%; max-width: 400px;
            border-radius: 20px; padding: 20px; text-align: center;
            border: 4px solid #f1c40f;
        }
        .market-header { font-size: 24px; font-weight: 900; color: #2c3e50; margin-bottom: 20px; }
        .skins-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-height: 400px; overflow-y: auto;
        }
        .skin-card {
            background: #ecf0f1; border-radius: 10px; padding: 10px;
            border: 2px solid transparent; cursor: pointer; transition: 0.2s;
        }
        .skin-card.selected { border-color: #27ae60; background: #e8f8f5; }
        .skin-preview { width: 50px; height: 50px; margin: 0 auto 10px auto; border-radius: 50%; }
        
        .buy-btn {
            background: #27ae60; color: white; border: none; padding: 8px 15px;
            border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%;
        }
        .buy-btn:disabled { background: #95a5a6; cursor: not-allowed; }

        .close-market {
            margin-top: 20px; background: #e74c3c; color: white; border: none;
            padding: 10px 30px; border-radius: 50px; font-weight: bold; cursor: pointer;
        }

        @keyframes pulse { 0% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 50% { opacity: 0.7; transform: translate(-50%, -50%) scale(0.95); } 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); } }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div>
            <div id="menu-stats">
                <div class="stat-pill"><i class="fas fa-trophy"></i> <span id="best-score">0</span></div>
                <div class="stat-pill" style="color: #f1c40f;"><i class="fas fa-coins"></i> <span id="total-coins">0</span></div>
            </div>
            <div id="score-display">0</div>
        </div>

        <div class="menu-btn-container" id="bottom-buttons">
            <button class="action-btn market-btn" onclick="openMarket()"><i class="fas fa-shopping-cart"></i> MARKET</button>
            <a href="index.html" class="action-btn">√áIKI≈û</a>
        </div>
    </div>

    <div id="start-msg">BA≈ûLAMAK ƒ∞√áƒ∞N DOKUN</div>

    <div id="market-modal">
        <div class="market-content">
            <div class="market-header">KU≈û MARKETƒ∞ üê¶</div>
            <div style="margin-bottom: 15px; color: #f39c12; font-weight: bold;">Paran: <span id="market-coins">0</span></div>
            <div class="skins-grid" id="skins-list">
                </div>
            <button class="close-market" onclick="closeMarket()">KAPAT</button>
        </div>
    </div>

    <script>
    // --- VERƒ∞ Y√ñNETƒ∞Mƒ∞ ---
    let bestScore = parseInt(localStorage.getItem('flappy_best')) || 0;
    let totalCoins = parseInt(localStorage.getItem('flappy_coins')) || 0;
    
    // Varsayƒ±lan skinler
    let ownedSkins = JSON.parse(localStorage.getItem('flappy_owned')) || ['default'];
    let currentSkin = localStorage.getItem('flappy_skin') || 'default';

    // Market Verisi (Fƒ∞YAT: 300 COIN)
    const skinsDB = {
        'default': { name: 'Kral Ku≈ü', price: 0, color: '#F4CE42' },
        'cyber':   { name: 'Siber V2', price: 300, color: '#00FFFF' },
        'ninja':   { name: 'Ninja',    price: 300, color: '#e74c3c' },
        'phoenix': { name: 'Anka',     price: 300, color: '#e67e22' }
    };

    // UI G√ºncelleme
    function updateUI() {
        document.getElementById('best-score').innerText = bestScore;
        document.getElementById('total-coins').innerText = totalCoins;
        document.getElementById('market-coins').innerText = totalCoins;
    }
    updateUI();

    // --- MARKET FONKSƒ∞YONLARI ---
    function openMarket() {
        document.getElementById('market-modal').style.display = 'flex';
        renderMarket();
    }

    function closeMarket() {
        document.getElementById('market-modal').style.display = 'none';
        // Oyunu yenilemek gerekirse diye, aslƒ±nda gerek yok sprite texture update edilecek
        if(game.scene.scenes[0]) {
            game.scene.scenes[0].updateBirdSkin();
        }
    }

    function renderMarket() {
        const list = document.getElementById('skins-list');
        list.innerHTML = '';

        for (let key in skinsDB) {
            const skin = skinsDB[key];
            const isOwned = ownedSkins.includes(key);
            const isSelected = currentSkin === key;

            let btnHtml = '';
            if (isSelected) {
                btnHtml = `<button class="buy-btn" style="background:#2ecc71;" disabled>SE√áƒ∞Lƒ∞</button>`;
            } else if (isOwned) {
                btnHtml = `<button class="buy-btn" onclick="selectSkin('${key}')" style="background:#3498db;">SE√á</button>`;
            } else {
                const canBuy = totalCoins >= skin.price;
                btnHtml = `<button class="buy-btn" onclick="buySkin('${key}')" ${canBuy ? '' : 'disabled'}>${skin.price} üí∞</button>`;
            }

            // Basit √∂nizleme renkleri (CSS ile)
            let previewColor = skin.color;
            if(key === 'cyber') previewColor = 'linear-gradient(45deg, #2c3e50, #00FFFF)';
            if(key === 'ninja') previewColor = 'linear-gradient(45deg, #000, #e74c3c)';
            if(key === 'phoenix') previewColor = 'linear-gradient(45deg, #e67e22, #f1c40f)';
            if(key === 'default') previewColor = 'linear-gradient(45deg, #F4CE42, #e74c3c)';

            const card = document.createElement('div');
            card.className = `skin-card ${isSelected ? 'selected' : ''}`;
            card.innerHTML = `
                <div class="skin-preview" style="background: ${previewColor}; box-shadow: 0 0 10px ${skin.color};"></div>
                <div style="font-weight:bold; margin-bottom:5px;">${skin.name}</div>
                ${btnHtml}
            `;
            list.appendChild(card);
        }
    }

    function buySkin(key) {
        const price = skinsDB[key].price;
        if (totalCoins >= price) {
            totalCoins -= price;
            ownedSkins.push(key);
            localStorage.setItem('flappy_coins', totalCoins);
            localStorage.setItem('flappy_owned', JSON.stringify(ownedSkins));
            playSynthSound('buy'); // Satƒ±n alma sesi
            updateUI();
            renderMarket();
        }
    }

    function selectSkin(key) {
        currentSkin = key;
        localStorage.setItem('flappy_skin', currentSkin);
        renderMarket();
    }

    // --- SES MOTORU (Geli≈ütirilmi≈ü) ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playSynthSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        const now = audioCtx.currentTime;

        if (type === 'jump') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(350, now);
            osc.frequency.exponentialRampToValueAtTime(500, now + 0.1);
            gainNode.gain.setValueAtTime(0.3, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            osc.start(now); osc.stop(now + 0.1);
        } else if (type === 'coin') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(1200, now);
            osc.frequency.exponentialRampToValueAtTime(2000, now + 0.1);
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
            osc.start(now); osc.stop(now + 0.15);
        } else if (type === 'dead') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(200, now);
            osc.frequency.exponentialRampToValueAtTime(50, now + 0.3);
            gainNode.gain.setValueAtTime(0.3, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(now); osc.stop(now + 0.3);
        } else if (type === 'buy') {
            osc.type = 'square';
            osc.frequency.setValueAtTime(400, now);
            osc.frequency.linearRampToValueAtTime(800, now + 0.1);
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(now); osc.stop(now + 0.3);
        }
    }

    // --- PHASER OYUN KODLARI ---
    const isMobile = window.innerWidth < 768;
    const config = {
        type: Phaser.AUTO,
        width: isMobile ? window.innerWidth : 400,
        height: isMobile ? window.innerHeight : 600,
        transparent: false,
        backgroundColor: '#4ec0ca',
        physics: {
            default: 'arcade',
            arcade: { gravity: { y: 1100 }, debug: false }
        },
        scene: { create: create, update: update }
    };

    let bird, pipes, coins;
    let score = 0;
    let gameHasStarted = false;
    let gameOverFlag = false;
    let particles; // Efekt i√ßin

    const game = new Phaser.Game(config);

    function create() {
        this.cameras.main.setBackgroundColor('#4ec0ca');

        // --- 1. DOKU OLU≈ûTURMA (Texture Generation) ---
        
        // Zemin
        let groundG = this.make.graphics();
        groundG.fillStyle(0xDED895, 1); groundG.fillRect(0, 15, 400, 100);
        groundG.fillStyle(0x73BF2E, 1); groundG.fillRect(0, 0, 400, 15);
        groundG.lineStyle(3, 0x558C22, 1); groundG.strokeRect(0, 0, 400, 15);
        groundG.generateTexture('ground', 400, 110);

        // Altƒ±n
        let coinG = this.make.graphics();
        coinG.fillStyle(0xFFD700, 1); coinG.fillCircle(16, 16, 16);
        coinG.lineStyle(2, 0xB8860B, 1); coinG.strokeCircle(16, 16, 16);
        coinG.fillStyle(0xFFFACD, 1); coinG.fillCircle(16, 16, 10);
        coinG.generateTexture('coin', 32, 32);

        // Boru
        let pipeG = this.make.graphics();
        pipeG.fillStyle(0x73BF2E, 1); pipeG.fillRect(2, 2, 54, 800);
        pipeG.lineStyle(4, 0x558C22, 1); pipeG.strokeRect(0, 0, 58, 800);
        pipeG.fillStyle(0x73BF2E, 1); pipeG.fillRect(0, 0, 58, 28);
        pipeG.strokeRect(0, 0, 58, 28);
        pipeG.generateTexture('pipe', 60, 800);

        // Par√ßacƒ±k (Trail)
        let trailG = this.make.graphics();
        trailG.fillStyle(0xffffff, 1); trailG.fillCircle(5, 5, 5);
        trailG.generateTexture('trail', 10, 10);

        // KU≈û √áƒ∞Zƒ∞M FONKSƒ∞YONU (Her skin i√ßin ayrƒ± doku √ºretir)
        const generateBirdTextures = (scene) => {
            // 1. DEFAULT (Kral)
            let b1 = scene.make.graphics();
            b1.fillStyle(0xF4CE42, 1); b1.fillCircle(22, 20, 14); // G√∂vde
            b1.fillStyle(0xFFFFFF, 1); b1.fillCircle(28, 16, 6); // G√∂z
            b1.fillStyle(0x000000, 1); b1.fillCircle(30, 16, 2); // Bebek
            b1.fillStyle(0xF39C12, 1); b1.fillTriangle(32, 20, 44, 23, 32, 26); // Gaga
            b1.fillStyle(0xFF69B4, 1); b1.fillTriangle(10,8,14,0,18,8); b1.fillTriangle(18,8,22,-2,26,8); b1.fillTriangle(26,8,30,0,34,8); // Ta√ß
            b1.generateTexture('bird_default', 45, 40);

            // 2. CYBER (Siber)
            let b2 = scene.make.graphics();
            b2.fillStyle(0x2c3e50, 1); b2.fillRoundRect(5, 10, 35, 20, 5); // G√∂vde
            b2.fillStyle(0x00FFFF, 1); b2.fillRect(25, 12, 15, 6); // Visor G√∂zl√ºk
            b2.fillStyle(0x34495e, 1); b2.fillRect(0, 15, 10, 10); // Jet motoru
            b2.generateTexture('bird_cyber', 45, 40);

            // 3. NINJA (Ninja)
            let b3 = scene.make.graphics();
            b3.fillStyle(0x000000, 1); b3.fillCircle(22, 20, 14); // Siyah G√∂vde
            b3.fillStyle(0xe74c3c, 1); b3.fillRect(10, 15, 30, 8); // Kƒ±rmƒ±zƒ± Bandana
            b3.fillStyle(0xFFFFFF, 1); b3.fillCircle(28, 19, 3); // G√∂z
            b3.fillStyle(0xe74c3c, 1); b3.fillTriangle(5, 20, -5, 10, -5, 30); // Bandana Ucu (kuyruk)
            b3.generateTexture('bird_ninja', 45, 40);

            // 4. PHOENIX (Anka)
            let b4 = scene.make.graphics();
            b4.fillStyle(0xe67e22, 1); b4.fillCircle(22, 20, 14); // Turuncu G√∂vde
            b4.fillStyle(0xf1c40f, 1); b4.fillTriangle(10,10, 15, -5, 20, 10); // Alev Sa√ß
            b4.fillTriangle(20,10, 25, -2, 30, 10);
            b4.fillStyle(0xc0392b, 1); b4.fillTriangle(5, 20, -5, 15, 5, 25); // Kanat
            b4.fillStyle(0xFFFFFF, 1); b4.fillCircle(28, 16, 4); 
            b4.generateTexture('bird_phoenix', 45, 40);
        };
        generateBirdTextures(this);

        // --- 2. NESNELERƒ∞ SAHNEYE EKLEME ---
        
        pipes = this.physics.add.group();
        coins = this.physics.add.group();

        // Par√ßacƒ±k Efekti (Kuyruk ƒ∞zi)
        particles = this.add.particles(0, 0, 'trail', {
            speed: 50,
            scale: { start: 1, end: 0 },
            alpha: { start: 0.5, end: 0 },
            lifespan: 300,
            blendMode: 'ADD'
        });

        // Ku≈üu Yarat
        bird = this.physics.add.sprite(config.width / 4, config.height / 2, 'bird_' + currentSkin);
        bird.setDepth(10);
        bird.body.setCircle(13, 9, 7);
        particles.startFollow(bird);

        // Zemin
        this.ground = this.add.tileSprite(config.width/2, config.height, config.width, 110, 'ground').setOrigin(0.5, 1).setDepth(20);
        this.physics.add.existing(this.ground, true);

        // Girdiler
        this.input.on('pointerdown', jump, this);
        this.input.keyboard.on('keydown-SPACE', jump, this);

        // √áarpƒ±≈ümalar
        this.physics.add.collider(bird, pipes, gameOver, null, this);
        this.physics.add.collider(bird, this.ground, gameOver, null, this);
        this.physics.add.overlap(bird, coins, collectCoin, null, this);

        // Boru √úretici
        this.pipeTimer = this.time.addEvent({
            delay: 1500,
            callback: addPipeColumn,
            callbackScope: this,
            loop: true,
            paused: true
        });

        // Skin deƒüi≈ütirme fonksiyonunu sahneye ekliyoruz ki dƒ±≈üarƒ±dan eri≈üebilelim
        this.updateBirdSkin = () => {
            bird.setTexture('bird_' + currentSkin);
            // Par√ßacƒ±k rengini skine g√∂re deƒüi≈ütir
            let tintColor = 0xffffff;
            if(currentSkin == 'cyber') tintColor = 0x00FFFF;
            if(currentSkin == 'ninja') tintColor = 0xe74c3c;
            if(currentSkin == 'phoenix') tintColor = 0xf1c40f;
            particles.setParticleTint(tintColor);
        };
        this.updateBirdSkin(); // ƒ∞lk a√ßƒ±lƒ±≈üta ayarla
    }

    function update() {
        if (!gameHasStarted) {
            bird.body.allowGravity = false;
            bird.y = (config.height / 2) + Math.sin(this.time.now / 300) * 8;
            return;
        }

        if (gameOverFlag) return;

        this.ground.tilePositionX += 2.5;
        if (bird.angle < 30) bird.angle += 2.5;
        if (bird.y < -50 || bird.y > config.height) gameOver.call(this);
    }

    function jump() {
        // Market a√ßƒ±ksa zƒ±plamayƒ± engelle
        if(document.getElementById('market-modal').style.display === 'flex') return;

        if (gameOverFlag) {
            restartGame.call(this);
            return;
        }

        if (!gameHasStarted) {
            gameHasStarted = true;
            bird.body.allowGravity = true;
            this.pipeTimer.paused = false;
            
            // UI Gƒ∞ZLE (Oyun Modu)
            document.getElementById('start-msg').style.display = 'none';
            document.getElementById('menu-stats').style.opacity = '0'; // Skorlarƒ± gizle
            document.getElementById('bottom-buttons').style.opacity = '0'; // Butonlarƒ± gizle
            document.getElementById('bottom-buttons').style.pointerEvents = 'none'; // Tƒ±klamayƒ± kapat
            
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        bird.setVelocityY(-350);
        this.tweens.add({ targets: bird, angle: -25, duration: 100 });
        playSynthSound('jump');
    }

    // --- SENƒ∞N ƒ∞STEDƒ∞ƒûƒ∞N Mƒ∞Lƒ∞METRƒ∞K BORU MANTIƒûI (DOKUNULMADI) ---
    function addPipeColumn() {
        if (gameOverFlag) return;

        let currentGap = Math.max(85, 140 - (score * 0.5));
        const minPipePiece = 80; 
        const maxAvailableY = config.height - 110 - currentGap - minPipePiece;

        let pipeY;
        let isExtreme = Math.random() < 0.50; 

        if (isExtreme) {
            let goTop = Math.random() < 0.5;
            if (goTop) pipeY = minPipePiece; 
            else pipeY = maxAvailableY; 
        } else {
            pipeY = Phaser.Math.Between(minPipePiece, maxAvailableY);
        }

        let topPipe = pipes.create(config.width + 80, pipeY, 'pipe').setOrigin(0.5, 1).setFlipY(true);
        let bottomPipe = pipes.create(config.width + 80, pipeY + currentGap, 'pipe').setOrigin(0.5, 0);

        [topPipe, bottomPipe].forEach(p => {
            p.body.allowGravity = false;
            p.setVelocityX(-200);
        });

        // Altƒ±n
        let coinY = pipeY + (currentGap / 2);
        let coin = coins.create(config.width + 80, coinY, 'coin');
        coin.setVelocityX(-200);
        coin.body.allowGravity = false;
        this.tweens.add({ targets: coin, scaleX: 0, duration: 600, yoyo: true, repeat: -1 });

        this.time.delayedCall(1500, () => {
             if (!gameOverFlag && gameHasStarted) {
                score += 1;
                document.getElementById('score-display').innerText = score;
             }
        });
    }

    function collectCoin(bird, coin) {
        coin.disableBody(true, true);
        totalCoins += 1;
        updateUI();
        localStorage.setItem('flappy_coins', totalCoins);
        playSynthSound('coin');
    }

    function gameOver() {
        if (gameOverFlag) return;
        gameOverFlag = true;
        
        this.physics.pause();
        bird.setTint(0xff0000);
        playSynthSound('dead');

        // Rekor Kaydƒ±
        if (score > bestScore) {
            bestScore = score;
            localStorage.setItem('flappy_best', bestScore);
        }
        localStorage.setItem('flappy_coins', totalCoins);
        updateUI();

        // UI GERƒ∞ GETƒ∞R (Men√º Modu)
        document.getElementById('start-msg').innerText = "TEKRAR DENE";
        document.getElementById('start-msg').style.display = 'block';
        document.getElementById('menu-stats').style.opacity = '1';
        document.getElementById('bottom-buttons').style.opacity = '1';
        document.getElementById('bottom-buttons').style.pointerEvents = 'auto';
    }

    function restartGame() {
        gameOverFlag = false;
        gameHasStarted = false;
        score = 0;
        document.getElementById('score-display').innerText = "0";
        document.getElementById('start-msg').innerText = "BA≈ûLAMAK ƒ∞√áƒ∞N DOKUN";
        this.scene.restart();
    }
    </script>
</body>
</html>
