<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Flappy Hakan</title>
    
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        /* 1. SAYFA AYARLARI */
        body { 
            margin: 0; padding: 0; 
            background-color: #4ec0ca; /* Klasik G√∂k Mavisi */
            overflow: hidden; 
            font-family: 'Inter', sans-serif; 
            touch-action: none; 
            height: 100vh; width: 100vw;
            display: flex; justify-content: center; align-items: center; 
            -webkit-user-select: none; user-select: none;
        }

        /* Oyun Canvas'ƒ± i√ßin G√∂lge */
        canvas {
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-radius: 4px;
        }

        /* 2. ARAY√úZ (UI) */
        #game-container {
            position: relative;
            width: 100%; height: 100%;
            max-width: 480px; 
            max-height: 850px;
            overflow: hidden;
        }

        /* √úst Bar */
        #top-ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100;
        }

        .home-btn {
            position: absolute; top: 20px; left: 20px; pointer-events: auto;
            text-decoration: none; background: white; width: 45px; height: 45px;
            border-radius: 12px; display: flex; justify-content: center; align-items: center;
            font-size: 24px; box-shadow: 0 4px 0 #2c7a81; border: 2px solid #fff;
        }
        .home-btn:active { transform: translateY(3px); box-shadow: none; }

        .stats-wrapper {
            position: absolute; top: 20px; right: 20px;
            display: flex; flex-direction: column; align-items: flex-end; gap: 8px; pointer-events: auto;
        }

        .stat-pill {
            background: rgba(0, 0, 0, 0.5); color: white; padding: 6px 12px;
            border-radius: 20px; font-size: 14px; font-weight: 700;
            display: flex; align-items: center; gap: 6px; border: 2px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(4px);
        }

        .icon-btn {
            background: #FFD700; width: 45px; height: 45px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 20px; cursor: pointer; border: 2px solid #fff;
            box-shadow: 0 4px 0 #B8860B; margin-top: 5px;
        }
        .icon-btn:active { transform: translateY(3px); box-shadow: none; }
        .shop-btn { background: #9b59b6; box-shadow: 0 4px 0 #8e44ad; color: white; }

        /* Skor ve Mesajlar */
        #current-score {
            position: absolute; top: 15%; left: 50%; transform: translateX(-50%);
            font-size: 80px; font-weight: 900; color: white;
            text-shadow: 4px 4px 0 rgba(0,0,0,0.2); pointer-events: none; z-index: 10;
        }

        #start-msg {
            position: absolute; top: 60%; left: 50%; transform: translate(-50%, -50%);
            font-size: 22px; color: white; font-weight: 800; text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
            animation: pulse 1s infinite; pointer-events: none; z-index: 50; width: 100%; text-align: center;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        /* MODALLAR */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 200;
            display: flex; justify-content: center; align-items: center;
        }
        .hidden { display: none !important; }

        .modal-content {
            background: linear-gradient(135deg, #4ec0ca, #3da0a9);
            padding: 25px; border-radius: 20px; text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5); border: 4px solid white;
            width: 85%; max-width: 340px; position: relative;
        }

        /* Market Tasarƒ±mƒ± */
        #shop-list {
            display: flex; overflow-x: auto; gap: 15px; padding: 10px 5px;
            scroll-behavior: smooth; -webkit-overflow-scrolling: touch;
        }
        /* Scrollbar gizle */
        #shop-list::-webkit-scrollbar { height: 6px; }
        #shop-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 10px; }

        .shop-item {
            background: rgba(0,0,0,0.25); border-radius: 15px; padding: 15px;
            min-width: 130px; display: flex; flex-direction: column; align-items: center; gap: 10px;
            border: 2px solid transparent; transition: 0.2s; position: relative;
        }
        .shop-item.selected { border-color: #FFD700; background: rgba(255, 215, 0, 0.15); }
        
        .bird-preview-canvas { border-radius: 50%; background: rgba(255,255,255,0.1); margin-bottom: 5px; }
        
        .buy-btn {
            background: #27ae60; color: white; border: none; padding: 10px 15px;
            border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 14px;
            width: 100%; box-shadow: 0 3px 0 #1e8449;
        }
        .buy-btn:active { transform: translateY(2px); box-shadow: 0 1px 0 #1e8449; }
        .buy-btn:disabled { background: #95a5a6; cursor: not-allowed; box-shadow: none; color: #ecf0f1; }
        .use-btn { background: #2980b9; box-shadow: 0 3px 0 #1f618d; }

        /* Ortak Butonlar */
        .modal-input { width: 85%; padding: 12px; border-radius: 10px; border: none; margin-bottom: 15px; text-align: center; font-weight: bold; font-size: 16px; }
        .modal-btn { background: #fff; color: #4ec0ca; padding: 12px 30px; border-radius: 50px; font-weight: 900; border:none; cursor: pointer; box-shadow: 0 4px 0 #2c7a81; font-size: 18px; }
        .modal-btn:active { transform: translateY(3px); box-shadow: none; }
        .close-btn { position: absolute; top: 10px; right: 10px; background: #e74c3c; color: white; width: 32px; height: 32px; border-radius: 50%; border: 2px solid white; font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }

    </style>
</head>
<body>

<div id="game-container">
    <div id="top-ui">
        <a href="index.html" class="home-btn">üè†</a>
        
        <div class="stats-wrapper">
            <div class="stat-pill">üèÜ <span id="best-score">0</span></div>
            <div class="stat-pill">üí∞ <span id="total-coins">0</span></div>
            <button class="icon-btn" onclick="openLeaderboard()">ü•á</button>
            <button class="icon-btn shop-btn" onclick="openShop()">üõí</button>
        </div>

        <div id="current-score">0</div>
        <div id="start-msg">BA≈ûLAMAK ƒ∞√áƒ∞N DOKUN</div>
    </div>

    <div id="login-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color:white; margin:0 0 15px 0;">HO≈û GELDƒ∞N Pƒ∞LOT!</h2>
            <input type="text" id="nickname-input" class="modal-input" placeholder="ƒ∞smin (Max 10)" maxlength="10">
            <button class="modal-btn" onclick="kullaniciKaydet()">BA≈ûLA</button>
        </div>
    </div>

    <div id="shop-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 400px; padding: 20px 10px;">
            <button class="close-btn" onclick="closeShop()">X</button>
            <h2 style="color:white; margin:5px 0 15px 0;">MARKET</h2>
            <div style="color:white; font-size:16px; margin-bottom:15px; background:rgba(0,0,0,0.2); padding:5px; border-radius:10px; display:inline-block;">
                Bakiye: <span id="shop-coins" style="color:#FFD700; font-weight:bold;">0</span> üí∞
            </div>
            <div id="shop-list">
                </div>
        </div>
    </div>

    <div id="leaderboard-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="close-btn" onclick="closeLeaderboard()">X</button>
            <h2 style="color:white; margin:0 0 10px 0;">EN ƒ∞Yƒ∞LER</h2>
            <div id="loading-text" style="color:white;">Y√ºkleniyor...</div>
            <ul id="leaderboard-list" style="list-style:none; padding:0; text-align:left; color:white; max-height:250px; overflow-y:auto;"></ul>
        </div>
    </div>
</div>

<script>
// --- FIREBASE AYARLARI ---
const firebaseConfig = {
    apiKey: "AIzaSyBW8xNsDjp3duXyuPukuBKNlOYw-uv6W1c",
    authDomain: "hakantools-a44c0.firebaseapp.com",
    projectId: "hakantools-a44c0",
    storageBucket: "hakantools-a44c0.firebasestorage.app",
    messagingSenderId: "216753237718",
    appId: "1:216753237718:web:ea012c7dc4fdb7e7d72377",
    measurementId: "G-4GWK9BS40T"
};
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- OYUN DEƒûƒ∞≈ûKENLERƒ∞ ---
let bird, pipes, coins, score=0, gameHasStarted=false, gameOverFlag=false;
let bestScore = parseInt(localStorage.getItem('flappy_best')) || 0;
let totalCoins = parseInt(localStorage.getItem('flappy_coins')) || 0;
let currentBird = localStorage.getItem('flappy_skin') || 'bird_yellow';
let ownedBirds = JSON.parse(localStorage.getItem('flappy_owned')) || ['bird_yellow'];

// --- KU≈û TANIMLAMALARI ---
const SKINS = [
    { id: 'bird_yellow', name: 'Sarƒ± Ku≈ü', price: 0, type: 'normal' },
    { id: 'bird_elyo', name: 'Elyo', price: 350, type: 'elyo' },
    { id: 'bird_hakan', name: 'Derbeder Hakan', price: 350, type: 'derbeder' },
    { id: 'bird_goth', name: '...', price: 350, type: 'goth' }
];

// --- SES Sƒ∞STEMƒ∞ (Eski Mekanik) ---
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

function playSound(type) {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.connect(g); g.connect(audioCtx.destination);
    
    if (type === 'jump') {
        osc.type = 'sine';
        osc.frequency.setValueAtTime(350, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(500, audioCtx.currentTime + 0.1);
        g.gain.setValueAtTime(0.3, audioCtx.currentTime);
        g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    } else if (type === 'coin') {
        osc.type = 'square';
        osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
        osc.frequency.setValueAtTime(1600, audioCtx.currentTime + 0.1);
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.2);
        osc.start(); osc.stop(audioCtx.currentTime + 0.2);
    } else if (type === 'dead') {
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(200, audioCtx.currentTime);
        osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.3);
        g.gain.setValueAtTime(0.3, audioCtx.currentTime);
        g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    }
}

// --- UI G√úNCELLEME ---
function updateUI() {
    if(document.getElementById('best-score')) document.getElementById('best-score').innerText = bestScore;
    if(document.getElementById('total-coins')) document.getElementById('total-coins').innerText = totalCoins;
    if(document.getElementById('shop-coins')) document.getElementById('shop-coins').innerText = totalCoins;
}
updateUI();

// --- MARKET Sƒ∞STEMƒ∞ ---
function openShop() {
    document.getElementById('shop-modal').classList.remove('hidden');
    renderShop();
}
function closeShop() { document.getElementById('shop-modal').classList.add('hidden'); }

function renderShop() {
    const list = document.getElementById('shop-list');
    list.innerHTML = "";
    
    SKINS.forEach(skin => {
        const isOwned = ownedBirds.includes(skin.id);
        const isSelected = currentBird === skin.id;
        
        let btnHTML = "";
        if (isSelected) btnHTML = `<button class="buy-btn" disabled>SE√áƒ∞Lƒ∞</button>`;
        else if (isOwned) btnHTML = `<button class="buy-btn use-btn" onclick="selectSkin('${skin.id}')">SE√á</button>`;
        else btnHTML = `<button class="buy-btn" onclick="buySkin('${skin.id}', ${skin.price})">${skin.price} üí∞</button>`;

        const item = document.createElement('div');
        item.className = `shop-item ${isSelected ? 'selected' : ''}`;
        
        // Canvas ID
        const canvasId = `bird-canvas-${skin.id}`;
        
        item.innerHTML = `
            <canvas id="${canvasId}" width="60" height="50" class="bird-preview-canvas"></canvas>
            <div style="font-weight:bold; color:white; font-size:13px; text-align:center;">${skin.name}</div>
            ${btnHTML}
        `;
        list.appendChild(item);
        
        // Canvas'a ku≈üu √ßiz (DOM √ºzerinde)
        setTimeout(() => drawBirdOnCanvas(canvasId, skin.type), 50);
    });
}

function buySkin(id, price) {
    if (totalCoins >= price) {
        totalCoins -= price;
        ownedBirds.push(id);
        localStorage.setItem('flappy_coins', totalCoins);
        localStorage.setItem('flappy_owned', JSON.stringify(ownedBirds));
        selectSkin(id);
        updateUI();
        renderShop();
    } else {
        alert("Paran yetmiyor ≈üampiyon!");
    }
}

function selectSkin(id) {
    currentBird = id;
    localStorage.setItem('flappy_skin', currentBird);
    renderShop();
    if (!gameHasStarted && !gameOverFlag) {
        game.scene.scenes[0].scene.restart();
    }
}

// --- HTML CANVAS ƒ∞√áƒ∞N KU≈û √áƒ∞Zƒ∞Mƒ∞ (MARKET ƒ∞√áƒ∞N) ---
function drawBirdOnCanvas(canvasId, type) {
    const canvas = document.getElementById(canvasId);
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    
    const cx = 30, cy = 25, r = 18; // Merkez ve yarƒ±√ßap

    // Temizle
    ctx.clearRect(0,0,60,50);

    // V√ºcut Rengi
    let color = '#F4D03F'; // Sarƒ± (Default)
    if(type === 'elyo') color = '#3498DB'; // Mavi
    if(type === 'derbeder') color = '#922B21'; // Bordo
    if(type === 'goth') color = '#212121'; // Siyah

    // V√ºcut
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, Math.PI * 2);
    ctx.fillStyle = color;
    ctx.fill();

    // Gotik Dikenleri
    if(type === 'goth') {
        ctx.fillStyle = '#000';
        for(let i=-2; i<=2; i++) {
            ctx.beginPath();
            ctx.moveTo(cx + i*6, cy - r + 5);
            ctx.lineTo(cx + i*6 - 3, cy - r - 8);
            ctx.lineTo(cx + i*6 + 3, cy - r - 8);
            ctx.fill();
        }
    }

    // G√∂z Beyazƒ±
    ctx.beginPath();
    ctx.arc(cx + 8, cy - 6, 7, 0, Math.PI * 2);
    ctx.fillStyle = '#FFF';
    ctx.fill();

    // G√∂z Bebeƒüi
    ctx.beginPath();
    ctx.arc(cx + 10, cy - 6, 3, 0, Math.PI * 2);
    ctx.fillStyle = (type === 'goth') ? '#E74C3C' : '#000'; // Gotikse Kƒ±rmƒ±zƒ±
    ctx.fill();

    // Elyo G√∂zl√ºk
    if(type === 'elyo') {
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.strokeRect(cx + 2, cy - 10, 14, 8); // √áer√ßeve
        ctx.beginPath(); ctx.moveTo(cx+2, cy-6); ctx.lineTo(cx-5, cy-4); ctx.stroke(); // Sap
    }

    // Gaga
    ctx.beginPath();
    ctx.moveTo(cx + 12, cy + 2);
    ctx.lineTo(cx + 24, cy + 6);
    ctx.lineTo(cx + 10, cy + 10);
    ctx.fillStyle = '#F39C12';
    ctx.fill();

    // Kanat
    ctx.beginPath();
    ctx.arc(cx - 5, cy + 5, 8, 0, Math.PI * 2);
    ctx.fillStyle = '#FFF';
    ctx.fill();

    // Derbeder Detaylarƒ±
    if(type === 'derbeder') {
        // Yara izi
        ctx.strokeStyle = '#5B2C6F'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(cx+6, cy+2); ctx.lineTo(cx+12, cy+8); ctx.stroke();
        
        // Sigara
        ctx.fillStyle = '#FFF'; ctx.fillRect(cx+15, cy+10, 10, 3);
        ctx.fillStyle = '#E74C3C'; ctx.fillRect(cx+25, cy+10, 2, 3); // Ate≈ü
        
        // Duman
        ctx.fillStyle = '#BDC3C7';
        ctx.beginPath(); ctx.arc(cx+28, cy+8, 2, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(cx+30, cy+5, 3, 0, Math.PI*2); ctx.fill();
    }
}

// --- KULLANICI & DB ---
window.addEventListener('load', () => {
    const uid = localStorage.getItem('hakan_flappy_uid');
    if (uid) {
        document.getElementById('login-modal').classList.add('hidden');
        verileriGuncelle(uid);
    }
});

function kullaniciKaydet() {
    const isim = document.getElementById('nickname-input').value.trim();
    if (!isim) { alert("ƒ∞sim yaz!"); return; }
    db.collection("leaderboard").add({ name: isim, score: bestScore, coins: totalCoins }).then(doc => {
        localStorage.setItem('hakan_flappy_uid', doc.id);
        document.getElementById('login-modal').classList.add('hidden');
    });
}

function verileriGuncelle(uid) {
    db.collection("leaderboard").doc(uid).onSnapshot(doc => {
        if (doc.exists) {
            const d = doc.data();
            localStorage.setItem('flappy_best', d.score);
            localStorage.setItem('flappy_coins', d.coins || 0);
            bestScore = d.score; totalCoins = d.coins || 0;
            updateUI();
        }
    });
}

function saveToDB() {
    const uid = localStorage.getItem('hakan_flappy_uid');
    if (!uid) return;
    const ref = db.collection("leaderboard").doc(uid);
    db.runTransaction(t => t.get(ref).then(doc => {
        const old = doc.data().score || 0;
        t.update(ref, { score: Math.max(score, old), coins: totalCoins });
    }));
}

function openLeaderboard() {
    document.getElementById('leaderboard-modal').classList.remove('hidden');
    const list = document.getElementById('leaderboard-list');
    list.innerHTML = "";
    db.collection("leaderboard").orderBy("score", "desc").limit(10).get().then(snap => {
        document.getElementById('loading-text').style.display="none";
        snap.forEach((doc, i) => {
            const d = doc.data();
            list.innerHTML += `<li style="padding:8px; border-bottom:1px solid rgba(255,255,255,0.2)">${i+1}. ${d.name} - <b>${d.score}</b></li>`;
        });
    });
}
function closeLeaderboard() { document.getElementById('leaderboard-modal').classList.add('hidden'); }

// --- PHASER OYUN ---
const config = {
    type: Phaser.AUTO,
    parent: 'game-container',
    scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH, width: 450, height: 800 },
    transparent: true,
    physics: { default: 'arcade', arcade: { gravity: { y: 1200 }, debug: false } }, // Gravity geri geldi
    scene: { create: create, update: update }
};

const game = new Phaser.Game(config);
let lastPipeY = 400; 

function create() {
    // Assets (Phaser ƒ∞√ßinde √áizim)
    drawPhaserAssets(this);

    pipes = this.physics.add.group(); coins = this.physics.add.group();
    
    // Se√ßili Karakteri Ba≈ülat
    bird = this.physics.add.sprite(100, 400, currentBird); 
    bird.setDepth(10); bird.body.setCircle(16, 9, 7);

    let ground = this.add.tileSprite(225, 800, 450, 110, 'ground').setOrigin(0.5, 1).setDepth(20);
    this.physics.add.existing(ground, true);
    this.ground = ground;

    this.input.on('pointerdown', jump, this); 
    this.input.keyboard.on('keydown-SPACE', jump, this);
    
    this.physics.add.collider(bird, pipes, gameOver, null, this);
    this.physics.add.collider(bird, ground, gameOver, null, this);
    this.physics.add.overlap(bird, coins, collectCoin, null, this);

    this.time.addEvent({ delay: 1500, callback: addPipe, callbackScope: this, loop: true });
}

function update(time, delta) {
    if(!gameHasStarted) { bird.body.allowGravity=false; bird.y = 400 + Math.sin(time/300)*10; return; }
    if(gameOverFlag) return;
    
    this.ground.tilePositionX += 2.5 * (delta/16);
    if(bird.angle < 30) bird.angle += 2.5;
    if(bird.y < -50 || bird.y > 800) gameOver();

    pipes.children.iterate(p => { if(p && p.x < -60) p.destroy(); });
    coins.children.iterate(c => { if(c && c.x < -60) c.destroy(); });
}

function jump() {
    if(!document.getElementById('shop-modal').classList.contains('hidden')) return;
    if(!document.getElementById('leaderboard-modal').classList.contains('hidden')) return;
    
    if(gameOverFlag) { restartGame.call(this.scene); return; }
    if(!gameHasStarted) { 
        gameHasStarted=true; bird.body.allowGravity=true; 
        document.getElementById('start-msg').style.display='none'; 
        if(audioCtx.state==='suspended') audioCtx.resume();
    }
    bird.setVelocityY(-400); // Zƒ±plama g√ºc√º
    this.tweens.add({ targets: bird, angle: -25, duration: 100 });
    playSound('jump');
}

function addPipe() {
    if(!gameHasStarted || gameOverFlag) return;

    // --- AKILLI BORU ALGORƒ∞TMASI ---
    let minY = Math.max(200, lastPipeY - 180); // Farkƒ± biraz a√ßtƒ±m
    let maxY = Math.min(600, lastPipeY + 180);
    let y = Phaser.Math.Between(minY, maxY);
    lastPipeY = y; 
    
    let gap = Math.max(100, 150 - (score*0.2)); 

    let top = pipes.create(500, y - gap/2, 'pipe').setOrigin(0.5, 1).setFlipY(true);
    let bot = pipes.create(500, y + gap/2, 'pipe').setOrigin(0.5, 0);
    
    [top, bot].forEach(p => { p.body.allowGravity=false; p.setVelocityX(-200); });

    if(Math.random() > 0.6) {
        let c = coins.create(500, y, 'coin');
        c.setVelocityX(-200); c.body.allowGravity=false;
        this.tweens.add({ targets: c, scaleX: 0, duration: 500, yoyo: true, repeat: -1 });
    }

    // Puan
    setTimeout(() => { if(!gameOverFlag && gameHasStarted) { score++; document.getElementById('current-score').innerText=score; } }, 1500);
}

function collectCoin(b, c) {
    c.destroy();
    totalCoins++; updateUI();
    playSound('coin');
}

function gameOver() {
    if(gameOverFlag) return; gameOverFlag=true;
    this.physics.pause(); bird.setTint(0xff0000);
    playSound('dead');
    
    if(score > bestScore) { bestScore=score; localStorage.setItem('flappy_best', bestScore); }
    localStorage.setItem('flappy_coins', totalCoins);
    saveToDB();

    document.getElementById('start-msg').innerText = "TEKRAR DENE";
    document.getElementById('start-msg').style.display = 'block';
}

function restartGame() {
    gameOverFlag=false; gameHasStarted=false; score=0;
    document.getElementById('current-score').innerText="0";
    game.scene.scenes[0].scene.restart();
}

// --- PHASER ASSET √áƒ∞Zƒ∞Mƒ∞ ---
function drawPhaserAssets(scene) {
    // Boru
    let pipeG = scene.make.graphics();
    pipeG.fillStyle(0x73BF2E); pipeG.fillRect(2,0,56,800);
    pipeG.lineStyle(4, 0x558C22); pipeG.strokeRect(0,0,60,800);
    pipeG.fillStyle(0x73BF2E); pipeG.fillRect(0,0,60,30);
    pipeG.strokeRect(0,0,60,30);
    pipeG.generateTexture('pipe', 60, 800);

    // Zemin
    let groundG = scene.make.graphics();
    groundG.fillStyle(0xDED895); groundG.fillRect(0,10,450,100);
    groundG.fillStyle(0x73BF2E); groundG.fillRect(0,0,450,10);
    groundG.generateTexture('ground', 450, 110);

    // Altƒ±n
    let coinG = scene.make.graphics();
    coinG.fillStyle(0xFFD700); coinG.fillCircle(15,15,15);
    coinG.fillStyle(0xF1C40F); coinG.fillCircle(15,15,10);
    coinG.generateTexture('coin', 30, 30);

    // KU≈ûLAR (Phaser Versiyonlarƒ±)
    drawPhaserBird(scene, 'bird_yellow', 0xF4D03F);
    drawPhaserBird(scene, 'bird_elyo', 0x3498DB, true);
    drawPhaserBird(scene, 'bird_hakan', 0x922B21, false, true);
    drawPhaserBird(scene, 'bird_goth', 0x212121, false, false, true);
}

function drawPhaserBird(scene, key, color, glasses=false, cig=false, goth=false) {
    let g = scene.make.graphics();
    
    // V√ºcut
    g.fillStyle(color); g.fillCircle(25,20,18);
    
    // Gotik Dikenler
    if(goth) {
        g.fillStyle(0x000000);
        g.fillTriangle(25, 0, 20, 10, 30, 10);
        g.fillTriangle(15, 2, 10, 12, 20, 12);
        g.fillTriangle(35, 2, 30, 12, 40, 12);
    }

    // G√∂z
    g.fillStyle(0xFFFFFF); g.fillCircle(33,14,7);
    g.fillStyle(goth ? 0xE74C3C : 0x000000); g.fillCircle(35,14,3); // Gotik kƒ±rmƒ±zƒ± g√∂z

    // G√∂zl√ºk
    if(glasses) {
        g.lineStyle(2, 0x333333);
        g.strokeRect(26, 8, 14, 10);
        g.beginPath(); g.moveTo(26,12); g.lineTo(15,16); g.stroke();
    }

    // Gaga
    g.fillStyle(0xF39C12); g.fillTriangle(38,20, 52,24, 38,28);

    // Kanat
    g.fillStyle(0xFFFFFF); g.fillCircle(15,20,6);

    // Sigara (Hakan)
    if(cig) {
        // ƒ∞z
        g.lineStyle(2, 0x5B2C6F); g.beginPath(); g.moveTo(33,22); g.lineTo(38,28); g.stroke();
        // Sigara
        g.fillStyle(0xFFFFFF); g.fillRect(40, 26, 10, 3);
        g.fillStyle(0xE74C3C); g.fillCircle(50, 27.5, 2); // Ate≈ü
    }

    g.generateTexture(key, 55, 45);
}
</script>
</body>
</html>
