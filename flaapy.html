<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Flappy Hakan</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #4ec0ca; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Inter', sans-serif; }
        
        /* Skor Paneli (Ortada) */
        #ui-layer { position: fixed; top: 10%; width: 100%; text-align: center; pointer-events: none; color: white; text-shadow: 2px 2px 0 rgba(0,0,0,0.2); z-index: 100; font-weight: bold; }
        
        /* Yeni Coin Paneli (Saƒü √úst) */
        #coin-ui { position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.2); padding: 8px 15px; border-radius: 20px; color: #FFD700; font-weight: bold; font-size: 18px; display: flex; align-items: center; gap: 8px; z-index: 100; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 2px solid #fff; }
        
        .back-btn { position: fixed; bottom: 20px; left: 20px; padding: 12px 24px; background: #ffffff; color: #4ec0ca; text-decoration: none; border-radius: 50px; font-weight: bold; box-shadow: 0 4px 0 #3da0a9; transition: 0.1s; z-index: 100; font-family: sans-serif; }
        .back-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #3da0a9; }
    </style>
</head>
<body>

    <div id="coin-ui">
        <span>üí∞</span> <span id="total-coins">0</span>
    </div>

    <div id="ui-layer">
        <div style="font-size: 60px; line-height: 1;" id="current-score">0</div>
        <div style="font-size: 18px; margin-top: 5px; opacity: 0.9;">REKOR: <span id="best-score">0</span></div>
    </div>

    <a href="index.html" class="back-btn">‚Üê √áIKI≈û</a>

    <script>
    const isMobile = window.innerWidth < 768;
    const config = {
        type: Phaser.AUTO,
        width: isMobile ? window.innerWidth : 400,
        height: isMobile ? window.innerHeight : 600,
        transparent: true,
        physics: {
            default: 'arcade',
            arcade: { 
                gravity: { y: 1100 }, 
                debug: false 
            }
        },
        scene: { preload: preload, create: create, update: update }
    };

    let bird, pipes, coins, score = 0;
    // LocalStorage'dan verileri √ßekiyoruz
    let bestScore = localStorage.getItem('flappy_best') || 0;
    let totalCoins = parseInt(localStorage.getItem('flappy_coins')) || 0;
    
    let gameHasStarted = false;
    const game = new Phaser.Game(config);
    
    // UI G√ºncelleme
    document.getElementById('best-score').innerText = bestScore;
    document.getElementById('total-coins').innerText = totalCoins;

    function preload() {
        // Kodla √ßizim yapƒ±yoruz, dƒ±≈üarƒ±dan resim yok.
    }

    function create() {
        // --- 1. COIN √áƒ∞Zƒ∞Mƒ∞ (G√ºzel bir Altƒ±n) ---
        let coinG = this.make.graphics();
        // Dƒ±≈ü √áember (Koyu Altƒ±n)
        coinG.fillStyle(0xFFD700, 1);
        coinG.fillCircle(15, 15, 15);
        coinG.lineStyle(2, 0xB8860B, 1);
        coinG.strokeCircle(15, 15, 15);
        // ƒ∞√ß Parlama (A√ßƒ±k Sarƒ±)
        coinG.fillStyle(0xFFFACD, 1); 
        coinG.fillCircle(15, 15, 10);
        // Dolar ƒ∞≈üareti Yerine "H" Harfi veya Basit √áizgi (Minimalist)
        coinG.fillStyle(0xB8860B, 1);
        coinG.fillRect(13, 8, 4, 14); 
        coinG.generateTexture('coin', 32, 32);

        // --- 2. KRAL KU≈ûU √áƒ∞Zƒ∞Mƒ∞ (Pembe Ta√ßlƒ±) ---
        let birdG = this.make.graphics();
        birdG.fillStyle(0xFF69B4, 1); // Pembe Ta√ß
        birdG.fillTriangle(10, 8, 14, 0, 18, 8); 
        birdG.fillTriangle(18, 8, 22, -2, 26, 8); 
        birdG.fillTriangle(26, 8, 30, 0, 34, 8); 
        birdG.fillStyle(0xF4CE42, 1); // Sarƒ± G√∂vde
        birdG.fillCircle(22, 20, 14);
        birdG.fillStyle(0xFFFFFF, 1); // G√∂z
        birdG.fillCircle(28, 16, 6);
        birdG.fillStyle(0x000000, 1); // G√∂z Bebeƒüi
        birdG.fillCircle(30, 16, 2);
        birdG.fillStyle(0xF39C12, 1); // Gaga
        birdG.fillTriangle(32, 20, 44, 23, 32, 26);
        birdG.generateTexture('bird', 45, 40);

        // --- 3. BORU √áƒ∞Zƒ∞Mƒ∞ ---
        let pipeG = this.make.graphics();
        pipeG.fillStyle(0x73BF2E, 1); 
        pipeG.fillRect(2, 2, 50, 600);
        pipeG.lineStyle(4, 0x558C22, 1); 
        pipeG.strokeRect(0, 0, 54, 600);
        pipeG.fillStyle(0x73BF2E, 1);
        pipeG.fillRect(0, 0, 54, 26);
        pipeG.strokeRect(0, 0, 54, 26);
        pipeG.generateTexture('pipe', 56, 600);

        // --- 4. ZEMƒ∞N √áƒ∞Zƒ∞Mƒ∞ ---
        let groundG = this.make.graphics();
        groundG.fillStyle(0xDED895, 1); 
        groundG.fillRect(0, 10, 400, 100);
        groundG.fillStyle(0x73BF2E, 1); 
        groundG.fillRect(0, 0, 400, 15);
        groundG.lineStyle(3, 0x558C22, 1); 
        groundG.strokeRect(0, 0, 400, 15);
        groundG.generateTexture('ground', 400, 110);

        // --- 5. BULUT √áƒ∞Zƒ∞Mƒ∞ (TAM BEYAZ) ---
        let cloudG = this.make.graphics();
        cloudG.fillStyle(0xFFFFFF, 1); // Tam Beyaz
        cloudG.fillCircle(20, 20, 20);
        cloudG.fillCircle(45, 20, 25);
        cloudG.fillCircle(75, 20, 20);
        cloudG.generateTexture('cloud', 100, 50);

        // --- SAHNE NESNELERƒ∞ ---
        
        // Bulutlar (Daha parlak ve beyaz)
        this.add.image(config.width * 0.2, config.height * 0.2, 'cloud').setAlpha(0.9);
        this.add.image(config.width * 0.8, config.height * 0.35, 'cloud').setAlpha(0.8).setScale(0.8);

        pipes = this.physics.add.group();
        coins = this.physics.add.group(); // Coin grubu

        bird = this.physics.add.sprite(config.width / 4, config.height / 2, 'bird');
        bird.setDepth(10);
        bird.body.setCircle(12, 10, 8); 

        this.ground = this.add.tileSprite(config.width/2, config.height, config.width, 110, 'ground').setOrigin(0.5, 1).setDepth(20);
        this.physics.add.existing(this.ground, true);

        this.input.on('pointerdown', jump, this);
        this.input.keyboard.on('keydown-SPACE', jump, this);

        this.pipeTimer = this.time.addEvent({
            delay: 1500,
            callback: addPipeColumn,
            callbackScope: this,
            loop: true,
            paused: true
        });

        // √áarpƒ±≈ümalar
        this.physics.add.collider(bird, pipes, gameOver, null, this);
        this.physics.add.collider(bird, this.ground, gameOver, null, this);
        
        // Coin Toplama Olayƒ± (Overlap: ƒ∞√ßinden ge√ßince tetiklenir)
        this.physics.add.overlap(bird, coins, collectCoin, null, this);
    }

    function update() {
        if (!gameHasStarted) {
            bird.body.allowGravity = false;
            bird.y = (config.height / 2) + Math.sin(this.time.now / 400) * 8; 
            return;
        }

        this.ground.tilePositionX += 2.5; 

        if (bird.angle < 30) bird.angle += 2.5; 
        
        if (bird.y < -50) gameOver.call(this);
    }

    function jump() {
        if (!gameHasStarted) {
            gameHasStarted = true;
            bird.body.allowGravity = true;
            this.pipeTimer.paused = false;
        }
        bird.setVelocityY(-350);
        this.tweens.add({ targets: bird, angle: -25, duration: 100 });
    }

    function addPipeColumn() {
        const gap = 170; // Bo≈üluk biraz rahat olsun coin i√ßin
        const pipeY = Phaser.Math.Between(150, config.height - gap - 150);

        // Borular
        let topPipe = pipes.create(config.width + 50, pipeY, 'pipe').setOrigin(0.5, 1).setFlipY(true);
        let bottomPipe = pipes.create(config.width + 50, pipeY + gap, 'pipe').setOrigin(0.5, 0);

        pipes.getChildren().forEach(p => {
            if (p.body && !p.body.velocity.x) { 
                p.body.allowGravity = false;
                p.setVelocityX(-200);
                p.body.setSize(48, 600);
                p.body.setOffset(4, 0);
            }
        });

        // --- COIN EKLEME MANTIƒûI ---
        // Coin, borularƒ±n tam arasƒ±ndaki bo≈üluƒüun ortasƒ±nda olu≈üsun
        let coinY = pipeY + (gap / 2); 
        let coin = coins.create(config.width + 50, coinY, 'coin');
        
        coin.setVelocityX(-200); // Borularla aynƒ± hƒ±zda sola gitsin
        coin.body.allowGravity = false; // Yer√ßekiminden etkilenmesin

        // COIN ANƒ∞MASYONU (Kendi etrafƒ±nda d√∂nme efekti)
        this.tweens.add({
            targets: coin,
            scaleX: 0, // X ekseninde daralarak d√∂nme hissi verir
            duration: 500,
            yoyo: true, // Geri a√ßƒ±l
            repeat: -1 // Sonsuz d√∂ng√º
        });

        // Skor Arttƒ±rma
        this.time.delayedCall(1500, () => {
             if(gameHasStarted) {
                score += 1; 
                document.getElementById('current-score').innerText = score;
             }
        });
    }

    function collectCoin(bird, coin) {
        coin.disableBody(true, true); // Coini ekrandan sil
        
        // Coin Sayacƒ±nƒ± Arttƒ±r
        totalCoins += 1;
        document.getElementById('total-coins').innerText = totalCoins;
        
        // Hafƒ±zaya Kaydet
        localStorage.setItem('flappy_coins', totalCoins);
    }

    function gameOver() {
        if (score > bestScore) {
            bestScore = score;
            localStorage.setItem('flappy_best', bestScore);
            document.getElementById('best-score').innerText = bestScore;
        }
        
        // Oyun bitince coinleri de kaydet (Garanti olsun)
        localStorage.setItem('flappy_coins', totalCoins);

        gameHasStarted = false;
        score = 0;
        document.getElementById('current-score').innerText = "0";
        this.scene.restart();
    }
    </script>
</body>
</html>
