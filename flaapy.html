<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Flappy Hakan</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #4ec0ca; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Inter', sans-serif; }
        #ui-layer { position: fixed; top: 10%; width: 100%; text-align: center; pointer-events: none; color: white; text-shadow: 2px 2px 0 rgba(0,0,0,0.2); z-index: 100; font-weight: bold; }
        .back-btn { position: fixed; bottom: 20px; left: 20px; padding: 12px 24px; background: #ffffff; color: #4ec0ca; text-decoration: none; border-radius: 50px; font-weight: bold; box-shadow: 0 4px 0 #3da0a9; transition: 0.1s; z-index: 100; font-family: sans-serif; }
        .back-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #3da0a9; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div style="font-size: 60px; line-height: 1;" id="current-score">0</div>
        <div style="font-size: 18px; margin-top: 5px; opacity: 0.9;">EN İYİ: <span id="best-score">0</span></div>
    </div>

    <a href="index.html" class="back-btn">← ÇIKIŞ</a>

    <script>
    const isMobile = window.innerWidth < 768;
    const config = {
        type: Phaser.AUTO,
        width: isMobile ? window.innerWidth : 400,
        height: isMobile ? window.innerHeight : 600,
        transparent: true,
        physics: {
            default: 'arcade',
            arcade: { 
                gravity: { y: 1100 }, 
                debug: false 
            }
        },
        scene: { preload: preload, create: create, update: update }
    };

    let bird, pipes, score = 0, bestScore = localStorage.getItem('flappy_best') || 0;
    let gameHasStarted = false;
    const game = new Phaser.Game(config);
    document.getElementById('best-score').innerText = bestScore;

    function preload() {
        // Resim yüklemiyoruz, her şeyi kodla çiziyoruz (Kırılmaz Link)
    }

    function create() {
        // --- 1. KRAL KUŞU ÇİZELİM (Pembe Taçlı) ---
        let birdG = this.make.graphics();
        
        // Önce Tacı Çizelim (Kafanın üstüne gelsin diye y koordinatları düşük)
        birdG.fillStyle(0xFF69B4, 1); // "HotPink" rengi (Canlı Pembe)
        // Tacın 3 sivri ucu (Poligon çizimi)
        birdG.fillTriangle(10, 8, 14, 0, 18, 8); // Sol uç
        birdG.fillTriangle(18, 8, 22, -2, 26, 8); // Orta uç (Daha yüksek)
        birdG.fillTriangle(26, 8, 30, 0, 34, 8); // Sağ uç

        // Kuşun Gövdesi (Sarı) - Tacın altına çiziyoruz
        birdG.fillStyle(0xF4CE42, 1);
        birdG.fillCircle(22, 20, 14); // Gövdeyi biraz aşağı aldık ki taç sığsın

        // Göz (Beyaz)
        birdG.fillStyle(0xFFFFFF, 1);
        birdG.fillCircle(28, 16, 6);
        
        // Göz Bebeği (Siyah)
        birdG.fillStyle(0x000000, 1);
        birdG.fillCircle(30, 16, 2);

        // Gaga (Turuncu)
        birdG.fillStyle(0xF39C12, 1);
        birdG.fillTriangle(32, 20, 44, 23, 32, 26);

        // Dokuyu oluştur (Boyutu büyüttük ki taç kesilmesin: 45x40)
        birdG.generateTexture('bird', 45, 40);


        // --- 2. BORUYU ÇİZELİM (Flat Yeşil) ---
        let pipeG = this.make.graphics();
        pipeG.fillStyle(0x73BF2E, 1); 
        pipeG.fillRect(2, 2, 50, 600);
        pipeG.lineStyle(4, 0x558C22, 1); 
        pipeG.strokeRect(0, 0, 54, 600);
        pipeG.fillStyle(0x73BF2E, 1);
        pipeG.fillRect(0, 0, 54, 26);
        pipeG.strokeRect(0, 0, 54, 26);
        pipeG.generateTexture('pipe', 56, 600);

        // --- 3. ZEMİNİ ÇİZELİM ---
        let groundG = this.make.graphics();
        groundG.fillStyle(0xDED895, 1); 
        groundG.fillRect(0, 10, 400, 100);
        groundG.fillStyle(0x73BF2E, 1); 
        groundG.fillRect(0, 0, 400, 15);
        groundG.lineStyle(3, 0x558C22, 1); 
        groundG.strokeRect(0, 0, 400, 15);
        groundG.generateTexture('ground', 400, 110);

        // --- 4. BULUT ÇİZELİM ---
        let cloudG = this.make.graphics();
        cloudG.fillStyle(0xFFFFFF, 1);
        cloudG.fillCircle(20, 20, 20);
        cloudG.fillCircle(45, 20, 25);
        cloudG.fillCircle(75, 20, 20);
        cloudG.generateTexture('cloud', 100, 50);

        // --- OYUN NESNELERİ ---
        
        this.add.image(config.width * 0.2, config.height * 0.2, 'cloud').setAlpha(0.5);
        this.add.image(config.width * 0.8, config.height * 0.35, 'cloud').setAlpha(0.3).setScale(0.8);

        pipes = this.physics.add.group();

        bird = this.physics.add.sprite(config.width / 4, config.height / 2, 'bird');
        bird.setDepth(10);
        // Çarpışma alanını gövdeye göre ayarladık (Taca çarparsa ölmesin, yazıktır)
        bird.body.setCircle(12, 10, 8); 

        this.ground = this.add.tileSprite(config.width/2, config.height, config.width, 110, 'ground').setOrigin(0.5, 1).setDepth(20);
        this.physics.add.existing(this.ground, true);

        this.input.on('pointerdown', jump, this);
        this.input.keyboard.on('keydown-SPACE', jump, this);

        this.pipeTimer = this.time.addEvent({
            delay: 1500,
            callback: addPipeColumn,
            callbackScope: this,
            loop: true,
            paused: true
        });

        this.physics.add.collider(bird, pipes, gameOver, null, this);
        this.physics.add.collider(bird, this.ground, gameOver, null, this);
    }

    function update() {
        if (!gameHasStarted) {
            bird.body.allowGravity = false;
            bird.y = (config.height / 2) + Math.sin(this.time.now / 400) * 8; 
            return;
        }

        this.ground.tilePositionX += 2.5; 

        if (bird.angle < 30) bird.angle += 2.5; 
        
        if (bird.y < -50) gameOver.call(this);
    }

    function jump() {
        if (!gameHasStarted) {
            gameHasStarted = true;
            bird.body.allowGravity = true;
            this.pipeTimer.paused = false;
        }
        bird.setVelocityY(-350);
        this.tweens.add({ targets: bird, angle: -25, duration: 100 });
    }

    function addPipeColumn() {
        const gap = 160; 
        const pipeY = Phaser.Math.Between(150, config.height - gap - 150);

        let topPipe = pipes.create(config.width + 50, pipeY, 'pipe');
        topPipe.setOrigin(0.5, 1); 
        topPipe.setFlipY(true);

        let bottomPipe = pipes.create(config.width + 50, pipeY + gap, 'pipe');
        bottomPipe.setOrigin(0.5, 0); 

        pipes.getChildren().forEach(p => {
            if (p.body && !p.body.velocity.x) { 
                p.body.allowGravity = false;
                p.setVelocityX(-200);
                p.body.setSize(48, 600);
                p.body.setOffset(4, 0);
            }
        });

        // --- SKOR GÜNCELLEMESİ (DÜZELTİLDİ) ---
        // Artık her boru geçişinde TAM 1 puan veriyoruz.
        this.time.delayedCall(1500, () => {
             if(gameHasStarted) {
                score += 1; // Eskiden 0.5 idi, şimdi 1 oldu.
                document.getElementById('current-score').innerText = score;
             }
        });
    }

    function gameOver() {
        if (score > bestScore) {
            bestScore = score;
            localStorage.setItem('flappy_best', bestScore);
            document.getElementById('best-score').innerText = bestScore;
        }
        gameHasStarted = false;
        score = 0;
        document.getElementById('current-score').innerText = "0";
        this.scene.restart();
    }
    </script>
</body>
</html>
