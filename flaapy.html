<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Flappy Hakan</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #71c5cf; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #ui-layer { position: fixed; top: 40px; width: 100%; text-align: center; pointer-events: none; color: white; text-shadow: 4px 4px 0 rgba(0,0,0,0.2); z-index: 10; font-family: 'Arial Black', sans-serif; }
        .back-btn { position: fixed; bottom: 20px; left: 20px; padding: 12px 24px; background: #ffffff; color: #333; text-decoration: none; border-radius: 50px; font-weight: bold; box-shadow: 0 4px 0 #ccc; transition: 0.1s; z-index: 20; }
        .back-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #ccc; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div style="font-size: 60px;" id="current-score">0</div>
        <div style="font-size: 16px; letter-spacing: 2px;">EN İYİ: <span id="best-score">0</span></div>
    </div>

    <a href="index.html" class="back-btn">← ÇIKIŞ</a>

    <script>
    const isMobile = window.innerWidth < 768;
    const config = {
        type: Phaser.AUTO,
        width: isMobile ? window.innerWidth : 400,
        height: isMobile ? window.innerHeight : 600,
        physics: {
            default: 'arcade',
            arcade: { gravity: { y: 1100 }, debug: false }
        },
        scene: { preload: preload, create: create, update: update }
    };

    let bird, pipes, score = 0, bestScore = localStorage.getItem('flappy_best') || 0;
    let gameHasStarted = false;
    const game = new Phaser.Game(config);
    document.getElementById('best-score').innerText = bestScore;

    function preload() {
        // Fotoğraftaki o temiz görselleri GitHub üzerinden profesyonel assetlerle çekiyoruz
        this.load.image('bg', 'https://raw.githubusercontent.com/samme/phaser-examples-assets/master/sprites/background-day.png');
        this.load.image('bird', 'https://raw.githubusercontent.com/samme/phaser-examples-assets/master/sprites/yellowbird-midflap.png');
        this.load.image('pipe', 'https://raw.githubusercontent.com/samme/phaser-examples-assets/master/sprites/pipe-green.png');
        this.load.image('base', 'https://raw.githubusercontent.com/samme/phaser-examples-assets/master/sprites/base.png');
    }

    function create() {
        // Arka Plan (O fotoğraftaki gibi ferah)
        let back = this.add.image(0, 0, 'bg').setOrigin(0, 0);
        back.displayWidth = config.width;
        back.displayHeight = config.height;

        pipes = this.physics.add.group();

        // Kuş (Sarı ve net)
        bird = this.physics.add.sprite(config.width / 4, config.height / 2, 'bird');
        bird.setScale(1.5).setDepth(10);
        
        // Zemin (Fotoğraftaki gibi dalgalı yeşil alanın alt kısmı)
        this.base = this.add.tileSprite(config.width/2, config.height - 50, config.width, 112, 'base').setDepth(20);

        this.input.on('pointerdown', jump, this);
        this.input.keyboard.on('keydown-SPACE', jump, this);

        this.pipeTimer = this.time.addEvent({
            delay: 1500,
            callback: addPipeColumn,
            callbackScope: this,
            loop: true,
            paused: true
        });

        this.physics.add.collider(bird, pipes, gameOver, null, this);
    }

    function update() {
        if (!gameHasStarted) {
            bird.body.allowGravity = false;
            return;
        }

        // Mekanik aynı kalsın dedin, sadece zemin aksın
        this.base.tilePositionX += 2;

        if (bird.angle < 30) bird.angle += 2;
        
        if (bird.y > config.height - 100 || bird.y < -50) gameOver.call(this);
    }

    function jump() {
        if (!gameHasStarted) {
            gameHasStarted = true;
            bird.body.allowGravity = true;
            this.pipeTimer.paused = false;
        }
        bird.setVelocityY(-350);
        bird.angle = -20;
    }

    function addPipeColumn() {
        const gap = 160; // Geçiş aralığı
        const pipeY = Phaser.Math.Between(100, config.height - gap - 200);

        // Üst Boru (Fotoğraftaki gibi gölgeli ve net)
        let topPipe = pipes.create(config.width + 50, pipeY, 'pipe').setOrigin(0.5, 1).setFlipY(true);
        
        // Alt Boru
        let bottomPipe = pipes.create(config.width + 50, pipeY + gap, 'pipe').setOrigin(0.5, 0);

        pipes.getChildren().forEach(p => {
            p.body.allowGravity = false;
            p.setVelocityX(-200);
        });

        // Skor mantığı (Çift boru olduğu için her geçişte 1 artsın)
        this.time.delayedCall(1500, () => {
             if(gameHasStarted) {
                score += 0.5; 
                document.getElementById('current-score').innerText = Math.floor(score);
             }
        });
    }

    function gameOver() {
        if (Math.floor(score) > bestScore) {
            bestScore = Math.floor(score);
            localStorage.setItem('flappy_best', bestScore);
            document.getElementById('best-score').innerText = bestScore;
        }
        gameHasStarted = false;
        score = 0;
        document.getElementById('current-score').innerText = "0";
        this.scene.restart();
    }
    </script>
</body>
</html>
