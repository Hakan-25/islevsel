<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Memory Pro</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;900&display=swap');

        :root {
            --bg-dark: #0f172a;
            --primary: #6366f1;    /* Indigo */
            --primary-glow: #818cf8;
            --glass: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.1);
            --success: #10b981;
            --error: #f43f5e;
            --warning: #f59e0b;
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #312e81 0%, #0f172a 80%);
            height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            font-family: 'Outfit', sans-serif; color: white; overflow: hidden;
        }

        /* --- ÃœST BÄ°LGÄ° Ã‡UBUÄžU (Mobil Uyumlu) --- */
        #ui-header {
            margin-top: 15px;
            display: flex; gap: 15px;
            z-index: 10;
            background: var(--glass);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid var(--border);
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 95%;
            flex-wrap: wrap; /* Mobilde taÅŸarsa aÅŸaÄŸÄ± insin */
            justify-content: center;
        }

        .stat-box { 
            display: flex; flex-direction: column; align-items: center; 
            line-height: 1.1; min-width: 55px;
        }
        .stat-label { 
            font-size: 0.6rem; color: #cbd5e1; letter-spacing: 0.5px; 
            font-weight: 700; text-transform: uppercase; 
        }
        .stat-val { 
            font-size: 1.1rem; font-weight: 900; color: white; 
            text-shadow: 0 0 10px rgba(255,255,255,0.2); 
        }
        #score-val { color: var(--warning); }

        /* --- OYUN ALANI --- */
        .game-board {
            display: grid; gap: 8px;
            width: 95vmin; max-width: 500px; aspect-ratio: 1;
            perspective: 1000px; z-index: 5; margin-top: 20px;
            /* Mobilde Ã§ok bÃ¼yÃ¼k olmasÄ±n */
            max-height: 70vh;
        }

        /* --- KARTLAR --- */
        .card {
            position: relative; cursor: pointer;
            transform-style: preserve-3d; transform: scale(0);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 8px;
        }
        .card.active { transform: scale(1); }

        .card-inner {
            position: relative; width: 100%; height: 100%;
            text-align: center; transition: transform 0.5s;
            transform-style: preserve-3d; border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .card.flipped .card-inner { transform: rotateY(180deg); }
        
        /* EÅŸleÅŸmiÅŸ Kart Stili */
        .card.matched { cursor: default; }
        .card.matched .card-inner { 
            box-shadow: 0 0 15px var(--success); 
            border: 2px solid var(--success); 
        }
        
        .card.shake { animation: shake 0.4s; }

        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; border: 1px solid var(--border);
        }

        .card-front {
            background: linear-gradient(135deg, #1e1b4b 0%, #4338ca 100%);
            color: rgba(255,255,255,0.2); font-size: 1.5rem; font-weight: 900;
        }
        .card-front::after { content: '?'; }

        .card-back { background: #fff; transform: rotateY(180deg); }
        .card-back img { width: 100%; height: 100%; object-fit: cover; }

        /* --- PENCERELER (MODALS) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.98); z-index: 100;
            display: none; justify-content: center; align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            background: #1e293b; padding: 30px; border-radius: 24px;
            text-align: center; border: 1px solid var(--border);
            box-shadow: 0 25px 50px rgba(0,0,0,0.6);
            width: 100%; max-width: 360px; position: relative;
            display: flex; flex-direction: column; gap: 15px;
        }
        
        h1 { margin: 0; font-size: 1.8rem; background: linear-gradient(to right, #818cf8, #c084fc); -webkit-background-clip: text; color: transparent; }
        p { color: #94a3b8; font-size: 0.9rem; margin: 0; }

        input {
            width: 100%; padding: 12px;
            background: #0f172a; border: 2px solid var(--border);
            border-radius: 12px; color: white; font-size: 1rem;
            text-align: center; font-weight: bold; outline: none;
        }
        input:focus { border-color: var(--primary); }

        /* BUTONLAR */
        .btn-group {
            display: flex; flex-direction: column; gap: 10px; width: 100%;
        }
        
        .btn {
            width: 100%; padding: 14px; border: none; border-radius: 12px;
            color: white; font-weight: 700; font-size: 0.95rem; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: 0.2s; text-transform: uppercase; letter-spacing: 0.5px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn:active { transform: scale(0.98); }
        
        .btn-start { background: linear-gradient(135deg, var(--primary), #4f46e5); }
        .btn-easy { background: linear-gradient(135deg, #10b981, #059669); }
        .btn-mid { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .btn-hard { background: linear-gradient(135deg, #ef4444, #b91c1c); }
        .btn-menu { background: #334155; border: 1px solid #475569; }

        /* YÃœKLEME Ã‡UBUÄžU */
        #loader-container { display: none; margin-top: 10px; }
        .loader-track { width: 100%; height: 6px; background: #334155; border-radius: 10px; overflow: hidden; }
        .loader-fill { width: 0%; height: 100%; background: var(--success); transition: width 0.3s; }
        #loader-text { margin-top: 5px; font-size: 0.75rem; color: var(--success); font-weight: bold; }

        .error-msg { color: var(--error); font-size: 0.85rem; display: none; font-weight: bold; }

        /* SKOR TABLOSU */
        .tabs { display: flex; gap: 5px; justify-content: center; margin-bottom: 10px; }
        .tab { padding: 6px 12px; border-radius: 15px; background: rgba(255,255,255,0.05); font-size: 0.75rem; cursor: pointer; }
        .tab.active { background: var(--primary); color: white; }
        .leaderboard-list { max-height: 180px; overflow-y: auto; text-align: left; font-size: 0.85rem; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; }
        .score-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }

        #confetti-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            75% { transform: translateX(5px) rotate(5deg); }
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div id="ui-header">
        <div class="stat-box">
            <span class="stat-label">SÃœRE</span>
            <span class="stat-val" id="time-val">00:00</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">HAMLE</span>
            <span class="stat-val" id="moves-val">0</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">PUAN</span>
            <span class="stat-val" id="score-val">0</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">ZORLUK</span>
            <span class="stat-val" id="diff-val" style="font-size:0.9rem; margin-top:4px;">-</span>
        </div>
    </div>

    <div class="game-board" id="game-board"></div>

    <div id="modal-login" class="modal-overlay">
        <div class="modal-content">
            <h1>KÄ°MLÄ°K</h1>
            <p>Skor tablosunda gÃ¶rÃ¼necek isim:</p>
            <input type="text" id="username-input" placeholder="Ä°sim Giriniz" maxlength="12" autocomplete="off">
            <div class="btn-group">
                <button class="btn btn-start" onclick="loginSystem.attemptLogin()">KAYDET</button>
            </div>
            <div class="error-msg" id="login-error"></div>
        </div>
    </div>

    <div id="modal-difficulty" class="modal-overlay">
        <div class="modal-content">
            <h1>YENÄ° OYUN</h1>
            <p>HoÅŸgeldin <span id="player-name-display" style="color:var(--primary-glow); font-weight:bold;"></span>.<br>Mod seÃ§ ve baÅŸla.</p>
            
            <div id="diff-buttons" class="btn-group">
                <button class="btn btn-easy" onclick="gameSystem.startPreload('easy')">ðŸŸ¢ KOLAY (16 Kart)</button>
                <button class="btn btn-mid" onclick="gameSystem.startPreload('medium')">ðŸŸ  ORTA (20 Kart)</button>
                <button class="btn btn-hard" onclick="gameSystem.startPreload('hard')">ðŸ”´ ZOR (24 Kart)</button>
            </div>

            <div id="loader-container">
                <div class="loader-track"><div class="loader-fill" id="loader-fill"></div></div>
                <div id="loader-text">GÃ¶rseller YÃ¼kleniyor %0</div>
            </div>
        </div>
    </div>

    <div id="modal-end" class="modal-overlay">
        <div class="modal-content">
            <h1 id="end-title">OYUN BÄ°TTÄ°</h1>
            <p id="end-desc">...</p>
            
            <div class="tabs">
                <div class="tab" id="tab-easy" onclick="leaderboardSystem.load('easy')">Kolay</div>
                <div class="tab" id="tab-medium" onclick="leaderboardSystem.load('medium')">Orta</div>
                <div class="tab" id="tab-hard" onclick="leaderboardSystem.load('hard')">Zor</div>
            </div>
            <div class="leaderboard-list" id="leaderboard-content">YÃ¼kleniyor...</div>

            <div class="btn-group">
                <button class="btn btn-start" onclick="ui.showScreen('modal-difficulty')">TEKRAR OYNA</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, getDocs, updateDoc, doc, orderBy, limit } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBW8xNsDjp3duXyuPukuBKNlOYw-uv6W1c",
            authDomain: "hakantools-a44c0.firebaseapp.com",
            projectId: "hakantools-a44c0",
            storageBucket: "hakantools-a44c0.firebasestorage.app",
            messagingSenderId: "216753237718",
            appId: "1:216753237718:web:ea012c7dc4fdb7e7d72377",
            measurementId: "G-4GWK9BS40T"
        };

        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
        } catch (e) { console.error("Firebase HatasÄ±:", e); }

        window.saveScoreToFirebase = async function(score, difficulty) {
            if(!db || !localStorage.getItem('memory_username')) return;
            const name = localStorage.getItem('memory_username');
            const colName = `memory_scores_${difficulty}`;

            try {
                const q = query(collection(db, colName), where("name", "==", name));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    const docRef = querySnapshot.docs[0];
                    if (score > docRef.data().score) {
                        await updateDoc(doc(db, colName, docRef.id), { score: score, date: new Date() });
                    }
                } else {
                    await addDoc(collection(db, colName), { name: name, score: score, date: new Date() });
                }
            } catch (e) { console.error("KayÄ±t HatasÄ±:", e); }
        };

        window.getLeaderboard = async function(difficulty) {
            if(!db) return "<p>BaÄŸlantÄ± yok.</p>";
            try {
                const q = query(collection(db, `memory_scores_${difficulty}`), orderBy("score", "desc"), limit(10));
                const querySnapshot = await getDocs(q);
                let html = "";
                let rank = 1;
                querySnapshot.forEach((doc) => {
                    const d = doc.data();
                    let color = rank === 1 ? '#ffd700' : rank === 2 ? '#c0c0c0' : rank === 3 ? '#cd7f32' : 'white';
                    html += `<div class="score-row"><span style="color:${color}; font-weight:bold;">#${rank}</span><span style="color:white;">${d.name}</span><span style="color:var(--primary-glow);">${d.score}</span></div>`;
                    rank++;
                });
                return html || "<p>KayÄ±t yok.</p>";
            } catch (e) { return "<p>Veri alÄ±namadÄ±.</p>"; }
        };
    </script>

    <script>
    /* 1. GENÄ°Åž GÃ–RSEL HAVUZU (Variety) */
    // 100+ Picsum ID'si (DoÄŸa, Åžehir, Teknoloji karÄ±ÅŸÄ±k)
    const MASTER_IMAGE_POOL = [
        10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 25, 28, 29, 33, 40, 48, 54, 57, 58, 60, 
        70, 76, 89, 96, 102, 103, 110, 116, 117, 119, 122, 128, 137, 146, 152, 164, 175, 180,
        190, 191, 192, 195, 200, 201, 202, 215, 216, 217, 218, 225, 237, 238, 239, 249, 250,
        251, 252, 257, 258, 259, 275, 280, 299, 300, 301, 302, 305, 306, 310, 311, 318, 320,
        325, 330, 335, 340, 345, 350, 355, 360, 365, 370, 375, 380, 385, 390, 395, 400, 405
    ];

    const FORBIDDEN_WORDS = ["sex", "porno", "porn", "amk", "aq", "pic", "oÃ§", "yarak", "sik", "got", "meme", "31", "sikiÅŸ", "yarrak", "anan"];

    /* 2. UI YÃ–NETÄ°CÄ°SÄ° */
    const ui = {
        showScreen: (screenId) => {
            document.querySelectorAll('.modal-overlay').forEach(el => el.style.display = 'none');
            if(screenId) document.getElementById(screenId).style.display = 'flex';
        },
        updateLoader: (percent) => {
            document.getElementById('loader-fill').style.width = `${percent}%`;
            document.getElementById('loader-text').innerText = `GÃ¶rseller YÃ¼kleniyor %${percent}`;
        },
        showError: (msg) => {
            const el = document.getElementById('login-error');
            el.innerText = msg; el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 2000);
        },
        updateStats: () => {
            document.getElementById('score-val').innerText = gameSystem.state.score;
            document.getElementById('moves-val').innerText = gameSystem.state.moves;
        },
        updateTimer: (str) => {
            document.getElementById('time-val').innerText = str;
        }
    };

    /* 3. GÄ°RÄ°Åž SÄ°STEMÄ° */
    const loginSystem = {
        init: () => {
            const savedName = localStorage.getItem('memory_username');
            if (savedName) {
                document.getElementById('player-name-display').innerText = savedName;
                ui.showScreen('modal-difficulty');
            } else {
                ui.showScreen('modal-login');
            }
        },
        attemptLogin: () => {
            const input = document.getElementById('username-input');
            const rawName = input.value.trim();
            const cleanName = rawName.replace(/[^a-zA-Z0-9]/g, "").toLowerCase();

            if (cleanName.length < 3) return ui.showError("Ä°sim Ã§ok kÄ±sa!");
            if (FORBIDDEN_WORDS.some(w => cleanName.includes(w))) return ui.showError("Uygunsuz isim!");

            localStorage.setItem('memory_username', rawName);
            document.getElementById('player-name-display').innerText = rawName;
            ui.showScreen('modal-difficulty');
        }
    };

    /* 4. OYUN SÄ°STEMÄ° */
    const gameSystem = {
        state: {
            difficulty: 'easy',
            score: 0,
            moves: 0,
            seconds: 0,
            timerInterval: null,
            images: {},
            lockBoard: false,
            hasFlipped: false,
            firstCard: null,
            secondCard: null,
            matches: 0,
            requiredMatches: 0
        },

        startPreload: (diff) => {
            // State SÄ±fÄ±rla
            clearInterval(gameSystem.state.timerInterval);
            gameSystem.state = {
                ...gameSystem.state,
                difficulty: diff, score: 0, moves: 0, seconds: 0, matches: 0,
                lockBoard: false, hasFlipped: false, firstCard: null, secondCard: null, images: {}
            };
            
            ui.updateStats();
            ui.updateTimer("00:00");

            // UI HazÄ±rlÄ±ÄŸÄ±
            document.getElementById('diff-buttons').style.display = 'none';
            document.getElementById('loader-container').style.display = 'block';
            
            const diffNames = {easy: "KOLAY", medium: "ORTA", hard: "ZOR"};
            document.getElementById('diff-val').innerText = diffNames[diff];

            // Resim SeÃ§imi (Havuzdan rastgele seÃ§)
            // Kolay: 8 resim (16 kart), Orta: 10 resim (20 kart), Zor: 12 resim (24 kart)
            let count = diff === 'easy' ? 8 : diff === 'medium' ? 10 : 12;
            
            // Havuzu karÄ±ÅŸtÄ±r ve ilk 'count' kadarÄ±nÄ± al
            let shuffledPool = [...MASTER_IMAGE_POOL].sort(() => 0.5 - Math.random());
            let selectedIds = shuffledPool.slice(0, count);
            
            // Promise ile YÃ¼kle (Asla takÄ±lmaz)
            let loadedCount = 0;
            const promises = selectedIds.map(id => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.src = `https://picsum.photos/id/${id}/300/300`;
                    img.onload = () => {
                        gameSystem.state.images[id] = img.src;
                        loadedCount++;
                        ui.updateLoader(Math.floor((loadedCount/count)*100));
                        resolve();
                    };
                    img.onerror = () => {
                        console.warn("Resim hatasÄ±, yedekleniyor:", id);
                        resolve(); // Hata olsa da devam et
                    };
                });
            });

            Promise.all(promises).then(() => {
                setTimeout(() => {
                    document.getElementById('diff-buttons').style.display = 'flex'; // Eski haline getir
                    document.getElementById('loader-container').style.display = 'none';
                    ui.showScreen(null); // ModalÄ± kapat
                    gameSystem.initBoard(selectedIds);
                }, 500);
            });
        },

        initBoard: (imageIds) => {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            
            let cols = 4;
            let rows = gameSystem.state.difficulty === 'easy' ? 4 : gameSystem.state.difficulty === 'medium' ? 5 : 6;
            
            board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            
            const totalCards = rows * cols;
            gameSystem.state.requiredMatches = totalCards / 2;

            // Deste OluÅŸtur
            // EÄŸer imageIds yetersizse (yÃ¼kleme hatasÄ± vb), eldeki resimleri tekrarla
            let needed = Object.keys(gameSystem.state.images);
            if (needed.length < gameSystem.state.requiredMatches) {
                 // Acil durum: Eldekileri Ã§oÄŸalt
                 while(needed.length < gameSystem.state.requiredMatches) needed = needed.concat(needed);
                 needed = needed.slice(0, gameSystem.state.requiredMatches);
            }
            
            let deck = [...needed, ...needed];
            deck.sort(() => 0.5 - Math.random());

            deck.forEach(id => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.id = id;
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front"></div>
                        <div class="card-back"><img src="${gameSystem.state.images[id] || 'https://picsum.photos/200'}" draggable="false"></div>
                    </div>
                `;
                card.addEventListener('click', gameSystem.flipCard);
                board.appendChild(card);
            });

            // GiriÅŸ Animasyonu
            const cards = document.querySelectorAll('.card');
            cards.forEach((c, i) => setTimeout(() => c.classList.add('active'), i * 30));

            // Ã–n Ä°zleme
            let previewTime = 2500;
            setTimeout(() => {
                gameSystem.state.lockBoard = true;
                cards.forEach(c => c.classList.add('flipped'));
                sfx.play('flip');
                
                setTimeout(() => {
                    cards.forEach(c => c.classList.remove('flipped'));
                    gameSystem.state.lockBoard = false;
                    sfx.play('flip');
                    gameSystem.startTimer(); // SÃ¼reyi baÅŸlat
                }, previewTime);
            }, 800);
        },

        startTimer: () => {
            gameSystem.state.timerInterval = setInterval(() => {
                gameSystem.state.seconds++;
                let m = Math.floor(gameSystem.state.seconds / 60).toString().padStart(2, '0');
                let s = (gameSystem.state.seconds % 60).toString().padStart(2, '0');
                ui.updateTimer(`${m}:${s}`);
            }, 1000);
        },

        flipCard: function() {
            const state = gameSystem.state;
            
            // --- KRÄ°TÄ°K DÃœZELTME: EÅžLEÅžMÄ°Åž KARTA TIKLANAMAZ ---
            if (this.classList.contains('matched')) return;
            // --------------------------------------------------

            if (state.lockBoard || this === state.firstCard) return;

            this.classList.add('flipped');
            sfx.play('flip');

            if (!state.hasFlipped) {
                state.hasFlipped = true;
                state.firstCard = this;
                return;
            }

            state.secondCard = this;
            state.moves++;
            ui.updateStats();
            gameSystem.checkForMatch();
        },

        checkForMatch: () => {
            const state = gameSystem.state;
            const isMatch = state.firstCard.dataset.id === state.secondCard.dataset.id;
            isMatch ? gameSystem.disableCards() : gameSystem.unflipCards();
        },

        disableCards: () => {
            const state = gameSystem.state;
            state.lockBoard = true;
            state.matches++;
            
            // Puanlama: DoÄŸru +100
            state.score += 100;
            ui.updateStats();
            
            sfx.play('match');

            setTimeout(() => {
                state.firstCard.classList.add('matched');
                state.secondCard.classList.add('matched');
                gameSystem.resetBoard();

                if (state.matches === state.requiredMatches) {
                    gameSystem.endGame();
                }
            }, 500);
        },

        unflipCards: () => {
            const state = gameSystem.state;
            state.lockBoard = true;
            
            // Puanlama: YanlÄ±ÅŸ -10 (0'Ä±n altÄ±na dÃ¼ÅŸebilir veya 0'da kalabilir)
            state.score -= 10;
            ui.updateStats();

            sfx.play('error');

            setTimeout(() => {
                state.firstCard.classList.add('shake');
                state.secondCard.classList.add('shake');
            }, 300);

            setTimeout(() => {
                state.firstCard.classList.remove('flipped', 'shake');
                state.secondCard.classList.remove('flipped', 'shake');
                gameSystem.resetBoard();
            }, 1000);
        },

        resetBoard: () => {
            const state = gameSystem.state;
            [state.hasFlipped, state.lockBoard] = [false, false];
            [state.firstCard, state.secondCard] = [null, null];
        },

        endGame: () => {
            clearInterval(gameSystem.state.timerInterval);
            sfx.play('win');
            confettiSystem.start();
            
            // Kaydet
            if(window.saveScoreToFirebase) window.saveScoreToFirebase(gameSystem.state.score, gameSystem.state.difficulty);

            // ModalÄ± HazÄ±rla
            document.getElementById('end-desc').innerHTML = `
                Toplam Puan: <strong style="color:#fff">${gameSystem.state.score}</strong><br>
                Hamle: ${gameSystem.state.moves} | SÃ¼re: ${document.getElementById('time-val').innerText}
            `;
            
            // Leaderboard'u varsayÄ±lan olarak ÅŸu anki zorlukta aÃ§
            leaderboardSystem.load(gameSystem.state.difficulty);
            
            setTimeout(() => {
                ui.showScreen('modal-end');
            }, 1500);
        }
    };

    /* 5. SES VE EFEKTLER */
    const sfx = {
        ctx: new (window.AudioContext || window.webkitAudioContext)(),
        play: (type) => {
            if (sfx.ctx.state === 'suspended') sfx.ctx.resume();
            const o = sfx.ctx.createOscillator();
            const g = sfx.ctx.createGain();
            o.connect(g); g.connect(sfx.ctx.destination);
            const t = sfx.ctx.currentTime;

            if (type === 'flip') {
                o.frequency.setValueAtTime(300, t); g.gain.linearRampToValueAtTime(0, t+0.1); o.start(t); o.stop(t+0.1);
            } else if (type === 'match') {
                o.type = 'sine'; o.frequency.setValueAtTime(600, t); g.gain.linearRampToValueAtTime(0, t+0.3); o.start(t); o.stop(t+0.3);
            } else if (type === 'error') {
                o.type = 'sawtooth'; o.frequency.setValueAtTime(150, t); g.gain.linearRampToValueAtTime(0, t+0.3); o.start(t); o.stop(t+0.3);
            } else if (type === 'win') {
                [523, 659, 784].forEach((f,i) => {
                    let o2=sfx.ctx.createOscillator(); let g2=sfx.ctx.createGain();
                    o2.connect(g2); g2.connect(sfx.ctx.destination);
                    o2.frequency.value=f; g2.gain.setValueAtTime(0.1, t+i*0.1); g2.gain.linearRampToValueAtTime(0, t+i*0.1+0.4);
                    o2.start(t+i*0.1); o2.stop(t+i*0.1+0.4);
                });
            }
        }
    };

    /* 6. LÄ°DERLÄ°K TABLOSU */
    const leaderboardSystem = {
        load: async (diff) => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            const tab = document.getElementById(`tab-${diff}`);
            if(tab) tab.classList.add('active');

            const content = document.getElementById('leaderboard-content');
            content.innerHTML = "YÃ¼kleniyor...";
            
            if(window.getLeaderboard) {
                content.innerHTML = await window.getLeaderboard(diff);
            } else {
                content.innerHTML = "<p>VeritabanÄ± hazÄ±r deÄŸil.</p>";
            }
        }
    };

    /* 7. KONFETÄ° */
    const confettiSystem = {
        canvas: document.getElementById('confetti-canvas'),
        init: () => {
            confettiSystem.ctx = confettiSystem.canvas.getContext('2d');
            confettiSystem.resize();
            window.addEventListener('resize', confettiSystem.resize);
        },
        resize: () => {
            confettiSystem.canvas.width = window.innerWidth;
            confettiSystem.canvas.height = window.innerHeight;
        },
        start: () => {
            let parts = [];
            for(let i=0; i<100; i++) parts.push({
                x: Math.random()*confettiSystem.canvas.width, y: Math.random()*confettiSystem.canvas.height-confettiSystem.canvas.height,
                c: `hsl(${Math.random()*360},100%,50%)`, v: Math.random()*5+2
            });
            function loop() {
                const ctx = confettiSystem.ctx;
                ctx.clearRect(0,0,confettiSystem.canvas.width, confettiSystem.canvas.height);
                parts.forEach((p,i) => {
                    p.y += p.v; ctx.fillStyle=p.c; ctx.fillRect(p.x, p.y, 6, 6);
                    if(p.y > confettiSystem.canvas.height) parts[i].y = -10;
                });
                if(parts.length) requestAnimationFrame(loop);
            }
            loop();
        }
    };

    // BAÅžLAT
    window.onload = () => {
        confettiSystem.init();
        loginSystem.init();
    };

    </script>
</body>
</html>
