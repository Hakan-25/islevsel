<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Memory Master Pro</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;900&display=swap');

        :root {
            --bg-dark: #020617;
            --primary: #6366f1;     /* Indigo Main */
            --primary-light: #818cf8;
            --accent: #d946ef;      /* Fuchsia Accent */
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --success: #10b981;
            --error: #f43f5e;
            --gold: #fbbf24;
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #312e81 0%, #020617 85%);
            height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-family: 'Outfit', sans-serif; color: white; overflow: hidden;
        }

        /* --- UI HEADER (OYUN ƒ∞√áƒ∞ Bƒ∞LGƒ∞ PANELI) --- */
        #ui-header {
            position: absolute; top: 15px;
            display: flex; gap: 15px;
            z-index: 10;
            background: var(--glass);
            padding: 10px 25px;
            border-radius: 50px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            max-width: 95%;
            justify-content: center;
            align-items: center;
        }

        .stat-box { display: flex; flex-direction: column; align-items: center; min-width: 60px; }
        .stat-label { font-size: 0.65rem; color: #94a3b8; font-weight: 700; letter-spacing: 1px; margin-bottom: 2px; }
        .stat-val { font-size: 1.2rem; font-weight: 900; color: white; text-shadow: 0 0 10px rgba(255,255,255,0.2); }
        #moves-val { color: var(--gold); }
        
        .close-btn {
            background: rgba(244, 63, 94, 0.1); color: var(--error);
            border: 1px solid rgba(244, 63, 94, 0.3);
            width: 35px; height: 35px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 1.2rem; margin-left: 10px;
        }

        /* --- OYUN ALANI (GRID) --- */
        .game-board {
            display: grid; gap: 10px;
            width: 95vmin; max-width: 480px; aspect-ratio: 1;
            perspective: 1000px; z-index: 5; margin-top: 20px;
            transition: opacity 0.3s;
        }

        /* --- KART TASARIMI --- */
        .card {
            position: relative; cursor: pointer;
            transform-style: preserve-3d; transform: scale(0);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); /* Bouncy Effect */
            border-radius: 12px;
        }
        .card.active { transform: scale(1); }

        .card-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
            transform-style: preserve-3d; border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .card.flipped .card-inner { transform: rotateY(180deg); }
        
        /* E≈üle≈üme Efekti */
        .card.matched .card-inner { 
            box-shadow: 0 0 20px var(--success), 0 0 5px var(--success) inset; 
            border: 2px solid var(--success); 
        }
        .card.shake { animation: shake 0.5s; }

        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; border: 1px solid var(--glass-border);
        }

        .card-front {
            background: linear-gradient(135deg, #1e1b4b 0%, #4f46e5 100%);
            color: rgba(255,255,255,0.1); font-size: 2rem; font-weight: 900;
        }
        .card-front::after { content: '?'; } /* Logo buraya gelebilir */

        .card-back { background: #fff; transform: rotateY(180deg); }
        .card-back img { width: 100%; height: 100%; object-fit: cover; }

        /* --- MODALLAR (PENCERELER) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.95); z-index: 100;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s forwards;
        }

        .modal-content {
            background: #0f172a; padding: 40px; border-radius: 30px;
            text-align: center; border: 1px solid var(--glass-border);
            box-shadow: 0 25px 60px rgba(0,0,0,0.7);
            width: 90%; max-width: 380px; position: relative;
            display: flex; flex-direction: column; gap: 15px;
        }

        h1 { 
            margin: 0; font-size: 2.2rem; line-height: 1;
            background: linear-gradient(to right, #818cf8, #d946ef); 
            -webkit-background-clip: text; color: transparent; 
        }
        p { color: #94a3b8; font-size: 0.95rem; margin: 5px 0 20px 0; }

        /* INPUT */
        input {
            width: 100%; padding: 16px;
            background: #1e293b; border: 2px solid var(--glass-border);
            border-radius: 15px; color: white; font-size: 1.1rem;
            text-align: center; font-weight: bold; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(99, 102, 241, 0.3); }

        /* BUTONLAR */
        .btn-stack { display: flex; flex-direction: column; gap: 12px; width: 100%; }
        
        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 15px;
            color: white; font-weight: 700; font-size: 1rem; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: all 0.2s;
            position: relative; overflow: hidden;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn:active { transform: scale(0.96); }
        .btn:hover { filter: brightness(1.15); }

        .btn-primary { background: linear-gradient(135deg, var(--primary), #4338ca); }
        .btn-secondary { background: #334155; border: 1px solid var(--glass-border); }
        
        /* Zorluk Renkleri */
        .btn-easy { background: linear-gradient(135deg, #10b981, #047857); }
        .btn-mid { background: linear-gradient(135deg, #f59e0b, #b45309); }
        .btn-hard { background: linear-gradient(135deg, #ef4444, #b91c1c); }

        /* Y√úKLEME √áUBUƒûU (PRELOADER) */
        #loader-container { display: none; margin-top: 10px; }
        .loader-track { 
            width: 100%; height: 8px; background: #1e293b; 
            border-radius: 10px; overflow: hidden; border: 1px solid var(--glass-border);
        }
        .loader-fill { 
            width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); 
            transition: width 0.3s ease-out; 
        }
        #loader-text { margin-top: 8px; font-size: 0.8rem; color: var(--primary-light); font-weight: bold; letter-spacing: 0.5px; }

        .error-msg { color: var(--error); font-size: 0.85rem; font-weight: bold; margin-top: 5px; display: none; }

        /* SKOR TABLOSU */
        .tabs { display: flex; gap: 5px; background: #1e293b; padding: 5px; border-radius: 15px; margin-bottom: 10px; }
        .tab { flex: 1; padding: 10px; border-radius: 10px; font-size: 0.8rem; cursor: pointer; color: #64748b; font-weight: bold; transition: 0.2s; }
        .tab.active { background: var(--primary); color: white; shadow: 0 2px 5px rgba(0,0,0,0.2); }

        .leaderboard-list {
            max-height: 240px; overflow-y: auto; text-align: left;
            background: #020617; border-radius: 15px; padding: 10px; border: 1px solid var(--glass-border);
        }
        .score-row { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 10px; border-bottom: 1px solid var(--glass-border); font-size: 0.9rem;
        }
        .score-row:last-child { border-bottom: none; }
        .rank { width: 30px; font-weight: 900; }
        .p-name { flex-grow: 1; color: #e2e8f0; font-weight: 500; }
        .p-score { font-weight: 900; color: var(--gold); }

        /* CONFETTI CANVAS */
        #confetti-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; }

        /* Animasyonlar */
        @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
        @keyframes shake { 
            0%, 100% {transform: translateX(0);} 
            25% {transform: translateX(-6px) rotate(-6deg);} 
            75% {transform: translateX(6px) rotate(6deg);} 
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div id="ui-header" style="display:none;">
        <div class="stat-box">
            <span class="stat-label">S√úRE</span>
            <span class="stat-val" id="time-val">00:00</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">HAMLE</span>
            <span class="stat-val" id="moves-val">0</span>
        </div>
        <div class="close-btn" onclick="app.showScreen('modal-menu')">‚úï</div>
    </div>

    <div class="game-board" id="game-board"></div>

    <div id="modal-login" class="modal-overlay">
        <div class="modal-content">
            <h1>Kƒ∞MLƒ∞K</h1>
            <p>Skor tablosunda g√∂r√ºnecek isim:</p>
            <input type="text" id="username-input" placeholder="Takma Adƒ±nƒ±z" maxlength="12" autocomplete="off">
            <button class="btn btn-primary" onclick="app.login()">KAYDET VE DEVAM ET</button>
            <div class="error-msg" id="login-error"></div>
        </div>
    </div>

    <div id="modal-menu" class="modal-overlay">
        <div class="modal-content">
            <h1>G√ñREV SE√á</h1>
            <p>Ho≈ügeldin <span id="player-name" style="color:var(--primary-light); font-weight:bold;"></span>.</p>
            
            <div class="btn-stack" id="menu-stack">
                <button class="btn btn-easy" onclick="game.preload('easy')">üü¢ KOLAY (16 Kart)</button>
                <button class="btn btn-mid" onclick="game.preload('medium')">üü† ORTA (20 Kart)</button>
                <button class="btn btn-hard" onclick="game.preload('hard')">üî¥ ZOR (24 Kart)</button>
                <button class="btn btn-secondary" onclick="app.openLeaderboard()">üèÜ SIRALAMA</button>
            </div>

            <div id="loader-container">
                <div class="loader-track"><div class="loader-fill" id="loader-fill"></div></div>
                <div id="loader-text">G√∂rseller Y√ºkleniyor %0</div>
            </div>
        </div>
    </div>

    <div id="modal-leaderboard" class="modal-overlay">
        <div class="modal-content">
            <h1>Lƒ∞DERLER</h1>
            <p>En az hamle yapan kazanƒ±r!</p>
            
            <div class="tabs">
                <div class="tab" id="tab-easy" onclick="leaderboard.load('easy')">Kolay</div>
                <div class="tab" id="tab-medium" onclick="leaderboard.load('medium')">Orta</div>
                <div class="tab" id="tab-hard" onclick="leaderboard.load('hard')">Zor</div>
            </div>

            <div class="leaderboard-list" id="lb-content">Y√ºkleniyor...</div>

            <button class="btn btn-secondary" onclick="app.showScreen('modal-menu')">GERƒ∞ D√ñN</button>
        </div>
    </div>

    <div id="modal-end" class="modal-overlay">
        <div class="modal-content">
            <h1>HARƒ∞KA!</h1>
            <p id="end-stats">...</p>
            
            <div class="btn-stack">
                <button class="btn btn-primary" onclick="location.reload()">TEKRAR OYNA</button>
                <button class="btn btn-secondary" onclick="app.openLeaderboard()">SIRALAMAYA BAK</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, getDocs, updateDoc, doc, orderBy, limit } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBW8xNsDjp3duXyuPukuBKNlOYw-uv6W1c",
            authDomain: "hakantools-a44c0.firebaseapp.com",
            projectId: "hakantools-a44c0",
            storageBucket: "hakantools-a44c0.firebasestorage.app",
            messagingSenderId: "216753237718",
            appId: "1:216753237718:web:ea012c7dc4fdb7e7d72377",
            measurementId: "G-4GWK9BS40T"
        };

        let db;
        try { const x = initializeApp(firebaseConfig); db = getFirestore(x); } catch(e){}

        // SKOR KAYDET (Daha az hamle daha iyidir mantƒ±ƒüƒ±)
        window.saveScore = async function(moves, timeStr, difficulty) {
            if(!db || !localStorage.getItem('mem_user')) return;
            const name = localStorage.getItem('mem_user');
            const col = `mem_ranks_${difficulty}`;

            try {
                const q = query(collection(db, col), where("name", "==", name));
                const snap = await getDocs(q);

                if (!snap.empty) {
                    const docRef = snap.docs[0];
                    const oldMoves = docRef.data().moves;
                    // Eƒüer yeni hamle sayƒ±sƒ± daha d√º≈ü√ºkse g√ºncelle
                    if (moves < oldMoves) {
                        await updateDoc(doc(db, col, docRef.id), { moves: moves, time: timeStr, date: new Date() });
                    }
                } else {
                    await addDoc(collection(db, col), { name: name, moves: moves, time: timeStr, date: new Date() });
                }
            } catch (e) { console.error(e); }
        };

        // SIRALAMA √áEK (Ascending: Azdan √ßoƒüa)
        window.getScores = async function(diff) {
            if(!db) return "<p style='color:#64748b; padding:10px;'>Baƒülantƒ± yok.</p>";
            try {
                const q = query(collection(db, `mem_ranks_${diff}`), orderBy("moves", "asc"), limit(20));
                const snap = await getDocs(q);
                let html = "";
                let i = 1;
                snap.forEach(d => {
                    const val = d.data();
                    let medal = i===1 ? 'ü•á' : i===2 ? 'ü•à' : i===3 ? 'ü•â' : `#${i}`;
                    let color = i===1 ? '#fbbf24' : i===2 ? '#94a3b8' : i===3 ? '#b45309' : '#64748b';
                    
                    html += `
                        <div class="score-row">
                            <span class="rank" style="color:${color}">${medal}</span>
                            <span class="p-name">${val.name}</span>
                            <span class="p-score">${val.moves} Hamle</span>
                        </div>`;
                    i++;
                });
                return html || "<p style='color:#64748b; padding:10px;'>Hen√ºz kayƒ±t yok.</p>";
            } catch(e) { return "<p>Veri alƒ±namadƒ±.</p>"; }
        };
    </script>

    <script>
    /* 1. G√ñRSEL HAVUZU (100+ Kaliteli Resim) */
    const IMAGES = [10,11,12,13,14,15,16,17,18,19,20,25,28,29,33,40,48,54,58,60,76,89,96,102,103,110,116,117,119,122,128,137,146,152,164,175,190,192,195,200,201,237,250,260,275,280,299,301,310,320,330,340,350];
    const BAD_WORDS = ["sex", "porno", "amk", "aq", "o√ß", "pi√ß", "sik", "meme", "31", "yarrak", "anan"];

    /* 2. UYGULAMA Y√ñNETƒ∞Cƒ∞Sƒ∞ */
    const app = {
        user: "",
        init: () => {
            app.user = localStorage.getItem('mem_user');
            if(app.user) {
                document.getElementById('player-name').innerText = app.user;
                app.showScreen('modal-menu');
            } else {
                app.showScreen('modal-login');
            }
        },
        showScreen: (id) => {
            // Oyun alanƒ±nƒ± temizle/gizle
            if(id !== null) document.getElementById('ui-header').style.display = 'none';
            document.querySelectorAll('.modal-overlay').forEach(e => e.style.display = 'none');
            if(id) document.getElementById(id).style.display = 'flex';
        },
        login: () => {
            let val = document.getElementById('username-input').value.trim();
            let check = val.replace(/[^a-zA-Z0-9]/g, "").toLowerCase();
            
            if(check.length < 3) return app.error("ƒ∞sim √ßok kƒ±sa!");
            if(BAD_WORDS.some(w => check.includes(w))) return app.error("Uygunsuz isim!");

            localStorage.setItem('mem_user', val);
            app.user = val;
            document.getElementById('player-name').innerText = val;
            app.showScreen('modal-menu');
        },
        error: (msg) => {
            let el = document.getElementById('login-error');
            el.innerText = msg; el.style.display='block';
            setTimeout(() => el.style.display='none', 2000);
        },
        openLeaderboard: () => {
            app.showScreen('modal-leaderboard');
            leaderboard.load('easy');
        }
    };

    /* 3. OYUN MOTORU */
    const game = {
        diff: 'easy',
        images: {},
        flipped: [],
        matches: 0,
        moves: 0,
        target: 0,
        timer: 0,
        timerRef: null,
        locked: false,

        preload: (difficulty) => {
            game.diff = difficulty;
            document.getElementById('menu-stack').style.display = 'none';
            document.getElementById('loader-container').style.display = 'block';

            let count = difficulty === 'easy' ? 8 : difficulty === 'medium' ? 10 : 12; 
            let pool = [...IMAGES].sort(() => 0.5 - Math.random()).slice(0, count);
            
            let loaded = 0;
            // Promise yapƒ±sƒ± ile %100 y√ºkleme garantisi
            let promises = pool.map(id => new Promise(resolve => {
                let img = new Image();
                img.src = `https://picsum.photos/id/${id}/300/300`;
                img.onload = () => { loaded++; updateLoad(loaded, count); game.images[id]=img.src; resolve(); };
                img.onerror = () => { loaded++; updateLoad(loaded, count); resolve(); };
            }));

            function updateLoad(c, t) { 
                let pct = Math.floor((c/t)*100);
                document.getElementById('loader-fill').style.width = `${pct}%`;
                document.getElementById('loader-text').innerText = `G√∂rseller Y√ºkleniyor %${pct}`;
            }

            Promise.all(promises).then(() => {
                setTimeout(() => {
                    document.getElementById('menu-stack').style.display = 'flex'; // Reset
                    document.getElementById('loader-container').style.display = 'none';
                    app.showScreen(null); // Men√ºy√º kapat
                    game.start(pool);
                }, 500);
            });
        },

        start: (ids) => {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            document.getElementById('ui-header').style.display = 'flex';
            
            let cols = 4;
            let rows = game.diff === 'easy' ? 4 : game.diff === 'medium' ? 5 : 6;
            board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            game.moves = 0; game.matches = 0; game.timer = 0; game.flipped = []; game.locked = false;
            game.target = (rows * cols) / 2;
            
            document.getElementById('moves-val').innerText = "0";
            document.getElementById('time-val').innerText = "00:00";

            let deck = [...ids, ...ids].sort(() => 0.5 - Math.random());
            deck.forEach(id => {
                let c = document.createElement('div');
                c.className = 'card';
                c.dataset.id = id;
                c.onclick = () => game.click(c);
                c.innerHTML = `<div class="card-inner"><div class="card-front"></div><div class="card-back"><img src="${game.images[id]}"></div></div>`;
                board.appendChild(c);
                setTimeout(() => c.classList.add('active'), Math.random()*400); // Giri≈ü Animasyonu
            });

            clearInterval(game.timerRef);
            game.timerRef = setInterval(() => {
                game.timer++;
                let m = Math.floor(game.timer/60).toString().padStart(2,'0');
                let s = (game.timer%60).toString().padStart(2,'0');
                document.getElementById('time-val').innerText = `${m}:${s}`;
            }, 1000);
        },

        click: (card) => {
            // Kilitliyse, zaten a√ßƒ±ksa veya e≈üle≈ümi≈üse tƒ±klama
            if(game.locked || card.classList.contains('flipped') || card.classList.contains('matched')) return;

            card.classList.add('flipped');
            game.flipped.push(card);
            sfx.play('flip');

            if(game.flipped.length === 2) {
                game.moves++;
                document.getElementById('moves-val').innerText = game.moves;
                game.check();
            }
        },

        check: () => {
            game.locked = true;
            let [c1, c2] = game.flipped;
            let match = c1.dataset.id === c2.dataset.id;

            if(match) {
                sfx.play('match');
                c1.classList.add('matched');
                c2.classList.add('matched');
                game.matches++;
                game.flipped = [];
                game.locked = false;
                if(game.matches === game.target) game.over();
            } else {
                sfx.play('error');
                setTimeout(() => { c1.classList.add('shake'); c2.classList.add('shake'); }, 300);
                setTimeout(() => {
                    c1.classList.remove('flipped', 'shake');
                    c2.classList.remove('flipped', 'shake');
                    game.flipped = [];
                    game.locked = false;
                }, 1000);
            }
        },

        over: () => {
            clearInterval(game.timerRef);
            sfx.play('win');
            confetti.start();
            
            let timeStr = document.getElementById('time-val').innerText;
            if(window.saveScore) window.saveScore(game.moves, timeStr, game.diff);

            setTimeout(() => {
                document.getElementById('end-stats').innerHTML = 
                    `<span style="color:#fbbf24; font-size:1.8rem; font-weight:900;">${game.moves} HAMLE</span><br>S√ºre: ${timeStr}`;
                app.showScreen('modal-end');
                document.getElementById('ui-header').style.display = 'none';
            }, 1000);
        }
    };

    /* 4. SIRALAMA UI */
    const leaderboard = {
        load: async (diff) => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${diff}`).classList.add('active');
            
            document.getElementById('lb-content').innerHTML = "<div style='padding:20px; color:#94a3b8; text-align:center;'>Y√ºkleniyor...</div>";
            if(window.getScores) {
                document.getElementById('lb-content').innerHTML = await window.getScores(diff);
            }
        }
    };

    /* 5. SES & KONFETƒ∞ (3 SANƒ∞YE SINIRLI) */
    const sfx = {
        ctx: new (window.AudioContext||window.webkitAudioContext)(),
        play: (type) => {
            if(sfx.ctx.state==='suspended') sfx.ctx.resume();
            let o=sfx.ctx.createOscillator(), g=sfx.ctx.createGain(), t=sfx.ctx.currentTime;
            o.connect(g); g.connect(sfx.ctx.destination);
            
            if(type==='flip'){ o.frequency.value=300; g.gain.linearRampToValueAtTime(0,t+0.1); o.start(t); o.stop(t+0.1); }
            if(type==='match'){ o.type='sine'; o.frequency.setValueAtTime(500,t); o.frequency.linearRampToValueAtTime(1000,t+0.2); g.gain.linearRampToValueAtTime(0,t+0.3); o.start(t); o.stop(t+0.3); }
            if(type==='error'){ o.type='sawtooth'; o.frequency.value=150; g.gain.linearRampToValueAtTime(0,t+0.2); o.start(t); o.stop(t+0.2); }
            if(type==='win'){ 
                [523,659,784].forEach((f,i)=>{ 
                    let o2=sfx.ctx.createOscillator(), g2=sfx.ctx.createGain(); 
                    o2.connect(g2); g2.connect(sfx.ctx.destination); 
                    o2.frequency.value=f; g2.gain.setValueAtTime(0.1,t+i*0.1); g2.gain.linearRampToValueAtTime(0,t+i*0.1+0.4); 
                    o2.start(t+i*0.1); o2.stop(t+i*0.1+0.4); 
                }); 
            }
        }
    };

    const confetti = {
        el: document.getElementById('confetti-canvas'),
        ctx: null, parts: [], running: false,
        init: () => {
            confetti.ctx = confetti.el.getContext('2d');
            confetti.resize(); window.onresize = confetti.resize;
        },
        resize: () => { confetti.el.width=window.innerWidth; confetti.el.height=window.innerHeight; },
        start: () => {
            if(confetti.running) return;
            confetti.running = true; confetti.parts = [];
            for(let i=0; i<100; i++) confetti.parts.push({x:Math.random()*confetti.el.width, y:-10, c:`hsl(${Math.random()*360},100%,50%)`, v:Math.random()*5+2});
            confetti.loop();
            // √ñNEMLƒ∞: 3 Saniye sonra durdur ve temizle
            setTimeout(() => { 
                confetti.running = false; 
                confetti.ctx.clearRect(0,0,confetti.el.width, confetti.el.height); 
            }, 3000);
        },
        loop: () => {
            if(!confetti.running) return;
            confetti.ctx.clearRect(0,0,confetti.el.width,confetti.el.height);
            confetti.parts.forEach(p => {
                p.y += p.v; confetti.ctx.fillStyle=p.c; confetti.ctx.fillRect(p.x,p.y,8,8);
                if(p.y > confetti.el.height) p.y = -10;
            });
            requestAnimationFrame(confetti.loop);
        }
    };

    window.onload = () => { app.init(); confetti.init(); };
    </script>
</body>
</html>
