<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Memory Saga Pro</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;900&display=swap');

        :root {
            --bg-dark: #0f172a;
            --accent: #8b5cf6;     /* Violet */
            --accent-glow: #a78bfa;
            --glass: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.15);
            --success: #10b981;
            --error: #f43f5e;
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #2e1065 0%, #0f172a 80%);
            height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-family: 'Outfit', sans-serif; color: white; overflow: hidden;
        }

        /* --- UI HEADER (SKOR TABLOSU) --- */
        #ui-header {
            position: absolute; top: 20px;
            display: flex; gap: 20px;
            z-index: 10;
            background: var(--glass);
            padding: 10px 25px;
            border-radius: 50px;
            border: 1px solid var(--border);
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        .stat-box { display: flex; flex-direction: column; align-items: center; line-height: 1.1; min-width: 60px; }
        .stat-label { font-size: 0.65rem; color: #cbd5e1; letter-spacing: 1px; font-weight: 700; text-transform: uppercase; }
        .stat-val { font-size: 1.3rem; font-weight: 900; color: var(--accent-glow); text-shadow: 0 0 10px rgba(139, 92, 246, 0.5); }

        /* --- OYUN ALANI --- */
        .game-board {
            display: grid; gap: 10px;
            width: 95vmin; max-width: 600px; aspect-ratio: 1;
            perspective: 1000px; z-index: 5; margin-top: 30px;
        }

        /* --- KART STİLLERİ --- */
        .card {
            position: relative; cursor: pointer;
            transform-style: preserve-3d; transform: scale(0);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .card.active { transform: scale(1); }

        .card-inner {
            position: relative; width: 100%; height: 100%;
            text-align: center; transition: transform 0.6s;
            transform-style: preserve-3d; border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .card.flipped .card-inner { transform: rotateY(180deg); }
        .card.matched .card-inner { box-shadow: 0 0 20px var(--success); border: 2px solid var(--success); }
        .card.shake { animation: shake 0.4s; }

        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; border: 1px solid var(--border);
        }

        .card-front {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            color: rgba(255,255,255,0.1); font-size: 1.5rem; font-weight: 900;
        }
        .card-front::after { content: '?'; }

        .card-back { background: #fff; transform: rotateY(180deg); }
        .card-back img { width: 100%; height: 100%; object-fit: cover; }

        /* --- PENCERELER (MODALS) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.98); /* Arka planı tamamen kapatır */
            z-index: 100;
            display: none; /* JS ile kontrol edilir */
            justify-content: center; align-items: center;
        }
        
        .modal-content {
            background: #1e293b; padding: 35px; border-radius: 24px;
            text-align: center; border: 1px solid var(--border);
            box-shadow: 0 25px 50px rgba(0,0,0,0.6);
            width: 90%; max-width: 400px; position: relative;
        }
        
        h1 { margin: 0 0 10px; font-size: 2.2rem; background: linear-gradient(to right, #a78bfa, #38bdf8); -webkit-background-clip: text; color: transparent; }
        p { color: #94a3b8; margin-bottom: 25px; line-height: 1.4; font-size: 0.95rem; }

        input {
            width: 100%; padding: 14px; margin-bottom: 15px;
            background: #0f172a; border: 2px solid var(--border);
            border-radius: 12px; color: white; font-size: 1.1rem;
            text-align: center; font-weight: bold; outline: none;
        }
        input:focus { border-color: var(--accent); }

        .btn {
            width: 100%; padding: 14px; border: none; border-radius: 12px;
            color: white; font-weight: 800; font-size: 1rem; cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3); margin-top: 10px;
            transition: 0.2s; text-transform: uppercase; letter-spacing: 1px;
        }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn:disabled { opacity: 0.5; cursor: wait; }

        .btn-start { background: linear-gradient(135deg, var(--accent), #3b82f6); }
        .btn-easy { background: linear-gradient(135deg, #10b981, #059669); }
        .btn-mid { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .btn-hard { background: linear-gradient(135deg, #ef4444, #b91c1c); }

        /* YÜKLEME ÇUBUĞU */
        #loader-container { display: none; margin-top: 20px; }
        .loader-track { width: 100%; height: 6px; background: #334155; border-radius: 10px; overflow: hidden; }
        .loader-fill { width: 0%; height: 100%; background: var(--success); transition: width 0.3s; }
        #loader-text { margin-top: 8px; font-size: 0.8rem; color: var(--success); font-weight: bold; }

        .error-msg { color: var(--error); font-size: 0.85rem; margin-top: 10px; display: none; font-weight: bold; }

        /* TABLOLAR */
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; justify-content: center; }
        .tab { padding: 8px 15px; border-radius: 20px; background: rgba(255,255,255,0.05); font-size: 0.8rem; cursor: pointer; border: 1px solid transparent; }
        .tab.active { background: var(--accent); border-color: var(--accent-glow); }
        .leaderboard-list { max-height: 200px; overflow-y: auto; text-align: left; font-size: 0.9rem; }
        .score-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }

        #confetti-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            75% { transform: translateX(5px) rotate(5deg); }
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div id="ui-header">
        <div class="stat-box">
            <span class="stat-label">TUR</span>
            <span class="stat-val" id="round-display">1</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">PUAN</span>
            <span class="stat-val" id="score-display">0</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">ZORLUK</span>
            <span class="stat-val" id="diff-display" style="font-size:1rem; margin-top:5px;">-</span>
        </div>
    </div>

    <div class="game-board" id="game-board"></div>

    <div id="modal-login" class="modal-overlay">
        <div class="modal-content">
            <h1>KİMLİK</h1>
            <p>Efsane olmak için takma adını gir.<br>(Kalıcıdır, değişmez)</p>
            <input type="text" id="username-input" placeholder="İsim Giriniz" maxlength="12" autocomplete="off">
            <button class="btn btn-start" onclick="loginSystem.attemptLogin()">KAYDET VE DEVAM ET</button>
            <div class="error-msg" id="login-error"></div>
        </div>
    </div>

    <div id="modal-difficulty" class="modal-overlay">
        <div class="modal-content">
            <h1>GÖREV SEÇ</h1>
            <p>Hoşgeldin <span id="player-name-display" style="color:var(--accent-glow); font-weight:bold;"></span>.<br>Hangi zorlukta yarışmak istersin?</p>
            
            <div id="diff-buttons">
                <button class="btn btn-easy" onclick="gameSystem.startPreload('easy')">KOLAY (Benzersiz)</button>
                <button class="btn btn-mid" onclick="gameSystem.startPreload('medium')">ORTA (Benzer Temalar)</button>
                <button class="btn btn-hard" onclick="gameSystem.startPreload('hard')">ZOR (Aşırı Benzer)</button>
            </div>

            <div id="loader-container">
                <div class="loader-track"><div class="loader-fill" id="loader-fill"></div></div>
                <div id="loader-text">Hazırlanıyor %0</div>
            </div>
        </div>
    </div>

    <div id="modal-end" class="modal-overlay">
        <div class="modal-content">
            <h1 id="end-title">SONUÇ</h1>
            <p id="end-desc">...</p>
            
            <div class="tabs">
                <div class="tab" id="tab-easy" onclick="leaderboardSystem.load('easy')">Kolay</div>
                <div class="tab" id="tab-medium" onclick="leaderboardSystem.load('medium')">Orta</div>
                <div class="tab" id="tab-hard" onclick="leaderboardSystem.load('hard')">Zor</div>
            </div>
            <div class="leaderboard-list" id="leaderboard-content">Yükleniyor...</div>

            <button class="btn btn-start" onclick="location.reload()" style="margin-top:20px;">YENİDEN BAŞLA</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, getDocs, updateDoc, doc, orderBy, limit } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBW8xNsDjp3duXyuPukuBKNlOYw-uv6W1c",
            authDomain: "hakantools-a44c0.firebaseapp.com",
            projectId: "hakantools-a44c0",
            storageBucket: "hakantools-a44c0.firebasestorage.app",
            messagingSenderId: "216753237718",
            appId: "1:216753237718:web:ea012c7dc4fdb7e7d72377",
            measurementId: "G-4GWK9BS40T"
        };

        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
        } catch (e) {
            console.error("Firebase Bağlantı Hatası:", e);
        }

        // Skor Kaydetme Fonksiyonu
        window.saveScoreToFirebase = async function(score, difficulty) {
            if(!db || !localStorage.getItem('memory_username')) return;
            const name = localStorage.getItem('memory_username');
            const colName = `memory_scores_${difficulty}`;

            try {
                const q = query(collection(db, colName), where("name", "==", name));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    const docRef = querySnapshot.docs[0];
                    if (score > docRef.data().score) {
                        await updateDoc(doc(db, colName, docRef.id), { score: score, date: new Date() });
                    }
                } else {
                    await addDoc(collection(db, colName), { name: name, score: score, date: new Date() });
                }
            } catch (e) { console.error("Kayıt Hatası:", e); }
        };

        // Liderlik Tablosu Çekme
        window.getLeaderboard = async function(difficulty) {
            if(!db) return "<p>Bağlantı yok.</p>";
            const colName = `memory_scores_${difficulty}`;
            try {
                const q = query(collection(db, colName), orderBy("score", "desc"), limit(10));
                const querySnapshot = await getDocs(q);
                let html = "";
                let rank = 1;
                querySnapshot.forEach((doc) => {
                    const d = doc.data();
                    let color = rank === 1 ? '#ffd700' : rank === 2 ? '#c0c0c0' : rank === 3 ? '#cd7f32' : 'white';
                    html += `<div class="score-row"><span style="color:${color}; font-weight:bold;">#${rank}</span><span style="color:white;">${d.name}</span><span style="color:var(--accent-glow);">${d.score}</span></div>`;
                    rank++;
                });
                return html || "<p>Kayıt yok.</p>";
            } catch (e) { return "<p>Veri alınamadı.</p>"; }
        };
    </script>

    <script>
    /* ----------------------------------------------------------------
       1. AYARLAR VE VERİLER
    ---------------------------------------------------------------- */
    const CONFIG = {
        imgEasy: [10, 12, 28, 54, 76, 103, 137, 152, 164, 180, 200, 237],
        imgMid:  [11, 15, 18, 19, 29, 40, 48, 60, 70, 77, 89, 92],
        imgHard: [1, 17, 25, 33, 44, 50, 66, 71, 88, 96, 102, 106],
        forbidden: ["sex", "porno", "porn", "amk", "aq", "pic", "oç", "yarak", "sik", "got", "meme", "31", "sikiş", "yarrak", "anan", "kaşar"]
    };

    /* ----------------------------------------------------------------
       2. SİSTEM YÖNETİCİSİ (UI CONTROLLER)
    ---------------------------------------------------------------- */
    const ui = {
        showScreen: (screenId) => {
            // Tüm modalları kapat
            document.querySelectorAll('.modal-overlay').forEach(el => el.style.display = 'none');
            // İstenen ekranı aç (eğer varsa)
            if(screenId) document.getElementById(screenId).style.display = 'flex';
        },
        updateLoader: (percent) => {
            document.getElementById('loader-fill').style.width = `${percent}%`;
            document.getElementById('loader-text').innerText = `Hazırlanıyor %${percent}`;
        },
        showError: (msg) => {
            const el = document.getElementById('login-error');
            el.innerText = msg; el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 2000);
        }
    };

    /* ----------------------------------------------------------------
       3. GİRİŞ SİSTEMİ
    ---------------------------------------------------------------- */
    const loginSystem = {
        init: () => {
            const savedName = localStorage.getItem('memory_username');
            if (savedName) {
                document.getElementById('player-name-display').innerText = savedName;
                ui.showScreen('modal-difficulty');
            } else {
                ui.showScreen('modal-login');
            }
        },
        attemptLogin: () => {
            const input = document.getElementById('username-input');
            const rawName = input.value.trim();
            const cleanName = rawName.replace(/[^a-zA-Z0-9]/g, "").toLowerCase();

            if (cleanName.length < 3) return ui.showError("İsim çok kısa!");
            if (CONFIG.forbidden.some(w => cleanName.includes(w))) return ui.showError("Uygunsuz isim!");

            localStorage.setItem('memory_username', rawName);
            document.getElementById('player-name-display').innerText = rawName;
            ui.showScreen('modal-difficulty');
        }
    };

    /* ----------------------------------------------------------------
       4. OYUN SİSTEMİ
    ---------------------------------------------------------------- */
    const gameSystem = {
        state: {
            difficulty: 'easy',
            round: 1,
            score: 0,
            images: {},
            lockBoard: false,
            hasFlipped: false,
            firstCard: null,
            secondCard: null,
            matches: 0,
            requiredMatches: 0
        },

        startPreload: (diff) => {
            gameSystem.state.difficulty = diff;
            
            // Butonları gizle, loader'ı göster
            document.getElementById('diff-buttons').style.display = 'none';
            document.getElementById('loader-container').style.display = 'block';
            
            // UI Güncelle
            const diffNames = {easy: "KOLAY", medium: "ORTA", hard: "ZOR"};
            const diffColors = {easy: "#10b981", medium: "#f59e0b", hard: "#ef4444"};
            const disp = document.getElementById('diff-display');
            disp.innerText = diffNames[diff];
            disp.style.color = diffColors[diff];

            // Resim Kaynaklarını Belirle
            let ids = diff === 'easy' ? CONFIG.imgEasy : diff === 'medium' ? CONFIG.imgMid : CONFIG.imgHard;
            
            // PROMISE YAPISI: Asla takılmaz
            let loadedCount = 0;
            const total = ids.length;
            const promises = ids.map(id => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.src = `https://picsum.photos/id/${id}/300/300`;
                    img.onload = () => {
                        gameSystem.state.images[id] = img.src;
                        loadedCount++;
                        ui.updateLoader(Math.floor((loadedCount/total)*100));
                        resolve();
                    };
                    img.onerror = () => {
                        // Hata olsa bile devam et (resolve)
                        console.warn("Resim yüklenemedi:", id);
                        loadedCount++;
                        ui.updateLoader(Math.floor((loadedCount/total)*100));
                        resolve();
                    };
                });
            });

            // Hepsi bitince oyunu başlat
            Promise.all(promises).then(() => {
                setTimeout(() => {
                    ui.showScreen(null); // Modalı kapat
                    gameSystem.initBoard();
                }, 500);
            });
        },

        initBoard: () => {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            
            // Zorluk seviyesine göre Grid (Hepsi çift sayı üretir)
            let cols = 4;
            let rows = gameSystem.state.difficulty === 'easy' ? 4 : gameSystem.state.difficulty === 'medium' ? 5 : 6;
            
            board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            
            const totalCards = rows * cols;
            gameSystem.state.requiredMatches = totalCards / 2;
            gameSystem.state.matches = 0;

            // Kartları Hazırla
            let keys = Object.keys(gameSystem.state.images);
            // Yetmezse başa dönüp doldur
            let neededKeys = keys.slice(0, gameSystem.state.requiredMatches);
            while(neededKeys.length < gameSystem.state.requiredMatches) {
                neededKeys = neededKeys.concat(keys.slice(0, gameSystem.state.requiredMatches - neededKeys.length));
            }
            
            let deck = [...neededKeys, ...neededKeys];
            deck.sort(() => 0.5 - Math.random());

            // DOM Oluştur
            deck.forEach(id => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.id = id;
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front"></div>
                        <div class="card-back"><img src="${gameSystem.state.images[id]}" draggable="false"></div>
                    </div>
                `;
                card.addEventListener('click', gameSystem.flipCard);
                board.appendChild(card);
            });

            // Giriş Animasyonu
            const cards = document.querySelectorAll('.card');
            cards.forEach((c, i) => setTimeout(() => c.classList.add('active'), i * 30));

            // Ön İzleme
            let previewTime = Math.max(1000, 3000 - (gameSystem.state.round * 300));
            setTimeout(() => {
                gameSystem.state.lockBoard = true;
                cards.forEach(c => c.classList.add('flipped'));
                sfx.play('flip');
                
                setTimeout(() => {
                    cards.forEach(c => c.classList.remove('flipped'));
                    gameSystem.state.lockBoard = false;
                    sfx.play('flip');
                }, previewTime);
            }, 1000);
        },

        flipCard: function() {
            const state = gameSystem.state;
            if (state.lockBoard || this === state.firstCard) return;

            this.classList.add('flipped');
            sfx.play('flip');

            if (!state.hasFlipped) {
                state.hasFlipped = true;
                state.firstCard = this;
                return;
            }

            state.secondCard = this;
            gameSystem.checkForMatch();
        },

        checkForMatch: () => {
            const state = gameSystem.state;
            const isMatch = state.firstCard.dataset.id === state.secondCard.dataset.id;
            isMatch ? gameSystem.disableCards() : gameSystem.unflipCards();
        },

        disableCards: () => {
            const state = gameSystem.state;
            state.lockBoard = true;
            state.matches++;
            
            // Puan Hesapla
            let base = 100;
            let multi = state.difficulty === 'easy' ? 1 : state.difficulty === 'medium' ? 1.5 : 2;
            state.score += Math.floor(base * multi * state.round);
            document.getElementById('score-display').innerText = state.score;
            
            sfx.play('match');

            setTimeout(() => {
                state.firstCard.classList.add('matched');
                state.secondCard.classList.add('matched');
                gameSystem.resetBoard();

                if (state.matches === state.requiredMatches) {
                    setTimeout(gameSystem.nextRound, 1000);
                }
            }, 500);
        },

        unflipCards: () => {
            const state = gameSystem.state;
            state.lockBoard = true;
            sfx.play('error');

            setTimeout(() => {
                state.firstCard.classList.add('shake');
                state.secondCard.classList.add('shake');
            }, 300);

            setTimeout(() => {
                state.firstCard.classList.remove('flipped', 'shake');
                state.secondCard.classList.remove('flipped', 'shake');
                gameSystem.resetBoard();
            }, 1000);
        },

        resetBoard: () => {
            const state = gameSystem.state;
            [state.hasFlipped, state.lockBoard] = [false, false];
            [state.firstCard, state.secondCard] = [null, null];
        },

        nextRound: () => {
            const state = gameSystem.state;
            sfx.play('win');
            confettiSystem.start();
            
            // Kaydet
            if(window.saveScoreToFirebase) window.saveScoreToFirebase(state.score, state.difficulty);

            state.round++;
            document.getElementById('round-display').innerText = state.round;

            setTimeout(() => {
                alert(`TEBRİKLER! ${state.round}. Tur Başlıyor...`);
                gameSystem.initBoard();
            }, 1500);
        }
    };

    /* ----------------------------------------------------------------
       5. SES VE EFEKTLER
    ---------------------------------------------------------------- */
    const sfx = {
        ctx: new (window.AudioContext || window.webkitAudioContext)(),
        play: (type) => {
            if (sfx.ctx.state === 'suspended') sfx.ctx.resume();
            const o = sfx.ctx.createOscillator();
            const g = sfx.ctx.createGain();
            o.connect(g); g.connect(sfx.ctx.destination);
            const t = sfx.ctx.currentTime;

            if (type === 'flip') {
                o.frequency.setValueAtTime(300, t); g.gain.linearRampToValueAtTime(0, t+0.1); o.start(t); o.stop(t+0.1);
            } else if (type === 'match') {
                o.type = 'sine'; o.frequency.setValueAtTime(600, t); g.gain.linearRampToValueAtTime(0, t+0.3); o.start(t); o.stop(t+0.3);
            } else if (type === 'error') {
                o.type = 'sawtooth'; o.frequency.setValueAtTime(150, t); g.gain.linearRampToValueAtTime(0, t+0.3); o.start(t); o.stop(t+0.3);
            } else if (type === 'win') {
                [523, 659, 784].forEach((f,i) => {
                    let o2=sfx.ctx.createOscillator(); let g2=sfx.ctx.createGain();
                    o2.connect(g2); g2.connect(sfx.ctx.destination);
                    o2.frequency.value=f; g2.gain.setValueAtTime(0.1, t+i*0.1); g2.gain.linearRampToValueAtTime(0, t+i*0.1+0.4);
                    o2.start(t+i*0.1); o2.stop(t+i*0.1+0.4);
                });
            }
        }
    };

    /* ----------------------------------------------------------------
       6. KONFETİ EFEKTİ
    ---------------------------------------------------------------- */
    const confettiSystem = {
        canvas: document.getElementById('confetti-canvas'),
        init: () => {
            confettiSystem.ctx = confettiSystem.canvas.getContext('2d');
            confettiSystem.resize();
            window.addEventListener('resize', confettiSystem.resize);
        },
        resize: () => {
            confettiSystem.canvas.width = window.innerWidth;
            confettiSystem.canvas.height = window.innerHeight;
        },
        start: () => {
            let parts = [];
            for(let i=0; i<100; i++) parts.push({
                x: Math.random()*confettiSystem.canvas.width, y: Math.random()*confettiSystem.canvas.height-confettiSystem.canvas.height,
                c: `hsl(${Math.random()*360},100%,50%)`, v: Math.random()*5+2
            });
            
            function loop() {
                const ctx = confettiSystem.ctx;
                ctx.clearRect(0,0,confettiSystem.canvas.width, confettiSystem.canvas.height);
                parts.forEach((p,i) => {
                    p.y += p.v; ctx.fillStyle=p.c; ctx.fillRect(p.x, p.y, 8, 8);
                    if(p.y > confettiSystem.canvas.height) parts[i].y = -10;
                });
                if(parts.length) requestAnimationFrame(loop);
            }
            loop();
        }
    };

    /* ----------------------------------------------------------------
       7. LİDERLİK TABLOSU SİSTEMİ
    ---------------------------------------------------------------- */
    const leaderboardSystem = {
        load: async (diff) => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            const tab = document.getElementById(`tab-${diff}`);
            if(tab) tab.classList.add('active');

            const content = document.getElementById('leaderboard-content');
            content.innerHTML = "Yükleniyor...";
            
            if(window.getLeaderboard) {
                content.innerHTML = await window.getLeaderboard(diff);
            } else {
                content.innerHTML = "<p>Veritabanı hazır değil.</p>";
            }
        }
    };

    // BAŞLAT
    window.onload = () => {
        confettiSystem.init();
        loginSystem.init();
    };

    </script>
</body>
</html>
