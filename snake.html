<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Snake 3310 Pro</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        /* GENEL AYARLAR */
        body {
            margin: 0;
            padding: 0;
            background-color: #2c3e50;
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            touch-action: none;
        }

        /* NOKIA EKRAN √áER√áEVESƒ∞ */
        .phone-case {
            background-color: #34495e;
            padding: 15px;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), inset 0 5px 10px rgba(255,255,255,0.1);
            position: relative;
            border: 2px solid #2c3e50;
        }

        .screen-container {
            background-color: #9bbc0f; /* Klasik Ye≈üil */
            border: 6px solid #43523d;
            border-radius: 8px;
            position: relative;
            width: 340px;
            height: 340px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }

        canvas {
            display: block;
            margin: 0 auto;
        }

        /* UI KATMANI (SKORLAR) */
        .ui-bar {
            position: absolute;
            top: 5px;
            left: 8px;
            right: 8px;
            display: flex;
            justify-content: space-between;
            font-family: 'VT323', monospace;
            font-size: 26px;
            color: #0f380f;
            z-index: 10;
            pointer-events: none;
            text-shadow: 1px 1px 0 rgba(155, 188, 15, 0.5);
        }

        /* MOBƒ∞L KONTROLLER (D-PAD D√úZENƒ∞) */
        .mobile-controls {
            margin-top: 25px;
            display: grid;
            grid-template-columns: 70px 70px 70px; /* 3 S√ºtun */
            grid-template-rows: 60px 60px 60px;    /* 3 Satƒ±r */
            gap: 5px;
            justify-content: center;
            align-items: center;
        }
        
        /* PC'de gizle */
        @media (min-width: 768px) {
            .mobile-controls { display: none; }
        }

        .d-btn {
            background: linear-gradient(145deg, #e6e6e6, #cccccc);
            border: 2px solid #999;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            color: #333;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 6px 0 #888, 0 10px 10px rgba(0,0,0,0.2);
            transition: 0.1s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            margin: auto; /* H√ºcre i√ßinde ortala */
        }
        .d-btn:active { 
            transform: translateY(6px); 
            box-shadow: 0 0 0 #888, inset 0 2px 5px rgba(0,0,0,0.2); 
            background: #bbb; 
        }
        
        /* IZGARA YERLE≈ûƒ∞Mƒ∞ (CROSS / ARTI ≈ûEKLƒ∞) */
        .btn-up    { grid-column: 2; grid-row: 1; }
        .btn-left  { grid-column: 1; grid-row: 2; }
        /* ORTASI BO≈û (2,2) */
        .btn-right { grid-column: 3; grid-row: 2; }
        .btn-down  { grid-column: 2; grid-row: 3; }

        /* MODALLAR */
        #login-modal, #leaderboard-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 200;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: #9bbc0f;
            padding: 30px; border-radius: 15px; text-align: center;
            box-shadow: 0 0 30px rgba(155, 188, 15, 0.3); 
            border: 4px solid #0f380f;
            width: 85%; max-width: 400px;
            font-family: 'VT323', monospace;
        }

        .modal-content h2 {
            color: #0f380f; margin: 0 0 20px 0; font-size: 42px; text-transform: uppercase; letter-spacing: 2px;
        }
        
        .modal-input {
            width: 80%; padding: 12px; font-size: 28px; 
            border: 3px solid #0f380f; background: #8bac0f;
            color: #0f380f; text-align: center; font-family: 'VT323', monospace;
            outline: none; margin-bottom: 25px; border-radius: 5px;
        }
        
        .modal-btn, .close-btn {
            background: #0f380f; color: #9bbc0f; padding: 12px 35px; border: none;
            font-size: 28px; cursor: pointer; font-family: 'VT323', monospace;
            border: 3px solid #0f380f; transition: 0.2s; border-radius: 5px;
        }
        .modal-btn:hover { background: #1a5c1a; transform: scale(1.05); }

        .hidden { display: none !important; }

        /* Lƒ∞DERLƒ∞K TABLOSU BUTONU */
        .leaderboard-btn {
            position: fixed; top: 20px; right: 20px; 
            background: #9bbc0f; width: 55px; height: 55px; border-radius: 12px;
            display: flex; justify-content: center; align-items: center;
            font-size: 26px; cursor: pointer; z-index: 100;
            border: 3px solid #0f380f; color: #0f380f;
            box-shadow: 0 4px 0 #0f380f;
        }
        .leaderboard-btn:active { transform: translateY(4px); box-shadow: none; }

        /* Lƒ∞STE STƒ∞Lƒ∞ */
        #leaderboard-list {
            list-style: none; padding: 0; margin: 20px 0; max-height: 250px; overflow-y: auto; text-align: left;
        }
        .leaderboard-item {
            background: rgba(15, 56, 15, 0.1); margin-bottom: 8px; padding: 8px 12px;
            border-bottom: 2px solid #0f380f; color: #0f380f; display: flex; justify-content: space-between;
            font-size: 26px; border-radius: 4px;
        }

        /* START MESSAGE */
        #start-msg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 32px; color: #0f380f; font-weight: bold; font-family: 'VT323', monospace;
            animation: blink 1.5s infinite; pointer-events: none;
            display: none; width: 100%; text-align: center;
            text-shadow: 2px 2px 0px rgba(155, 188, 15, 0.8);
            z-index: 20;
        }
        @keyframes blink { 50% { opacity: 0.3; } }

        /* GERƒ∞ D√ñN BUTONU */
        .back-btn { 
            position: fixed; bottom: 20px; left: 20px; 
            padding: 12px 24px; background: #2c3e50; color: #fff; 
            text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 14px;
            z-index: 100; font-family: 'Inter', sans-serif;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>

    <button class="leaderboard-btn" onclick="openLeaderboard()"><i class="fas fa-trophy"></i></button>
    <a href="index.html" class="back-btn">‚Üê ANA MEN√ú</a>

    <div class="phone-case">
        <div class="screen-container">
            <div class="ui-bar">
                <span>SKOR: <span id="current-score">0</span></span>
                <span>REKOR: <span id="best-score">0</span></span>
            </div>
            <div id="start-msg">BA≈ûLAMAK ƒ∞√áƒ∞N<br>Bƒ∞R Y√ñNE BAS</div>
            <canvas id="gameCanvas" width="340" height="340"></canvas>
        </div>
    </div>

    <div class="mobile-controls">
        <button class="d-btn btn-up" ontouchstart="mobileInput('up')" onclick="mobileInput('up')"><i class="fas fa-arrow-up"></i></button>
        <button class="d-btn btn-left" ontouchstart="mobileInput('left')" onclick="mobileInput('left')"><i class="fas fa-arrow-left"></i></button>
        <button class="d-btn btn-right" ontouchstart="mobileInput('right')" onclick="mobileInput('right')"><i class="fas fa-arrow-right"></i></button>
        <button class="d-btn btn-down" ontouchstart="mobileInput('down')" onclick="mobileInput('down')"><i class="fas fa-arrow-down"></i></button>
    </div>

    <div id="login-modal">
        <div class="modal-content">
            <h2>SNAKE PRO</h2>
            <p style="font-size:20px; margin-bottom: 10px;">Rumuzunu Gir Pilot:</p>
            <input type="text" id="nickname-input" class="modal-input" placeholder="RUMUZ" maxlength="10">
            <button class="modal-btn" onclick="kullaniciKaydet()">BA≈ûLA</button>
        </div>
    </div>

    <div id="leaderboard-modal" class="hidden">
        <div class="modal-content">
            <h2>EFSANELER</h2>
            <div id="loading-text">Veriler √ßekiliyor...</div>
            <ul id="leaderboard-list"></ul>
            <button class="close-btn" onclick="closeLeaderboard()">KAPAT</button>
        </div>
    </div>

    <script>
    // --- FIREBASE AYARLARI ---
    const firebaseConfig = {
        apiKey: "AIzaSyBW8xNsDjp3duXyuPukuBKNlOYw-uv6W1c",
        authDomain: "hakantools-a44c0.firebaseapp.com",
        projectId: "hakantools-a44c0",
        storageBucket: "hakantools-a44c0.firebasestorage.app",
        messagingSenderId: "216753237718",
        appId: "1:216753237718:web:ea012c7dc4fdb7e7d72377",
        measurementId: "G-4GWK9BS40T"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- DEƒûƒ∞≈ûKENLER ---
    const LOCAL_UID_KEY = 'hakan_snake_uid'; 
    const LOCAL_BEST_KEY = 'snake_best';
    const COLLECTION_NAME = 'snake_leaderboard';

    let gameInterval;
    let isGameRunning = false;
    let changingDirection = false;

    // --- SES MOTORU (AudioContext) ---
    // Harici dosya gerektirmez, kod ile ses √ºretir.
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
        
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        
        if (type === 'eat') {
            // Yeme sesi: Kƒ±sa, y√ºksek perdeli "bip"
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        } else if (type === 'die') {
            // Yanma sesi: D√º≈ü√ºk perdeli, azalan "bzzzt"
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- KULLANICI ƒ∞≈ûLEMLERƒ∞ ---
    window.addEventListener('load', () => {
        const kayitliID = localStorage.getItem(LOCAL_UID_KEY);
        const localBest = localStorage.getItem(LOCAL_BEST_KEY) || 0;
        document.getElementById('best-score').innerText = localBest;

        if (kayitliID) {
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('start-msg').style.display = 'block';
            verileriGuncelle(kayitliID);
        }
    });

    function kullaniciKaydet() {
        const isim = document.getElementById('nickname-input').value.trim();
        if (isim === "") { alert("ƒ∞sim yazman lazƒ±m!"); return; }
        
        // Ses sistemini ba≈ülat (Mobil tarayƒ±cƒ±lar i√ßin kullanƒ±cƒ± etkile≈üimi ≈üart)
        if (audioCtx.state === 'suspended') audioCtx.resume();

        const localBest = parseInt(localStorage.getItem(LOCAL_BEST_KEY)) || 0;

        db.collection(COLLECTION_NAME).add({
            name: isim, 
            score: localBest, 
            date: new Date().toLocaleString('tr-TR')
        }).then((docRef) => {
            localStorage.setItem(LOCAL_UID_KEY, docRef.id);
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('start-msg').style.display = 'block';
        }).catch((err) => alert("Hata: " + err.message));
    }

    function verileriGuncelle(uid) {
        db.collection(COLLECTION_NAME).doc(uid).onSnapshot((doc) => {
            if (doc.exists) {
                const data = doc.data();
                const localBest = parseInt(localStorage.getItem(LOCAL_BEST_KEY)) || 0;
                if(data.score > localBest) {
                    localStorage.setItem(LOCAL_BEST_KEY, data.score);
                    document.getElementById('best-score').innerText = data.score;
                }
            }
        });
    }

    function skoruDatabaseYaz(yeniSkor) {
        const uid = localStorage.getItem(LOCAL_UID_KEY);
        if (!uid) return;

        const docRef = db.collection(COLLECTION_NAME).doc(uid);
        db.runTransaction((t) => {
            return t.get(docRef).then((doc) => {
                if (!doc.exists) throw "Hata";
                const eski = doc.data().score || 0;
                if (yeniSkor > eski) {
                    t.update(docRef, { score: yeniSkor, date: new Date().toLocaleString('tr-TR') });
                    return yeniSkor;
                }
                return eski;
            });
        }).then((finalScore) => {
            console.log("Skor senkronize edildi:", finalScore);
        });
    }

    // --- Lƒ∞DERLƒ∞K TABLOSU ---
    function openLeaderboard() {
        const modal = document.getElementById('leaderboard-modal');
        const list = document.getElementById('leaderboard-list');
        const loading = document.getElementById('loading-text');
        
        modal.classList.remove('hidden');
        list.innerHTML = "";
        loading.style.display = "block";

        db.collection(COLLECTION_NAME)
          .orderBy("score", "desc")
          .limit(10)
          .get()
          .then((querySnapshot) => {
              loading.style.display = "none";
              let rank = 1;
              querySnapshot.forEach((doc) => {
                  const data = doc.data();
                  const item = document.createElement('li');
                  item.className = 'leaderboard-item';
                  let icon = rank === 1 ? 'üëë' : (rank === 2 ? 'ü•à' : (rank === 3 ? 'ü•â' : `#${rank}`));
                  item.innerHTML = `<span>${icon} ${data.name}</span><span>${data.score}</span>`;
                  list.appendChild(item);
                  rank++;
              });
          })
          .catch((error) => {
              loading.innerText = "Hata: " + error.message;
          });
    }

    function closeLeaderboard() {
        document.getElementById('leaderboard-modal').classList.add('hidden');
    }

    // --- OYUN MANTIƒûI (CANVAS) ---
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const gridSize = 20;
    const tileCount = canvas.width / gridSize;
    
    let score = 0;
    let playerX = 10;
    let playerY = 10;
    let velocityX = 0;
    let velocityY = 0;
    let trail = [];
    let tail = 3;
    let appleX = 5;
    let appleY = 5;

    // Oyunu ba≈ülatan fonksiyon (Ba≈ülatƒ±r ve ilk y√∂n√º verir)
    function startGame(initialVelX, initialVelY) {
        if(isGameRunning) return;
        
        // Modal a√ßƒ±ksa ba≈ülama
        if(!document.getElementById('login-modal').classList.contains('hidden')) return;
        if(!document.getElementById('leaderboard-modal').classList.contains('hidden')) return;

        // Ses motorunu uyandƒ±r
        if (audioCtx.state === 'suspended') audioCtx.resume();

        isGameRunning = true;
        document.getElementById('start-msg').style.display = 'none';
        
        score = 0;
        tail = 3;
        playerX = 10; playerY = 10;
        trail = []; // Kuyruƒüu temizle
        
        // Parametre olarak gelen y√∂n varsa onu uygula, yoksa saƒüa git
        if(initialVelX !== undefined) {
            velocityX = initialVelX;
            velocityY = initialVelY;
        } else {
            velocityX = 1; velocityY = 0; 
        }

        changingDirection = false;
        document.getElementById('current-score').innerText = score;
        
        // √ñnceki interval varsa temizle
        if(gameInterval) clearInterval(gameInterval);
        gameInterval = setInterval(gameLoop, 1000/6); // Hƒ±zƒ± biraz artƒ±rdƒ±m
    }

    function gameLoop() {
        changingDirection = false; 

        playerX += velocityX;
        playerY += velocityY;

        // Duvarlardan ge√ßi≈ü
        if(playerX < 0) playerX = tileCount - 1;
        if(playerX > tileCount - 1) playerX = 0;
        if(playerY < 0) playerY = tileCount - 1;
        if(playerY > tileCount - 1) playerY = 0;

        // Arka Plan
        ctx.fillStyle = "#9bbc0f";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // YILAN √áƒ∞Zƒ∞Mƒ∞ (DAHA GER√áEK√áƒ∞ / YUVARLAK)
        ctx.fillStyle = "#0f380f";
        for(let i=0; i<trail.length; i++) {
            // Yƒ±lan par√ßasƒ±
            let x = trail[i].x * gridSize;
            let y = trail[i].y * gridSize;
            
            // Yuvarlak g√∂vde √ßiz
            ctx.beginPath();
            ctx.arc(x + gridSize/2, y + gridSize/2, (gridSize/2) - 1, 0, 2 * Math.PI);
            ctx.fill();
            
            // Eƒüer bu par√ßa kafa ise (listenin son elemanƒ±)
            if(i == trail.length - 1) {
                // G√∂zleri ekle
                ctx.fillStyle = "#9bbc0f"; // G√∂z akƒ± rengi (ekran rengiyle aynƒ± yaptƒ±m kontrast i√ßin)
                
                // G√∂z pozisyonlarƒ±nƒ± y√∂ne g√∂re ayarla
                let eyeOffsetX1 = 0, eyeOffsetY1 = 0;
                let eyeOffsetX2 = 0, eyeOffsetY2 = 0;
                
                if(velocityX == 1) { // Saƒü
                    eyeOffsetX1 = 12; eyeOffsetY1 = 5;
                    eyeOffsetX2 = 12; eyeOffsetY2 = 15;
                } else if (velocityX == -1) { // Sol
                    eyeOffsetX1 = 8; eyeOffsetY1 = 5;
                    eyeOffsetX2 = 8; eyeOffsetY2 = 15;
                } else if (velocityY == -1) { // Yukarƒ±
                    eyeOffsetX1 = 5; eyeOffsetY1 = 8;
                    eyeOffsetX2 = 15; eyeOffsetY2 = 8;
                } else if (velocityY == 1) { // A≈üaƒüƒ±
                    eyeOffsetX1 = 5; eyeOffsetY1 = 12;
                    eyeOffsetX2 = 15; eyeOffsetY2 = 12;
                }

                ctx.beginPath();
                ctx.arc(x + eyeOffsetX1, y + eyeOffsetY1, 2, 0, 2 * Math.PI); // Sol g√∂z
                ctx.arc(x + eyeOffsetX2, y + eyeOffsetY2, 2, 0, 2 * Math.PI); // Saƒü g√∂z
                ctx.fill();
                
                // Rengi tekrar g√∂vde rengine √ßevir
                ctx.fillStyle = "#0f380f";

                // Kendi kuyruƒüuna √ßarpma kontrol√º
                if(trail[i].x == playerX && trail[i].y == playerY) {
                    gameOver();
                    return;
                }
            } else {
                // Kuyruk kontrol√º (kafa hari√ß)
                if(trail[i].x == playerX && trail[i].y == playerY) {
                    gameOver();
                    return;
                }
            }
        }

        trail.push({x: playerX, y: playerY});
        while(trail.length > tail) {
            trail.shift();
        }

        // ELMA √áƒ∞Zƒ∞Mƒ∞ (DAHA GER√áEK√áƒ∞)
        // Elma g√∂lgesi
        ctx.fillStyle = "rgba(15, 56, 15, 0.3)";
        ctx.beginPath();
        ctx.arc(appleX * gridSize + gridSize/2 + 2, appleY * gridSize + gridSize/2 + 2, gridSize/2 - 2, 0, 2 * Math.PI);
        ctx.fill();

        // Elma kendisi
        ctx.fillStyle = "#d32f2f"; // Kƒ±rmƒ±zƒ±msƒ± elma (retro palette biraz koyu durur ama belirgin olur)
        // Eƒüer retro ye≈üil temasƒ±nƒ± bozmamak istersen #0f380f kullanabilirsin ama bu daha ≈üƒ±k.
        // Biz yine de koyu ye≈üil temaya sadƒ±k kalƒ±p i√ßine desen √ßizelim:
        ctx.fillStyle = "#0f380f"; 
        ctx.beginPath();
        ctx.arc(appleX * gridSize + gridSize/2, appleY * gridSize + gridSize/2, gridSize/2 - 2, 0, 2 * Math.PI);
        ctx.fill();
        
        // Elma Sapƒ±
        ctx.fillStyle = "#9bbc0f";
        ctx.fillRect(appleX * gridSize + gridSize/2 - 1, appleY * gridSize + 2, 2, 4);


        if(appleX == playerX && appleY == playerY) {
            tail++;
            score += 10; 
            document.getElementById('current-score').innerText = score;
            playSound('eat'); // Yeme sesi
            
            appleX = Math.floor(Math.random() * tileCount);
            appleY = Math.floor(Math.random() * tileCount);
            
            // Elmanƒ±n yƒ±lanƒ±n √ºst√ºnde doƒümamasƒ±nƒ± saƒüla
            for(let t of trail) {
                if(t.x == appleX && t.y == appleY) {
                     appleX = Math.floor(Math.random() * tileCount);
                     appleY = Math.floor(Math.random() * tileCount);
                }
            }
        }
    }

    function gameOver() {
        clearInterval(gameInterval);
        isGameRunning = false;
        playSound('die'); // Yanma sesi
        
        const localBest = parseInt(localStorage.getItem(LOCAL_BEST_KEY)) || 0;
        if(score > localBest) {
            localStorage.setItem(LOCAL_BEST_KEY, score);
            document.getElementById('best-score').innerText = score;
        }
        
        skoruDatabaseYaz(score);
        
        document.getElementById('start-msg').innerHTML = "OYUN Bƒ∞TTƒ∞<br>SKOR: " + score + "<br>TEKRAR ƒ∞√áƒ∞N<br>Bƒ∞R Y√ñNE BAS";
        document.getElementById('start-msg').style.display = 'block';
    }

    // --- KONTROLLER ---
    
    document.addEventListener('keydown', keyPush);
    function keyPush(evt) {
        // Eƒüer oyun √ßalƒ±≈ümƒ±yorsa ve y√∂n tu≈ülarƒ±ndan birine basƒ±ldƒ±ysa Dƒ∞REKT BA≈ûLAT
        if(!isGameRunning) {
             if(evt.keyCode == 37) startGame(-1, 0); // Solla ba≈üla
             else if(evt.keyCode == 38) startGame(0, -1); // Yukarƒ±yla ba≈üla
             else if(evt.keyCode == 39) startGame(1, 0); // Saƒüla ba≈üla
             else if(evt.keyCode == 40) startGame(0, 1); // A≈üaƒüƒ±yla ba≈üla
             else if([32,13].includes(evt.keyCode)) startGame(); // Space/Enter
             
             // Tu≈üun varsayƒ±lan kaydƒ±rma √∂zelliƒüini engelle
             if([37,38,39,40,32,13].includes(evt.keyCode)) evt.preventDefault();
             return;
        }

        if (changingDirection) return;

        switch(evt.keyCode) {
            case 37: // Sol
                if(velocityX == 1) return;
                velocityX = -1; velocityY = 0; 
                changingDirection = true;
                break;
            case 38: // Yukarƒ±
                if(velocityY == 1) return; 
                velocityX = 0; velocityY = -1; 
                changingDirection = true;
                break;
            case 39: // Saƒü
                if(velocityX == -1) return; 
                velocityX = 1; velocityY = 0; 
                changingDirection = true;
                break;
            case 40: // A≈üaƒüƒ±
                if(velocityY == -1) return; 
                velocityX = 0; velocityY = 1; 
                changingDirection = true;
                break;
        }
    }

    // Mobil Butonlar
    window.mobileInput = function(dir) {
        // Oyun √ßalƒ±≈ümƒ±yorsa direkt ba≈ülat
        if(!isGameRunning) {
            if(dir == 'left') startGame(-1, 0);
            else if(dir == 'up') startGame(0, -1);
            else if(dir == 'right') startGame(1, 0);
            else if(dir == 'down') startGame(0, 1);
            else startGame();
            return;
        }

        if (changingDirection) return;

        switch(dir) {
            case 'left': 
                if(velocityX == 1) return; 
                velocityX = -1; velocityY = 0; 
                changingDirection = true;
                break;
            case 'up': 
                if(velocityY == 1) return; 
                velocityX = 0; velocityY = -1; 
                changingDirection = true;
                break;
            case 'right': 
                if(velocityX == -1) return; 
                velocityX = 1; velocityY = 0; 
                changingDirection = true;
                break;
            case 'down': 
                if(velocityY == -1) return; 
                velocityX = 0; velocityY = 1; 
                changingDirection = true;
                break;
        }
    };
    </script>
</body>
</html>

