<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HakanTools | Snake 3310 Pro Max</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        /* --- GENEL AYARLAR --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #2c3e50;
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            /* Tarayƒ±cƒ± kaydƒ±rmasƒ±nƒ± ve yakƒ±nla≈ütƒ±rmasƒ±nƒ± engeller */
            touch-action: none; 
            -webkit-user-select: none;
            user-select: none;
        }

        /* --- TELEFON KASASI --- */
        .phone-case {
            background-color: #34495e;
            padding: 15px;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), inset 0 5px 10px rgba(255,255,255,0.1);
            position: relative;
            border: 2px solid #2c3e50;
            margin-bottom: 20px; /* Kontrollerle kasa arasƒ± bo≈üluk */
        }

        /* --- EKRAN ALANI --- */
        .screen-container {
            background-color: #9bbc0f; /* Nokia Ye≈üili */
            border: 6px solid #43523d;
            border-radius: 8px;
            position: relative;
            width: 340px;
            height: 340px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }

        canvas {
            display: block;
            margin: 0 auto;
        }

        /* --- UI (SKOR TABELASI) --- */
        .ui-bar {
            position: absolute; 
            top: 5px; 
            left: 8px; 
            right: 8px;
            display: flex; 
            justify-content: space-between;
            font-family: 'VT323', monospace; 
            font-size: 26px; 
            color: #0f380f;
            z-index: 10; 
            pointer-events: none;
            text-shadow: 1px 1px 0 rgba(155, 188, 15, 0.5);
        }

        /* --- MOBƒ∞L KONTROLLER (YENƒ∞ TASARIM) --- */
        .mobile-controls {
            /* Grid yapƒ±sƒ±nƒ± b√ºy√ºtt√ºk */
            display: grid;
            grid-template-columns: 90px 90px 90px;
            grid-template-rows: 90px 90px 90px;
            gap: 5px;
            justify-content: center;
            align-items: center;
            /* Dokunmatik gecikmesini √∂nlemek i√ßin kritik */
            touch-action: none;
        }
        
        /* PC'de kontrolleri gizle */
        @media (min-width: 768px) { 
            .mobile-controls { display: none; } 
        }

        .d-btn {
            background: linear-gradient(145deg, #e6e6e6, #cccccc);
            border: 3px solid #999; 
            /* KARE G√ñR√úN√úM ƒ∞√áƒ∞N: */
            border-radius: 12px; 
            /* DAHA B√úY√úK BOYUTLAR: */
            width: 85px; 
            height: 85px; 
            font-size: 32px; /* ƒ∞kon boyutu da b√ºy√ºd√º */
            color: #333;
            cursor: pointer; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            box-shadow: 0 8px 0 #888, 0 10px 15px rgba(0,0,0,0.3);
            transition: transform 0.05s, box-shadow 0.05s; /* √áok hƒ±zlƒ± tepki i√ßin s√ºreyi kƒ±salttƒ±m */
            user-select: none; 
            -webkit-tap-highlight-color: transparent; 
            margin: auto;
            /* Donmayƒ± engellemek i√ßin √∂nemli */
            touch-action: none;
        }
        
        /* Butona basƒ±lƒ±nca (active-state JS ile ekleniyor) */
        .d-btn:active, .d-btn.active-state { 
            transform: translateY(8px); 
            box-shadow: 0 0 0 #888, inset 0 4px 8px rgba(0,0,0,0.2); 
            background: #bbb; 
        }
        
        /* Tu≈ü Yerle≈üimi */
        .btn-up { grid-column: 2; grid-row: 1; }
        .btn-left { grid-column: 1; grid-row: 2; }
        .btn-right { grid-column: 3; grid-row: 2; }
        .btn-down { grid-column: 2; grid-row: 3; }

        /* --- MODALLAR (A√ßƒ±lƒ±r Pencereler) --- */
        #login-modal, #leaderboard-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 200;
            display: flex; justify-content: center; align-items: center; 
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: #9bbc0f; 
            padding: 30px; 
            border-radius: 15px; 
            text-align: center;
            box-shadow: 0 0 30px rgba(155, 188, 15, 0.3); 
            border: 4px solid #0f380f;
            width: 85%; max-width: 400px; 
            font-family: 'VT323', monospace;
        }
        
        .modal-content h2 { 
            color: #0f380f; margin: 0 0 20px 0; font-size: 42px; text-transform: uppercase; letter-spacing: 2px; 
        }
        
        .modal-input {
            width: 80%; padding: 12px; font-size: 28px; border: 3px solid #0f380f; background: #8bac0f;
            color: #0f380f; text-align: center; font-family: 'VT323', monospace; outline: none; margin-bottom: 25px; border-radius: 5px;
        }
        
        .modal-btn, .close-btn {
            background: #0f380f; color: #9bbc0f; padding: 12px 35px; border: none; font-size: 28px; cursor: pointer;
            font-family: 'VT323', monospace; border: 3px solid #0f380f; transition: 0.2s; border-radius: 5px;
        }
        .modal-btn:hover { background: #1a5c1a; transform: scale(1.05); }
        .hidden { display: none !important; }

        /* --- Lƒ∞DERLƒ∞K TABLOSU --- */
        .leaderboard-btn {
            position: fixed; top: 20px; right: 20px; background: #9bbc0f; width: 55px; height: 55px;
            border-radius: 12px; display: flex; justify-content: center; align-items: center;
            font-size: 26px; cursor: pointer; z-index: 100; border: 3px solid #0f380f; color: #0f380f; box-shadow: 0 4px 0 #0f380f;
        }
        .leaderboard-btn:active { transform: translateY(4px); box-shadow: none; }

        #leaderboard-list { list-style: none; padding: 0; margin: 20px 0; max-height: 250px; overflow-y: auto; text-align: left; }
        .leaderboard-item {
            background: rgba(15, 56, 15, 0.1); margin-bottom: 8px; padding: 8px 12px;
            border-bottom: 2px solid #0f380f; color: #0f380f; display: flex; justify-content: space-between;
            font-size: 26px; border-radius: 4px;
        }

        /* --- BA≈ûLANGI√á MESAJI --- */
        #start-msg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 32px; color: #0f380f; font-weight: bold; font-family: 'VT323', monospace;
            animation: blink 1.5s infinite; pointer-events: none; display: none; width: 100%; text-align: center;
            text-shadow: 2px 2px 0px rgba(155, 188, 15, 0.8); z-index: 20;
        }
        @keyframes blink { 50% { opacity: 0.3; } }

        /* --- GERƒ∞ D√ñN BUTONU --- */
        .back-btn { 
            position: fixed; bottom: 20px; left: 20px; padding: 12px 24px; background: #2c3e50; color: #fff; 
            text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 14px; z-index: 100;
            font-family: 'Inter', sans-serif; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>

    <button class="leaderboard-btn" onclick="openLeaderboard()"><i class="fas fa-trophy"></i></button>
    <a href="index.html" class="back-btn">‚Üê ANA MEN√ú</a>

    <div class="phone-case">
        <div class="screen-container">
            <div class="ui-bar">
                <span>SKOR: <span id="current-score">0</span></span>
                <span>REKOR: <span id="best-score">0</span></span>
            </div>
            <div id="start-msg">BA≈ûLAMAK ƒ∞√áƒ∞N<br>Bƒ∞R Y√ñNE BAS</div>
            <canvas id="gameCanvas" width="340" height="340"></canvas>
        </div>
    </div>

    <div class="mobile-controls">
        <button id="m-btn-up" class="d-btn btn-up"><i class="fas fa-arrow-up"></i></button>
        <button id="m-btn-left" class="d-btn btn-left"><i class="fas fa-arrow-left"></i></button>
        <button id="m-btn-right" class="d-btn btn-right"><i class="fas fa-arrow-right"></i></button>
        <button id="m-btn-down" class="d-btn btn-down"><i class="fas fa-arrow-down"></i></button>
    </div>

    <div id="login-modal">
        <div class="modal-content">
            <h2>SNAKE PRO</h2>
            <p style="font-size:20px; margin-bottom: 10px;">Rumuzunu Gir Pilot:</p>
            <input type="text" id="nickname-input" class="modal-input" placeholder="RUMUZ" maxlength="10">
            <button class="modal-btn" onclick="kullaniciKaydet()">BA≈ûLA</button>
        </div>
    </div>

    <div id="leaderboard-modal" class="hidden">
        <div class="modal-content">
            <h2>EFSANELER</h2>
            <div id="loading-text">Veriler √ßekiliyor...</div>
            <ul id="leaderboard-list"></ul>
            <button class="close-btn" onclick="closeLeaderboard()">KAPAT</button>
        </div>
    </div>

    <script>
    // --- 1. FIREBASE AYARLARI ---
    const firebaseConfig = {
        apiKey: "AIzaSyBW8xNsDjp3duXyuPukuBKNlOYw-uv6W1c",
        authDomain: "hakantools-a44c0.firebaseapp.com",
        projectId: "hakantools-a44c0",
        storageBucket: "hakantools-a44c0.firebasestorage.app",
        messagingSenderId: "216753237718",
        appId: "1:216753237718:web:ea012c7dc4fdb7e7d72377",
        measurementId: "G-4GWK9BS40T"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const LOCAL_UID_KEY = 'hakan_snake_uid'; 
    const LOCAL_BEST_KEY = 'snake_best';
    const COLLECTION_NAME = 'snake_leaderboard';

    // --- 2. OYUN DEƒûƒ∞≈ûKENLERƒ∞ ---
    let gameInterval;
    let isGameRunning = false;
    
    // --- 3. SES MOTORU ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        
        if (type === 'eat') {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.1);
        } else if (type === 'die') {
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- 4. FIREBASE VE KULLANICI ƒ∞≈ûLEMLERƒ∞ ---
    window.addEventListener('load', () => {
        const kayitliID = localStorage.getItem(LOCAL_UID_KEY);
        const localBest = localStorage.getItem(LOCAL_BEST_KEY) || 0;
        document.getElementById('best-score').innerText = localBest;
        
        if (kayitliID) {
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('start-msg').style.display = 'block';
            verileriGuncelle(kayitliID);
        }
    });

    function kullaniciKaydet() {
        const isim = document.getElementById('nickname-input').value.trim();
        if (isim === "") { alert("ƒ∞sim yazman lazƒ±m!"); return; }
        
        if (audioCtx.state === 'suspended') audioCtx.resume();
        
        const localBest = parseInt(localStorage.getItem(LOCAL_BEST_KEY)) || 0;
        db.collection(COLLECTION_NAME).add({
            name: isim, score: localBest, date: new Date().toLocaleString('tr-TR')
        }).then((docRef) => {
            localStorage.setItem(LOCAL_UID_KEY, docRef.id);
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('start-msg').style.display = 'block';
        }).catch((err) => alert("Hata: " + err.message));
    }

    function verileriGuncelle(uid) {
        db.collection(COLLECTION_NAME).doc(uid).onSnapshot((doc) => {
            if (doc.exists) {
                const data = doc.data();
                const localBest = parseInt(localStorage.getItem(LOCAL_BEST_KEY)) || 0;
                if(data.score > localBest) {
                    localStorage.setItem(LOCAL_BEST_KEY, data.score);
                    document.getElementById('best-score').innerText = data.score;
                }
            }
        });
    }

    function skoruDatabaseYaz(yeniSkor) {
        const uid = localStorage.getItem(LOCAL_UID_KEY);
        if (!uid) return;
        
        const docRef = db.collection(COLLECTION_NAME).doc(uid);
        db.runTransaction((t) => {
            return t.get(docRef).then((doc) => {
                if (!doc.exists) throw "Hata";
                const eski = doc.data().score || 0;
                if (yeniSkor > eski) {
                    t.update(docRef, { score: yeniSkor, date: new Date().toLocaleString('tr-TR') });
                    return yeniSkor;
                }
                return eski;
            });
        }).then((res) => console.log("Skor senkronize edildi."));
    }

    function openLeaderboard() {
        const modal = document.getElementById('leaderboard-modal');
        const list = document.getElementById('leaderboard-list');
        const loading = document.getElementById('loading-text');
        
        modal.classList.remove('hidden');
        list.innerHTML = ""; loading.style.display = "block";
        
        db.collection(COLLECTION_NAME).orderBy("score", "desc").limit(10).get()
          .then((snapshot) => {
              loading.style.display = "none"; let rank = 1;
              snapshot.forEach((doc) => {
                  const data = doc.data(); 
                  const item = document.createElement('li'); 
                  item.className = 'leaderboard-item';
                  let icon = rank === 1 ? 'üëë' : (rank === 2 ? 'ü•à' : (rank === 3 ? 'ü•â' : `#${rank}`));
                  item.innerHTML = `<span>${icon} ${data.name}</span><span>${data.score}</span>`;
                  list.appendChild(item); rank++;
              });
          });
    }
    
    function closeLeaderboard() { 
        document.getElementById('leaderboard-modal').classList.add('hidden'); 
    }

    // --- 5. OYUN MANTIƒûI (AKICI HAREKET) ---
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const gridSize = 20; 
    const tileCount = canvas.width / gridSize;
    const moveSpeed = 4; 

    let score = 0;
    let playerX = 160; 
    let playerY = 160;
    let velocityX = 0;
    let velocityY = 0;
    
    let nextVelocityX = 0;
    let nextVelocityY = 0;

    let trail = [];
    let tailLength = 3; 
    
    let appleX = 5; 
    let appleY = 5;

    function startGame(initialVelX, initialVelY) {
        if(isGameRunning) return;
        if(!document.getElementById('login-modal').classList.contains('hidden')) return;
        if(!document.getElementById('leaderboard-modal').classList.contains('hidden')) return;
        if (audioCtx.state === 'suspended') audioCtx.resume();

        isGameRunning = true;
        document.getElementById('start-msg').style.display = 'none';
        
        score = 0;
        tailLength = 3;
        playerX = 160; playerY = 160;
        trail = [];
        
        if(initialVelX !== undefined) {
            nextVelocityX = initialVelX; nextVelocityY = initialVelY;
        } else {
            nextVelocityX = 1; nextVelocityY = 0; 
        }
        velocityX = nextVelocityX; velocityY = nextVelocityY;

        document.getElementById('current-score').innerText = score;
        if(gameInterval) clearInterval(gameInterval);
        
        gameInterval = setInterval(gameLoop, 1000/50); 
    }

    function gameLoop() {
        if (playerX % gridSize === 0 && playerY % gridSize === 0) {
            if (velocityX !== 0 && nextVelocityX !== 0 && velocityX !== nextVelocityX) { }
            else if (velocityY !== 0 && nextVelocityY !== 0 && velocityY !== nextVelocityY) { }
            else {
                if (!(velocityX === 1 && nextVelocityX === -1) && 
                    !(velocityX === -1 && nextVelocityX === 1) &&
                    !(velocityY === 1 && nextVelocityY === -1) &&
                    !(velocityY === -1 && nextVelocityY === 1)) {
                        velocityX = nextVelocityX;
                        velocityY = nextVelocityY;
                }
            }
        }

        playerX += velocityX * moveSpeed;
        playerY += velocityY * moveSpeed;

        if (playerX >= canvas.width) playerX = 0;
        else if (playerX < 0) playerX = canvas.width - gridSize;
        
        if (playerY >= canvas.height) playerY = 0;
        else if (playerY < 0) playerY = canvas.height - gridSize;

        ctx.fillStyle = "#9bbc0f";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        let requiredTrailLength = tailLength * (gridSize / moveSpeed);

        trail.push({x: playerX, y: playerY});
        while(trail.length > requiredTrailLength) {
            trail.shift();
        }

        ctx.fillStyle = "#0f380f";
        for(let i=0; i<trail.length; i++) {
            ctx.beginPath();
            ctx.arc(trail[i].x + gridSize/2, trail[i].y + gridSize/2, (gridSize/2) - 1, 0, 2*Math.PI);
            ctx.fill();
            
            if (i < trail.length - (gridSize/moveSpeed)*2) { 
                let dx = Math.abs(playerX - trail[i].x);
                let dy = Math.abs(playerY - trail[i].y);
                if (dx < 5 && dy < 5) {
                    gameOver();
                    return;
                }
            }
        }
        
        if (trail.length > 0) {
            let headX = playerX;
            let headY = playerY;
            ctx.fillStyle = "#9bbc0f"; 
            
            let eyeX1, eyeY1, eyeX2, eyeY2;
            if(velocityX === 1) { 
                eyeX1 = 12; eyeY1 = 5; eyeX2 = 12; eyeY2 = 15;
            } else if(velocityX === -1) { 
                eyeX1 = 8; eyeY1 = 5; eyeX2 = 8; eyeY2 = 15;
            } else if(velocityY === -1) { 
                eyeX1 = 5; eyeY1 = 8; eyeX2 = 15; eyeY2 = 8;
            } else { 
                eyeX1 = 5; eyeY1 = 12; eyeX2 = 15; eyeY2 = 12;
            }
            
            ctx.beginPath();
            ctx.arc(headX + eyeX1, headY + eyeY1, 2, 0, 2*Math.PI);
            ctx.arc(headX + eyeX2, headY + eyeY2, 2, 0, 2*Math.PI);
            ctx.fill();
        }

        let applePixelX = appleX * gridSize;
        let applePixelY = appleY * gridSize;

        ctx.fillStyle = "#0f380f";
        ctx.beginPath();
        ctx.arc(applePixelX + gridSize/2, applePixelY + gridSize/2, gridSize/2 - 2, 0, 2*Math.PI);
        ctx.fill();
        ctx.fillStyle = "#9bbc0f";
        ctx.fillRect(applePixelX + gridSize/2 - 1, applePixelY + 2, 2, 4);

        let dist = Math.hypot(playerX - applePixelX, playerY - applePixelY);
        if (dist < moveSpeed * 1.5) { 
            tailLength++;
            score += 10;
            document.getElementById('current-score').innerText = score;
            playSound('eat');
            createSafeApple();
        }
    }

    function createSafeApple() {
        let safe = false;
        while(!safe) {
            appleX = Math.floor(Math.random() * tileCount);
            appleY = Math.floor(Math.random() * tileCount);
            
            let applePx = appleX * gridSize;
            let applePy = appleY * gridSize;
            
            safe = true;
            for(let t of trail) {
                if (Math.abs(t.x - applePx) < gridSize && Math.abs(t.y - applePy) < gridSize) {
                    safe = false;
                    break;
                }
            }
        }
    }

    function gameOver() {
        clearInterval(gameInterval);
        isGameRunning = false;
        playSound('die');
        
        const localBest = parseInt(localStorage.getItem(LOCAL_BEST_KEY)) || 0;
        if(score > localBest) {
            localStorage.setItem(LOCAL_BEST_KEY, score);
            document.getElementById('best-score').innerText = score;
        }
        skoruDatabaseYaz(score);
        document.getElementById('start-msg').innerHTML = "OYUN Bƒ∞TTƒ∞<br>SKOR: " + score + "<br>TEKRAR ƒ∞√áƒ∞N<br>Bƒ∞R Y√ñNE BAS";
        document.getElementById('start-msg').style.display = 'block';
    }

    // --- 6. Gƒ∞Rƒ∞≈ûLER (KLAVYE) ---
    document.addEventListener('keydown', keyPush);
    function keyPush(evt) {
        if(!isGameRunning) {
             if(evt.keyCode == 37) startGame(-1, 0);
             else if(evt.keyCode == 38) startGame(0, -1);
             else if(evt.keyCode == 39) startGame(1, 0);
             else if(evt.keyCode == 40) startGame(0, 1);
             else if([32,13].includes(evt.keyCode)) startGame();
             if([37,38,39,40,32,13].includes(evt.keyCode)) evt.preventDefault();
             return;
        }
        switch(evt.keyCode) {
            case 37: if(velocityX !== 1) { nextVelocityX = -1; nextVelocityY = 0; } break; 
            case 38: if(velocityY !== 1) { nextVelocityX = 0; nextVelocityY = -1; } break; 
            case 39: if(velocityX !== -1) { nextVelocityX = 1; nextVelocityY = 0; } break; 
            case 40: if(velocityY !== -1) { nextVelocityX = 0; nextVelocityY = 1; } break; 
        }
    }

    // --- 7. Gƒ∞Rƒ∞≈ûLER (MOBƒ∞L - DOKUNMATƒ∞K ƒ∞Yƒ∞LE≈ûTƒ∞Rƒ∞LMƒ∞≈û) ---
    
    // Ortak y√∂nlendirme fonksiyonu
    window.mobileInput = function(dir) {
        if(!isGameRunning) {
            if(dir == 'left') startGame(-1, 0);
            else if(dir == 'up') startGame(0, -1);
            else if(dir == 'right') startGame(1, 0);
            else if(dir == 'down') startGame(0, 1);
            else startGame();
            return;
        }
        switch(dir) {
            case 'left': if(velocityX !== 1) { nextVelocityX = -1; nextVelocityY = 0; } break;
            case 'up': if(velocityY !== 1) { nextVelocityX = 0; nextVelocityY = -1; } break;
            case 'right': if(velocityX !== -1) { nextVelocityX = 1; nextVelocityY = 0; } break;
            case 'down': if(velocityY !== -1) { nextVelocityX = 0; nextVelocityY = 1; } break;
        }
    };

    // YENƒ∞: S√ºper Hƒ±zlƒ± Dokunmatik Tepki Sistemi
    // HTML'deki 'onclick' yerine bu 'touchstart' dinleyicilerini kullanƒ±yoruz.
    // Bu sayede tarayƒ±cƒ±nƒ±n 300ms bekleme s√ºresini (donma hissi) ortadan kaldƒ±rƒ±yoruz.
    const setupMobileButtons = () => {
        const directions = ['up', 'left', 'right', 'down'];
        directions.forEach(dir => {
            const btn = document.getElementById(`m-btn-${dir}`);
            if(!btn) return;

            // Parmaƒüƒ±n deƒüdiƒüi an (Gecikmesiz)
            btn.addEventListener('touchstart', function(e) {
                e.preventDefault(); // Tarayƒ±cƒ±nƒ±n varsayƒ±lan i≈ülemini durdur (Donmayƒ± √ß√∂zen kƒ±sƒ±m)
                mobileInput(dir); // Y√∂n komutunu ver
                this.classList.add('active-state'); // Basƒ±lma efekti
            }, { passive: false });

            // Parmak kalkƒ±nca
            btn.addEventListener('touchend', function(e) {
                e.preventDefault();
                this.classList.remove('active-state'); // Efekti kaldƒ±r
            }, { passive: false });
            
             // Parmak butonun dƒ±≈üƒ±na kayarsa
            btn.addEventListener('touchcancel', function(e) {
                 this.classList.remove('active-state');
            });
        });
    };
    // Sayfa y√ºklenince butonlarƒ± ayarla
    setupMobileButtons();

    // KAYDIRMA (SWIPE) DESTEƒûƒ∞ (Mevcut sistemle uyumlu)
    const controlDiv = document.querySelector('.mobile-controls');
    let lastTouchedBtn = null;
    if(controlDiv) {
        controlDiv.addEventListener('touchmove', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const element = document.elementFromPoint(touch.clientX, touch.clientY);
            const btn = element ? element.closest('.d-btn') : null;
            
            if (btn && btn !== lastTouchedBtn) {
                const dirId = btn.id.replace('m-btn-', '');
                mobileInput(dirId);
                
                if(lastTouchedBtn) lastTouchedBtn.classList.remove('active-state');
                btn.classList.add('active-state');
                lastTouchedBtn = btn;
            }
        }, { passive: false });
        
        controlDiv.addEventListener('touchend', () => { 
            if(lastTouchedBtn) lastTouchedBtn.classList.remove('active-state');
            lastTouchedBtn = null; 
        });
    }
    </script>
</body>
</html>
